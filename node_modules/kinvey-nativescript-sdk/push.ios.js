/**
 * kinvey-nativescript-sdk - Kinvey NativeScript SDK for developing NativeScript applications.
 * @version v3.11.4
 * @author Kinvey, Inc.
 * @link http://www.kinvey.com
 * @license Apache-2.0
 */
module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=492)}([function(e,t,n){"use strict";function r(e,t,n,r){this.name="BaseError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseError=r,r.prototype=Object.create(Error.prototype),r.prototype.constructor=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(213);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(214);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(215);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(216);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(217);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(0);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var c=n(218);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=n(219);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var f=n(220);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var h=n(221);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var p=n(222);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var d=n(223);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var y=n(224);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})});var v=n(225);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var b=n(226);Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})});var _=n(227);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})});var g=n(228);Object.keys(g).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})});var m=n(229);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var w=n(230);Object.keys(w).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}})});var O=n(231);Object.keys(O).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})});var k=n(232);Object.keys(k).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}})});var P=n(233);Object.keys(P).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var E=n(234);Object.keys(E).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})});var j=n(235);Object.keys(j).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return j[e]}})});var S=n(236);Object.keys(S).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})});var C=n(237);Object.keys(C).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var M=n(238);Object.keys(M).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return M[e]}})});var T=n(239);Object.keys(T).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})});var A=n(240);Object.keys(A).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}})});var x=n(241);Object.keys(x).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})});var R=n(242);Object.keys(R).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}})});var I=n(243);Object.keys(I).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}})});var N=n(244);Object.keys(N).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return N[e]}})});var q=n(245);Object.keys(q).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return q[e]}})});var D=n(246);Object.keys(D).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return D[e]}})});var U=n(247);Object.keys(U).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return U[e]}})});var K=n(248);Object.keys(K).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return K[e]}})});var L=n(249);Object.keys(L).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return L[e]}})});var F=n(250);Object.keys(F).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return F[e]}})});var B=n(251);Object.keys(B).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return B[e]}})})},function(e,t,n){(function(t,r){var i;i=function(){"use strict";function e(e){return"function"==typeof e}var i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=0,u=void 0,s=void 0,a=function(e,t){y[o]=e,y[o+1]=t,2===(o+=2)&&(s?s(v):w())};var c="undefined"!=typeof window?window:void 0,l=c||{},f=l.MutationObserver||l.WebKitMutationObserver,h="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(v,1)}}var y=new Array(1e3);function v(){for(var e=0;e<o;e+=2){(0,y[e])(y[e+1]),y[e]=void 0,y[e+1]=void 0}o=0}var b,_,g,m,w=void 0;function O(e,t){var n=arguments,r=this,i=new this.constructor(E);void 0===i[P]&&B(i);var o,u=r._state;return u?(o=n[u-1],a(function(){return L(u,i,o,r._result)})):q(r,i,e,t),i}function k(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(E);return x(t,e),t}h?w=function(){return t.nextTick(v)}:f?(_=0,g=new f(v),m=document.createTextNode(""),g.observe(m,{characterData:!0}),w=function(){m.data=_=++_%2}):p?((b=new MessageChannel).port1.onmessage=v,w=function(){return b.port2.postMessage(0)}):w=void 0===c?function(){try{var e=n(170);return void 0!==(u=e.runOnLoop||e.runOnContext)?function(){u(v)}:d()}catch(e){return d()}}():d();var P=Math.random().toString(36).substring(16);function E(){}var j=void 0,S=1,C=2,M=new U;function T(e){try{return e.then}catch(e){return M.error=e,M}}function A(t,n,r){n.constructor===t.constructor&&r===O&&n.constructor.resolve===k?function(e,t){t._state===S?I(e,t._result):t._state===C?N(e,t._result):q(t,void 0,function(t){return x(e,t)},function(t){return N(e,t)})}(t,n):r===M?(N(t,M.error),M.error=null):void 0===r?I(t,n):e(r)?function(e,t,n){a(function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?x(e,n):I(e,n))},function(t){r||(r=!0,N(e,t))},e._label);!r&&i&&(r=!0,N(e,i))},e)}(t,n,r):I(t,n)}function x(e,t){var n,r;e===t?N(e,new TypeError("You cannot resolve a promise with itself")):(r=typeof(n=t),null===n||"object"!==r&&"function"!==r?I(e,t):A(e,t,T(t)))}function R(e){e._onerror&&e._onerror(e._result),D(e)}function I(e,t){e._state===j&&(e._result=t,e._state=S,0!==e._subscribers.length&&a(D,e))}function N(e,t){e._state===j&&(e._state=C,e._result=t,a(R,e))}function q(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+S]=n,i[o+C]=r,0===o&&e._state&&a(D,e)}function D(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,u=0;u<t.length;u+=3)r=t[u],i=t[u+n],r?L(n,r,i,o):i(o);e._subscribers.length=0}}function U(){this.error=null}var K=new U;function L(t,n,r,i){var o=e(r),u=void 0,s=void 0,a=void 0,c=void 0;if(o){if((u=function(e,t){try{return e(t)}catch(e){return K.error=e,K}}(r,i))===K?(c=!0,s=u.error,u.error=null):a=!0,n===u)return void N(n,new TypeError("A promises callback cannot return that same promise."))}else u=i,a=!0;n._state!==j||(o&&a?x(n,u):c?N(n,s):t===S?I(n,u):t===C&&N(n,u))}var F=0;function B(e){e[P]=F++,e._state=void 0,e._result=void 0,e._subscribers=[]}function G(e,t){this._instanceConstructor=e,this.promise=new e(E),this.promise[P]||B(this.promise),i(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?I(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&I(this.promise,this._result))):N(this.promise,new Error("Array Methods must be provided an Array"))}function H(e){this[P]=F++,this._result=this._state=void 0,this._subscribers=[],E!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof H?function(e,t){try{t(function(t){x(e,t)},function(t){N(e,t)})}catch(t){N(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return G.prototype._enumerate=function(e){for(var t=0;this._state===j&&t<e.length;t++)this._eachEntry(e[t],t)},G.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===k){var i=T(e);if(i===O&&e._state!==j)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===H){var o=new n(E);A(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},G.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===j&&(this._remaining--,e===C?N(r,n):this._result[t]=n),0===this._remaining&&I(r,this._result)},G.prototype._willSettleAt=function(e,t){var n=this;q(e,void 0,function(e){return n._settledAt(S,t,e)},function(e){return n._settledAt(C,t,e)})},H.all=function(e){return new G(this,e).promise},H.race=function(e){var t=this;return i(e)?new t(function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)}):new t(function(e,t){return t(new TypeError("You must pass an array to race."))})},H.resolve=k,H.reject=function(e){var t=new this(E);return N(t,e),t},H._setScheduler=function(e){s=e},H._setAsap=function(e){a=e},H._asap=a,H.prototype={constructor:H,then:O,catch:function(e){return this.then(null,e)}},H.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=H},H.Promise=H,H},e.exports=i()}).call(t,n(169),n(19))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(106);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(107);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(389);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(390);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(108);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={PNTimeOperation:"PNTimeOperation",PNHistoryOperation:"PNHistoryOperation",PNDeleteMessagesOperation:"PNDeleteMessagesOperation",PNFetchMessagesOperation:"PNFetchMessagesOperation",PNSubscribeOperation:"PNSubscribeOperation",PNUnsubscribeOperation:"PNUnsubscribeOperation",PNPublishOperation:"PNPublishOperation",PNPushNotificationEnabledChannelsOperation:"PNPushNotificationEnabledChannelsOperation",PNRemoveAllPushNotificationsOperation:"PNRemoveAllPushNotificationsOperation",PNWhereNowOperation:"PNWhereNowOperation",PNSetStateOperation:"PNSetStateOperation",PNHereNowOperation:"PNHereNowOperation",PNGetStateOperation:"PNGetStateOperation",PNHeartbeatOperation:"PNHeartbeatOperation",PNChannelGroupsOperation:"PNChannelGroupsOperation",PNRemoveGroupOperation:"PNRemoveGroupOperation",PNChannelsForGroupOperation:"PNChannelsForGroupOperation",PNAddChannelsToGroupOperation:"PNAddChannelsToGroupOperation",PNRemoveChannelsFromGroupOperation:"PNRemoveChannelsFromGroupOperation",PNAccessManagerGrant:"PNAccessManagerGrant",PNAccessManagerAudit:"PNAccessManagerAudit"},e.exports=t.default},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=p(n(256)),o=p(n(21)),u=p(n(10)),s=p(n(31)),a=p(n(257)),c=n(1),l=n(18),f=n(3),h=n(26);function p(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var y=6e4,v=null,b=function(){function e(){d(this,e),this.memory=new i.default}return r(e,[{key:"get",value:function(e){if(!(0,u.default)(e))throw new c.KinveyError("ActiveUserStorage key must be a string.");try{return JSON.parse(this.memory.get(e))}catch(e){return null}}},{key:"set",value:function(e,t){if(!(0,u.default)(e))throw new c.KinveyError("ActiveUserStorage key must be a string.");return(0,f.isDefined)(t)?this.memory.set(e,JSON.stringify(t)):this.memory.delete(e),t}}]),e}();t.Client=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,e);var n="https://baas.kinvey.com",r="https://auth.kinvey.com";if(t.instanceId){var i=t.instanceId;if(!(0,u.default)(i))throw new c.KinveyError("Instance ID must be a string.");n="https://"+i+"-baas.kinvey.com",r="https://"+i+"-auth.kinvey.com"}else(0,u.default)(t.apiHostname)&&(n=/^https?:\/\//i.test(t.apiHostname)?t.apiHostname:"https://"+t.apiHostname),(0,u.default)(t.micHostname)&&(r=/^https?:\/\//i.test(t.micHostname)?t.micHostname:"https://"+t.micHostname);var a=o.default.parse(n),l=o.default.parse(r);this.deviceId=(0,f.uuidv4)(),this.apiProtocol=a.protocol,this.apiHost=a.host,this.micProtocol=l.protocol,this.micHost=l.host,this.appKey=t.appKey,this.appSecret=t.appSecret,this.masterSecret=t.masterSecret,this.encryptionKey=t.encryptionKey,this.appVersion=t.appVersion,this.defaultTimeout=(0,s.default)(t.defaultTimeout)&&t.defaultTimeout>=0?t.defaultTimeout:y,this.activeUserStorage=new b,this.storage=t.storage||h.StorageProvider.Memory}return r(e,[{key:"getActiveUser",value:function(){return this.activeUserStorage.get(this.appKey+"."+f.activeUserKey)}},{key:"setActiveUser",value:function(e){return this.activeUserStorage.set(this.appKey+"."+f.activeUserKey,e)}},{key:"toPlainObject",value:function(){return{deviceId:this.deviceId,apiHostname:this.apiHostname,apiProtocol:this.apiProtocol,apiHost:this.apiHost,micHostname:this.micHostname,micProtocol:this.micProtocol,micHost:this.micHost,appKey:this.appKey,appSecret:this.appSecret,masterSecret:this.masterSecret,encryptionKey:this.encryptionKey,appVersion:this.appVersion,storage:this.storage}}},{key:"apiHostname",get:function(){return o.default.format({protocol:this.apiProtocol,host:this.apiHost})}},{key:"micHostname",get:function(){return o.default.format({protocol:this.micProtocol,host:this.micHost})}},{key:"appVersion",get:function(){return this._appVersion},set:function(e){e&&!(0,u.default)(e)&&(e=String(e)),this._appVersion=e}},{key:"defaultTimeout",get:function(){return this._defaultTimeout},set:function(e){if(e=parseInt(e,10),!1===(0,s.default)(e)||(0,a.default)(e))throw new c.KinveyError("Invalid timeout. Timeout must be a number.");e<0&&(l.Log.info("Default timeout is less than 0. Setting default timeout to "+this.defaultTimeout+"ms."),e=this.defaultTimeout),this._defaultTimeout=e}},{key:"storage",get:function(){return this._storage},set:function(e){if(!(0,f.isValidStorageProviderValue)(e))throw new c.KinveyError("Please provide a valid set of supported storage providers for this platform");this._storage=e}}],[{key:"initialize",value:function(){throw new c.KinveyError("Please use Client.init().")}},{key:"init",value:function(t){return v=new e(t)}},{key:"sharedInstance",value:function(){if(!1===(0,f.isDefined)(v))throw new c.KinveyError("You have not initialized the library. Please call Kinvey.init() to initialize the library.");return v}}]),e}()},function(e,t,n){"use strict";function r(e){return encodeURIComponent(e).replace(/[!~*'()]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function i(e){return function(e){var t=[];return Object.keys(e).forEach(function(e){return t.push(e)}),t}(e).sort()}e.exports={signPamFromParams:function(e){return i(e).map(function(t){return t+"="+r(e[t])}).join("&")},endsWith:function(e,t){return-1!==e.indexOf(t,this.length-t.length)},createPromise:function(){var e=void 0,t=void 0;return{promise:new Promise(function(n,r){e=n,t=r}),reject:t,fulfill:e}},encodeString:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(42);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(393);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(153);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(91);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(154);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(155);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){var r=n(20),i=n(6),o=n(14),u="[object String]";e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&r(e)==u}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){var r=n(61),i=n(28),o=n(117),u=n(24),s=n(32),a=n(22),c=Object.prototype.hasOwnProperty,l=o(function(e,t){if(s(t)||u(t))i(t,a(t),e);else for(var n in t)c.call(t,n)&&r(e,n,t[n])});e.exports=l},function(e,t,n){var r=n(98),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=f(n(252)),u=f(n(33)),s=f(n(119)),a=n(1),c=n(3),l=n(18);function f(e){return e&&e.__esModule?e:{default:e}}var h=["_id","_acl"],p=["$nearSphere"],d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,s.default)(t,{fields:[],filter:{},sort:null,limit:null,skip:0}),this.fields=t.fields,this.filter=t.filter,this.sort=t.sort,this.limit=t.limit,this.skip=t.skip,this._parent=null}return i(e,[{key:"isSupportedOffline",value:function(){var e=this;return Object.keys(this.filter).reduce(function(t,n){if(t){var i=e.filter[n];return p.some(function(e){return!i||("object"!==(void 0===i?"undefined":r(i))||!Object.keys(i).some(function(t){return t===e}))})}return t},!0)}},{key:"hasSkip",value:function(){return(0,c.isNumber)(this.skip)&&this.skip>0}},{key:"hasLimit",value:function(){return(0,c.isNumber)(this.limit)}},{key:"equalTo",value:function(e,t){return this.addFilter(e,t)}},{key:"contains",value:function(e,t){if(!1===(0,c.isDefined)(t))throw new a.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$in",t)}},{key:"containsAll",value:function(e,t){if(!1===(0,c.isDefined)(t))throw new a.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$all",t)}},{key:"greaterThan",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$gt",t)}},{key:"greaterThanOrEqualTo",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$gte",t)}},{key:"lessThan",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$lt",t)}},{key:"lessThanOrEqualTo",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$lte",t)}},{key:"notEqualTo",value:function(e,t){return this.addFilter(e,"$ne",t)}},{key:"notContainedIn",value:function(e,t){return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$nin",t)}},{key:"and",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.join("$and",t)}},{key:"nor",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return(0,c.isDefined)(this._parent)&&Object.hasOwnProperty.call(this._parent.filter,"$and")?(r=this._parent).nor.apply(r,t):this.join("$nor",t)}},{key:"or",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return(0,c.isDefined)(this._parent)?(r=this._parent).or.apply(r,t):this.join("$or",t)}},{key:"exists",value:function(e,t){return t=void 0===t||(t||!1),this.addFilter(e,"$exists",t)}},{key:"mod",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("string"==typeof t&&(t=parseFloat(t)),"string"==typeof n&&(n=parseFloat(n)),!(0,c.isNumber)(t))throw new a.QueryError("divisor must be a number");if(!(0,c.isNumber)(n))throw new a.QueryError("remainder must be a number");return this.addFilter(e,"$mod",[t,n])}},{key:"matches",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[];if(t instanceof RegExp||(t=new RegExp(t)),0!==t.source.indexOf("^"))throw new a.QueryError("regExp must have '^' at the beginning of the expression to make it an anchored expression.");if((t.ignoreCase||n.ignoreCase)&&!1!==n.ignoreCase)throw new a.QueryError("ignoreCase flag is not supported");return(t.multiline||n.multiline)&&!1!==n.multiline&&r.push("m"),!0===n.extended&&r.push("x"),!0===n.dotMatchesAll&&r.push("s"),r.length>0&&this.addFilter(e,"$options",r.join("")),this.addFilter(e,"$regex",t.source)}},{key:"near",value:function(e,t,n){if(!Array.isArray(t)||!(0,c.isNumber)(t[0])||!(0,c.isNumber)(t[1]))throw new a.QueryError("coord must be a [number, number]");var r=this.addFilter(e,"$nearSphere",[t[0],t[1]]);return(0,c.isNumber)(n)&&this.addFilter(e,"$maxDistance",n),r}},{key:"withinBox",value:function(e,t,n){if(!Array.isArray(t)||!(0,c.isNumber)(t[0])||!(0,c.isNumber)(t[1]))throw new a.QueryError("bottomLeftCoord must be a [number, number]");if(!Array.isArray(n)||!(0,c.isNumber)(n[0])||!(0,c.isNumber)(n[1]))throw new a.QueryError("upperRightCoord must be a [number, number]");t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1]),n[0]=parseFloat(n[0]),n[1]=parseFloat(n[1]);var r=[[t[0],t[1]],[n[0],n[1]]];return this.addFilter(e,"$within",{$box:r})}},{key:"withinPolygon",value:function(e,t){if(!1===Array.isArray(t)||0===t.length||t.length>3)throw new a.QueryError("coords must be a [[number, number]]");return t=t.map(function(e){if(!1===(0,c.isNumber)(e[0])||!1===(0,c.isNumber)(e[1]))throw new a.QueryError("coords argument must be a [number, number]");return[parseFloat(e[0]),parseFloat(e[1])]}),this.addFilter(e,"$within",{$polygon:t})}},{key:"size",value:function(e,t){if("string"==typeof t&&(t=parseFloat(t)),!(0,c.isNumber)(t))throw new a.QueryError("size must be a number");return this.addFilter(e,"$size",t)}},{key:"ascending",value:function(e){return(0,c.isDefined)(this._parent)?this._parent.ascending(e):this.sort[e]=1,this}},{key:"descending",value:function(e){return(0,c.isDefined)(this._parent)?this._parent.descending(e):this.sort[e]=-1,this}},{key:"addFilter",value:function(e,t,n){return(0,c.isDefined)(t)&&((0,c.isDefined)(n)||3===arguments.length)?((0,u.default)(this.filter[e])||(this.filter[e]={}),this.filter[e][t]=n):this.filter[e]=t,this}},{key:"join",value:function(t,n){var r=this,i=this,o={};return 0===(n=n.map(function(t){if(!(t instanceof e)){if(!(0,u.default)(t))throw new a.QueryError("query argument must be of type: Kinvey.Query[] or Object[].");t=new e(t)}return t.toPlainObject().filter})).length&&(n=[(i=new e).toPlainObject().filter],i._parent=this),Object.keys(this.filter).forEach(function(e){o[e]=r.filter[e],delete r.filter[e]}),this.filter[t]=[o].concat(n),i}},{key:"process",value:function(e){if(!this.isSupportedOffline()){var t="This query is not able to run locally. The following filters are not supported locally:";throw p.forEach(function(e){t=t+" "+e}),l.Log.error(t),new a.QueryError(t)}if(!Array.isArray(e))throw new a.QueryError("data argument must be of type: Array.");l.Log.debug("Data length before processiong query",e.length);var n=this.toPlainObject();if(e=(0,o.default)(n.filter,e),l.Log.debug("Data length after applying query filter",n.filter,e.length),(0,c.isDefined)(n.sort)&&(l.Log.debug("Sorting data",n.sort),e.sort(function(e,t){for(var r in n.sort)if(n.sort.hasOwnProperty(r)){var i=(0,c.nested)(e,r),o=(0,c.nested)(t,r),u=n.sort[r];if((0,c.isDefined)(i)&&!1===(0,c.isDefined)(o))return 1*u;if(!1===(0,c.isDefined)(i)&&(0,c.isDefined)(o))return-1*u;if(void 0===i&&null===o)return 0;if(null===i&&void 0===o)return 0;if(i!==o)return(i<o?-1:1)*u}return 0})),Array.isArray(n.fields)&&n.fields.length>0){var r=[].concat(n.fields,h);l.Log.debug("Removing fields from data",n.fields),e=e.map(function(e){return Object.keys(e).forEach(function(t){-1===r.indexOf(t)&&delete e[t]}),e})}return(0,c.isNumber)(n.skip)?(0,c.isNumber)(n.limit)&&n.limit>0?(l.Log.debug("Skipping and limiting data",n.skip,n.limit),e.slice(n.skip,n.skip+n.limit)):(l.Log.debug("Skipping data",n.skip),e.slice(n.skip)):e}},{key:"toPlainObject",value:function(){return(0,c.isDefined)(this._parent)?this._parent.toPlainObject():{fields:this.fields,filter:this.filter,sort:this.sort,skip:this.skip,limit:this.limit}}},{key:"toQueryString",value:function(){var e={};return Object.keys(this.filter).length>0&&(e.query=this.filter),this.fields.length>0&&(e.fields=this.fields.join(",")),(0,c.isNumber)(this.limit)&&(e.limit=this.limit),(0,c.isNumber)(this.skip)&&this.skip>0&&(e.skip=this.skip),Object.keys(this.sort).length>0&&(e.sort=this.sort),Object.keys(e).forEach(function(t){e[t]="string"==typeof e[t]?e[t]:JSON.stringify(e[t])}),e}},{key:"toString",value:function(){return JSON.stringify(this.toQueryString())}},{key:"fields",get:function(){return this._fields},set:function(e){if(e=e||[],!Array.isArray(e))throw new a.QueryError("fields must be an Array");(0,c.isDefined)(this._parent)?this._parent.fields=e:this._fields=e}},{key:"filter",get:function(){return this._filter},set:function(e){this._filter=e}},{key:"sort",get:function(){return this._sort},set:function(e){if(e&&!(0,u.default)(e))throw new a.QueryError("sort must an Object");(0,c.isDefined)(this._parent)?this._parent.sort=e:this._sort=e||{}}},{key:"limit",get:function(){return this._limit},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),(0,c.isDefined)(e)&&!1===(0,c.isNumber)(e))throw new a.QueryError("limit must be a number");this._parent?this._parent.limit=e:this._limit=e}},{key:"skip",get:function(){return this._skip},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),!1===(0,c.isNumber)(e))throw new a.QueryError("skip must be a number");(0,c.isDefined)(this._parent)?this._parent.skip=e:this._skip=e}}]),e}();t.Query=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(374);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(375);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(88);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(137);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(138);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(141);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(383);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(140);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;var r,i=n(255),o=(r=i)&&r.__esModule?r:{default:r};o.default.setDefaultLevel(o.default.levels.SILENT);var u=o.default.methodFactory;o.default.methodFactory=function(e,t,n){var r=u(e,t,n);return function(e){e="Kinvey: "+e;for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];n.length>0?r(e,n):r(e)}},t.Log=o.default},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(30),i=n(171),o=n(172),u="[object Null]",s="[object Undefined]",a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?s:u:a&&a in Object(e)?i(e):o(e)}},function(e,t,n){"use strict";var r=n(173),i=n(174);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=g,t.resolve=function(e,t){return g(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?g(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=g(e));return e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var u=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),f=["%","/","?",";","#"].concat(l),h=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},_=n(175);function g(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var g=e=c.join(s);if(g=g.trim(),!n&&1===e.split("#").length){var m=a.exec(g);if(m)return this.path=g,this.href=g,this.pathname=m[1],m[2]?(this.search=m[2],this.query=t?_.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=u.exec(g);if(w){var O=(w=w[0]).toLowerCase();this.protocol=O,g=g.substr(w.length)}if(n||w||g.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===g.substr(0,2);!k||w&&v[w]||(g=g.substr(2),this.slashes=!0)}if(!v[w]&&(k||w&&!b[w])){for(var P,E,j=-1,S=0;S<h.length;S++){-1!==(C=g.indexOf(h[S]))&&(-1===j||C<j)&&(j=C)}-1!==(E=-1===j?g.lastIndexOf("@"):g.lastIndexOf("@",j))&&(P=g.slice(0,E),g=g.slice(E+1),this.auth=decodeURIComponent(P)),j=-1;for(S=0;S<f.length;S++){var C;-1!==(C=g.indexOf(f[S]))&&(-1===j||C<j)&&(j=C)}-1===j&&(j=g.length),this.host=g.slice(0,j),g=g.slice(j),this.parseHost(),this.hostname=this.hostname||"";var M="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!M)for(var T=this.hostname.split(/\./),A=(S=0,T.length);S<A;S++){var x=T[S];if(x&&!x.match(p)){for(var R="",I=0,N=x.length;I<N;I++)x.charCodeAt(I)>127?R+="x":R+=x[I];if(!R.match(p)){var q=T.slice(0,S),D=T.slice(S+1),U=x.match(d);U&&(q.push(U[1]),D.unshift(U[2])),D.length&&(g="/"+D.join(".")+g),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=r.toASCII(this.hostname));var K=this.port?":"+this.port:"",L=this.hostname||"";this.host=L+K,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==g[0]&&(g="/"+g))}if(!y[O])for(S=0,A=l.length;S<A;S++){var F=l[S];if(-1!==g.indexOf(F)){var B=encodeURIComponent(F);B===F&&(B=escape(F)),g=g.split(F).join(B)}}var G=g.indexOf("#");-1!==G&&(this.hash=g.substr(G),g=g.slice(0,G));var H=g.indexOf("?");if(-1!==H?(this.search=g.substr(H),this.query=g.substr(H+1),t&&(this.query=_.parse(this.query)),g=g.slice(0,H)):t&&(this.search="",this.query={}),g&&(this.pathname=g),b[O]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){K=this.pathname||"";var z=this.search||"";this.path=K+z}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,u="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(u=_.stringify(this.query));var s=this.search||u&&"?"+u||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+r},o.prototype.resolve=function(e){return this.resolveObject(g(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),u=0;u<r.length;u++){var s=r[u];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),c=0;c<a.length;c++){var l=a[c];"protocol"!==l&&(n[l]=e[l])}return b[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){for(var f=Object.keys(e),h=0;h<f.length;h++){var p=f[h];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||v[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var y=n.pathname||"",_=n.search||"";n.path=y+_}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var g=n.pathname&&"/"===n.pathname.charAt(0),m=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=m||g||n.host&&e.pathname,O=w,k=n.pathname&&n.pathname.split("/")||[],P=(d=e.pathname&&e.pathname.split("/")||[],n.protocol&&!b[n.protocol]);if(P&&(n.hostname="",n.port=null,n.host&&(""===k[0]?k[0]=n.host:k.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),w=w&&(""===d[0]||""===k[0])),m)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,k=d;else if(d.length)k||(k=[]),k.pop(),k=k.concat(d),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(P)n.hostname=n.host=k.shift(),(M=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=M.shift(),n.host=n.hostname=M.shift());return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!k.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=k.slice(-1)[0],j=(n.host||e.host||k.length>1)&&("."===E||".."===E)||""===E,S=0,C=k.length;C>=0;C--)"."===(E=k[C])?k.splice(C,1):".."===E?(k.splice(C,1),S++):S&&(k.splice(C,1),S--);if(!w&&!O)for(;S--;S)k.unshift("..");!w||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),j&&"/"!==k.join("/").substr(-1)&&k.push("");var M,T=""===k[0]||k[0]&&"/"===k[0].charAt(0);P&&(n.hostname=n.host=T?"":k.length?k.shift():"",(M=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=M.shift(),n.host=n.hostname=M.shift()));return(w=w||n.host&&k.length)&&!T&&k.unshift(""),k.length?n.pathname=k.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){var r=n(101),i=n(103),o=n(24);e.exports=function(e){return o(e)?r(e):i(e)}},function(e,t,n){var r=n(199),i=n(202);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(25),i=n(68);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},function(e,t,n){var r=n(20),i=n(11),o="[object AsyncFunction]",u="[object Function]",s="[object GeneratorFunction]",a="[object Proxy]";e.exports=function(e){if(!i(e))return!1;var t=r(e);return t==u||t==s||t==o||t==a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(75);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(150);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(388);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(78);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(36);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(66);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var c=n(37);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=n(17);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var f=n(57);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t,n){var r=n(103),i=n(34),o=n(59),u=n(6),s=n(24),a=n(43),c=n(32),l=n(67),f="[object Map]",h="[object Set]",p=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(u(e)||"string"==typeof e||"function"==typeof e.splice||a(e)||l(e)||o(e)))return!e.length;var t=i(e);if(t==f||t==h)return!e.size;if(c(e))return!r(e).length;for(var n in e)if(p.call(e,n))return!1;return!0}},function(e,t,n){var r=n(61),i=n(76);e.exports=function(e,t,n,o){var u=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var c=t[s],l=o?o(n[c],e[c],c,n,e):void 0;void 0===l&&(l=e[c]),u?i(n,c,l):r(n,c,l)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(83),u=(r=o)&&r.__esModule?r:{default:r};n(4);var s=function(){function e(t){var n=t.setup,r=t.db;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._db=r,this.instanceId="pn-"+u.default.createUUID(),this.secretKey=n.secretKey||n.secret_key,this.subscribeKey=n.subscribeKey||n.subscribe_key,this.publishKey=n.publishKey||n.publish_key,this.sdkName=n.sdkName,this.sdkFamily=n.sdkFamily,this.partnerId=n.partnerId,this.setAuthKey(n.authKey),this.setCipherKey(n.cipherKey),this.setFilterExpression(n.filterExpression),this.origin=n.origin||"pubsub.pndsn.com",this.secure=n.ssl||!1,this.restore=n.restore||!1,this.proxy=n.proxy,this.keepAlive=n.keepAlive,this.keepAliveSettings=n.keepAliveSettings,this.autoNetworkDetection=n.autoNetworkDetection||!1,this.dedupeOnSubscribe=n.dedupeOnSubscribe||!1,this.maximumCacheSize=n.maximumCacheSize||100,this.customEncrypt=n.customEncrypt,this.customDecrypt=n.customDecrypt,"undefined"!=typeof location&&"https:"===location.protocol&&(this.secure=!0),this.logVerbosity=n.logVerbosity||!1,this.suppressLeaveEvents=n.suppressLeaveEvents||!1,this.announceFailedHeartbeats=n.announceFailedHeartbeats||!0,this.announceSuccessfulHeartbeats=n.announceSuccessfulHeartbeats||!1,this.useInstanceId=n.useInstanceId||!1,this.useRequestId=n.useRequestId||!1,this.requestMessageCountThreshold=n.requestMessageCountThreshold,this.setTransactionTimeout(n.transactionalRequestTimeout||15e3),this.setSubscribeTimeout(n.subscribeRequestTimeout||31e4),this.setSendBeaconConfig(n.useSendBeacon||!0),this.setPresenceTimeout(n.presenceTimeout||300),null!=n.heartbeatInterval&&this.setHeartbeatInterval(n.heartbeatInterval),this.setUUID(this._decideUUID(n.uuid))}return i(e,[{key:"getAuthKey",value:function(){return this.authKey}},{key:"setAuthKey",value:function(e){return this.authKey=e,this}},{key:"setCipherKey",value:function(e){return this.cipherKey=e,this}},{key:"getUUID",value:function(){return this.UUID}},{key:"setUUID",value:function(e){return this._db&&this._db.set&&this._db.set(this.subscribeKey+"uuid",e),this.UUID=e,this}},{key:"getFilterExpression",value:function(){return this.filterExpression}},{key:"setFilterExpression",value:function(e){return this.filterExpression=e,this}},{key:"getPresenceTimeout",value:function(){return this._presenceTimeout}},{key:"setPresenceTimeout",value:function(e){return this._presenceTimeout=e,this.setHeartbeatInterval(this._presenceTimeout/2-1),this}},{key:"setProxy",value:function(e){this.proxy=e}},{key:"getHeartbeatInterval",value:function(){return this._heartbeatInterval}},{key:"setHeartbeatInterval",value:function(e){return this._heartbeatInterval=e,this}},{key:"getSubscribeTimeout",value:function(){return this._subscribeRequestTimeout}},{key:"setSubscribeTimeout",value:function(e){return this._subscribeRequestTimeout=e,this}},{key:"getTransactionTimeout",value:function(){return this._transactionalRequestTimeout}},{key:"setTransactionTimeout",value:function(e){return this._transactionalRequestTimeout=e,this}},{key:"isSendBeaconEnabled",value:function(){return this._useSendBeacon}},{key:"setSendBeaconConfig",value:function(e){return this._useSendBeacon=e,this}},{key:"getVersion",value:function(){return"4.21.2"}},{key:"_decideUUID",value:function(e){return e||(this._db&&this._db.get&&this._db.get(this.subscribeKey+"uuid")?this._db.get(this.subscribeKey+"uuid"):"pn-"+u.default.createUUID())}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){var r=n(13).Symbol;e.exports=r},function(e,t,n){var r=n(20),i=n(14),o="[object Number]";e.exports=function(e){return"number"==typeof e||i(e)&&r(e)==o}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(20),i=n(71),o=n(14),u="[object Object]",s=Function.prototype,a=Object.prototype,c=s.toString,l=a.hasOwnProperty,f=c.call(Object);e.exports=function(e){if(!o(e)||r(e)!=u)return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==f}},function(e,t,n){var r=n(198),i=n(74),o=n(203),u=n(204),s=n(205),a=n(20),c=n(114),l=c(r),f=c(i),h=c(o),p=c(u),d=c(s),y=a;(r&&"[object DataView]"!=y(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=y(new i)||o&&"[object Promise]"!=y(o.resolve())||u&&"[object Set]"!=y(new u)||s&&"[object WeakMap]"!=y(new s))&&(y=function(e){var t=a(e),n="[object Object]"==t?e.constructor:void 0,r=n?c(n):"";if(r)switch(r){case l:return"[object DataView]";case f:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case d:return"[object WeakMap]"}return t}),e.exports=y},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(368);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(369);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(136);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(87);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(144);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(384);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webSqlDatabaseSize=t.webSqlCollectionsMaster=t.sqliteCollectionsMaster=t.browserStorageCollectionsMaster=t.inedxedDbTransctionMode=void 0,t.domStringListToStringArray=function(e){var t=[];return(0,o.default)(e.length,function(n){t.push(e[n])}),t};var r,i=n(115),o=(r=i)&&r.__esModule?r:{default:r};t.inedxedDbTransctionMode={readWrite:"readwrite",readOnly:"readonly"},t.browserStorageCollectionsMaster="__master__",t.sqliteCollectionsMaster="sqlite_master",t.webSqlCollectionsMaster="sqlite_master",t.webSqlDatabaseSize=2097152},function(e,t,n){var r=n(179),i=n(186)(r);e.exports=i},function(e,t,n){var r=n(45),i=1/0;e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Headers=t.kinveyRequestStartHeader=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(99)),o=a(n(10)),u=a(n(33)),s=n(3);function a(e){return e&&e.__esModule?e:{default:e}}var c=t.kinveyRequestStartHeader="X-Kinvey-Request-Start";t.Headers=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headers={},this.addAll(t)}return r(e,[{key:"get",value:function(e){if(e)return!1===(0,o.default)(e)&&(e=String(e)),this.headers[e.toLowerCase()]}},{key:"set",value:function(e,t){if(!1===(0,s.isDefined)(e)||!1===(0,s.isDefined)(t))throw new Error("A name and value must be provided to set a header.");!1===(0,o.default)(e)&&(e=String(e));var n=this.headers;return e=e.toLowerCase(),!1===(0,o.default)(t)?n[e]=JSON.stringify(t):n[e]=t,this.headers=n,this}},{key:"has",value:function(e){return!!this.get(e)}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.set(e.name,e.value)}},{key:"addAll",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n instanceof e&&(n=n.toPlainObject()),!1===(0,u.default)(n))throw new Error("Headers argument must be an object.");var r=Object.keys(n);return(0,i.default)(r,function(e){try{t.set(e,n[e])}catch(e){}}),this}},{key:"remove",value:function(e){if(e){!1===(0,o.default)(e)&&(e=String(e));var t=this.headers;delete t[e.toLowerCase()],this.headers=t}return this}},{key:"clear",value:function(){return this.headers={},this}},{key:"toPlainObject",value:function(){return this.headers}},{key:"toString",value:function(){return JSON.stringify(this.toPlainObject())}},{key:"requestStart",get:function(){return this.get(c)}}]),e}()},function(e,t,n){(function(e){var r=n(13),i=n(183),o="object"==typeof t&&t&&!t.nodeType&&t,u=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=u&&u.exports===o?r.Buffer:void 0,a=(s?s.isBuffer:void 0)||i;e.exports=a}).call(t,n(41)(e))},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(20),i=n(14),o="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||i(e)&&r(e)==o}},function(e,t,n){var r=n(101),i=n(253),o=n(24);e.exports=function(e){return o(e)?r(e,!0):i(e)}},function(e,t,n){var r=n(258),i=n(259),o=n(260),u=n(261),s=n(262);function a(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}a.prototype.clear=r,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=u,a.prototype.set=s,e.exports=a},function(e,t,n){var r=n(35);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(23)(Object,"create");e.exports=r},function(e,t,n){var r=n(276);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveService=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.isValidReceiver=d,t.isValidChannelName=y,t.getLiveService=function(e){b||(b=new v(e));return b};var i=n(2),o=p(n(302)),u=p(n(25)),s=p(n(336)),a=n(7),c=n(9),l=n(1),f=n(3),h=n(129);function p(e){return e&&e.__esModule?e:{default:e}}function d(e){if(!e)return!1;var t=e.onMessage,n=e.onError,r=e.onStatus;return(0,u.default)(t)||(0,u.default)(n)||(0,u.default)(r)}function y(e){return(0,f.isNonemptyString)(e)}var v=t.LiveService=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||a.Client.sharedInstance(),this._pubnubClient=void 0,this._pubnubListener=void 0,this._userChannelGroup=void 0,this._pubnubConfig=void 0,this._registeredUser=void 0}return r(e,[{key:"fullInitialization",value:function(e){var t=this;return this.registerUser(e).then(function(e){var n=new o.default(e),r=new h.PubNubListener;t.initialize(n,r)})}},{key:"fullUninitialization",value:function(){var e=this;return this.unregisterUser().then(function(t){return e.uninitialize(),t})}},{key:"isInitialized",value:function(){return!!this.__pubnubClient&&!!this.__pubnubListener&&!!this._registeredUser}},{key:"registerUser",value:function(e){var t=this;return e&&e.isActive()?this.isInitialized()?i.Promise.reject(new l.KinveyError("Live service already initialized")):this._makeRegisterRequest(e._id).then(function(n){return t._registeredUser=e,t._userChannelGroup=n.userChannelGroup,(0,s.default)({ssl:!0,authKey:t._registeredUser._kmd.authtoken},n)}):i.Promise.reject(new l.ActiveUserError("Missing or invalid active user"))}},{key:"initialize",value:function(e,t){if(this.isInitialized())throw new l.KinveyError("Live service already initialized");this._pubnubListener=t,this._pubnubClient=e,this._pubnubClient.addListener(this._pubnubListener),this._subscribeToUserChannelGroup()}},{key:"uninitialize",value:function(){this._unsubscribeFromAll(),this._pubnubClient=null,this._pubnubListener=null}},{key:"onConnectionStatusUpdates",value:function(e){this._pubnubListener.on(h.PubNubListener.unclassifiedEvents,e),this._pubnubListener.on(this._userChannelGroup,e)}},{key:"offConnectionStatusUpdates",value:function(e){e?(this._pubnubListener.removeListener(h.PubNubListener.unclassifiedEvents,e),this._pubnubListener.removeListener(this._userChannelGroup,e)):(this._pubnubListener.removeAllListeners(h.PubNubListener.unclassifiedEvents),this._pubnubListener.removeAllListeners(this._userChannelGroup))}},{key:"publishToChannel",value:function(e,t){if(!this.isInitialized())return i.Promise.reject(new l.KinveyError("Live service is not initialized"));var n=this._validatePublishData(e,t);return n?i.Promise.reject(n):this._pubnubClient.publish({message:t,channel:e}).catch(function(e){e=e.status&&e.status.errorData;var t=new c.Response({data:e,statusCode:e.status,headers:e.response&&e.response.headers});return i.Promise.reject(t)})}},{key:"subscribeToChannel",value:function(e,t){var n=this._validateSubscribeData(e,t);if(n)throw n;this._subscribeToListener(e,t)}},{key:"unsubscribeFromChannel",value:function(e){this._unsubscribeFromListener(e)}},{key:"unregisterUser",value:function(){var e=this;if(!this._registeredUser){return i.Promise.reject(new l.KinveyError("Cannot unregister when no user has been registered for live service"))}var t=this._registeredUser._id;return this._makeUnregisterRequst(t).then(function(t){return e._registeredUser=null,t})}},{key:"_unsubscribeFromAll",value:function(){this._pubnubClient.unsubscribeAll(),this._pubnubListener.removeAllListeners()}},{key:"_validatePublishData",value:function(e,t){var n=null;return y(e)||(n=new l.KinveyError("Invalid channel name")),void 0===t&&(n=new l.KinveyError("Missing or invalid message")),n}},{key:"_validateSubscribeData",value:function(e,t){var n=null;return y(e)||(n=new l.KinveyError("Invalid channel name")),t&&d(t)||(n=new l.KinveyError("Missing or invalid receiver")),n}},{key:"_subscribeToUserChannelGroup",value:function(){this._pubnubClient.subscribe({channelGroups:[this._userChannelGroup]})}},{key:"_subscribeToListener",value:function(e,t){(0,u.default)(t.onMessage)&&this._pubnubListener.on(e,t.onMessage),((0,u.default)(t.onError)||(0,u.default)(t.onStatus))&&this._pubnubListener.on(""+h.PubNubListener.statusPrefix+e,function(e){var n=e.error?t.onError:t.onStatus;(0,u.default)(n)&&n.call(t,e)})}},{key:"_unsubscribeFromListener",value:function(e){this._pubnubListener.removeAllListeners(e),this._pubnubListener.removeAllListeners(""+h.PubNubListener.statusPrefix+e)}},{key:"_makeRegisterRequest",value:function(e){return this._makeUserManagementRequest(e,"register-realtime")}},{key:"_makeUnregisterRequst",value:function(e){return this._makeUserManagementRequest(e,"unregister-realtime")}},{key:"_makeUserManagementRequest",value:function(e,t){return c.KinveyRequest.execute({method:c.RequestMethod.POST,pathname:"/user/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}},this._client)}},{key:"_throwNotInitializedError",value:function(){throw new l.KinveyError("Live service has not been initialized")}},{key:"_pubnubClient",get:function(){return this.__pubnubClient||this._throwNotInitializedError(),this.__pubnubClient},set:function(e){this.__pubnubClient=e}},{key:"_pubnubListener",set:function(e){this.__pubnubListener=e},get:function(){return this.__pubnubListener||this._throwNotInitializedError(),this.__pubnubListener}}]),e}(),b=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={PNNetworkUpCategory:"PNNetworkUpCategory",PNNetworkDownCategory:"PNNetworkDownCategory",PNNetworkIssuesCategory:"PNNetworkIssuesCategory",PNTimeoutCategory:"PNTimeoutCategory",PNBadRequestCategory:"PNBadRequestCategory",PNAccessDeniedCategory:"PNAccessDeniedCategory",PNUnknownCategory:"PNUnknownCategory",PNReconnectedCategory:"PNReconnectedCategory",PNConnectedCategory:"PNConnectedCategory",PNRequestMessageCountExceededCategory:"PNRequestMessageCountExceededCategory"},e.exports=t.default},function(e,t,n){var r=n(120),i=4;e.exports=function(e){return r(e,i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testSupportCollection=void 0,t.buildCollectionUrl=function(e,t,n){e=(0,i.stripTagFromCollectionName)(e);var o="appdata/"+r.Client.sharedInstance().appKey+"/"+e;t&&(o+="/"+t);n&&(o+="/"+n);return o},t.applyQueryToDataset=function(e,t){if(!t)return e;return t.process(e)},t.applyAggregationToDataset=function(e,t){return t.process(e)};var r=n(7),i=n(16);t.testSupportCollection="__testSupport__"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i={};t.KeyValuePersister=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cacheEnabled=t,this._ttl=n}return r(e,[{key:"read",value:function(e){var t=this;return this._cacheEnabled&&i[e]?Promise.resolve(i[e]):this._readFromPersistance(e).then(function(n){return t._cacheEnabled&&(i[e]=n),n})}},{key:"write",value:function(e,t){var n=this;return this._invalidateCache(e),this._writeToPersistance(e,t).then(function(t){return n._cacheEnabled&&n._ttl<1/0&&setTimeout(function(){n._invalidateCache(e)},n._ttl),t})}},{key:"delete",value:function(e){var t=this;return this._deleteFromPersistance(e).then(function(n){return t._invalidateCache(e),n})}},{key:"getKeys",value:function(){this._throwNotImplementedError()}},{key:"_throwNotImplementedError",value:function(){throw new Error("Abstract method not implemented")}},{key:"_readFromPersistance",value:function(e){this._throwNotImplementedError(e)}},{key:"_writeToPersistance",value:function(e,t){this._throwNotImplementedError(e,t)}},{key:"_deleteFromPersistance",value:function(e){this._throwNotImplementedError(e)}},{key:"_invalidateCache",value:function(e){this._cacheEnabled&&delete i[e]}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryCacheCollectionName=void 0,t.getCachedQuery=function(e,t){var n=f(t);if(!n&&""!==n)return r.Promise.resolve(null);return s.repositoryProvider.getOfflineRepository().then(function(t){var r=(new u.Query).equalTo("collectionName",e).and().equalTo("query",n);return t.read(l,r).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.length>0?t[0]:{_id:(0,a.generateEntityId)(),collectionName:e,query:n}})})},t.createCachedQuery=function(e,t){var n=f(t);if(!n)return r.Promise.resolve(null);return s.repositoryProvider.getOfflineRepository().then(function(t){var r={_id:(0,a.generateEntityId)(),collectionName:e,query:n};return t.create(l,r)})},t.updateCachedQuery=function(e){if(!e)return r.Promise.resolve(null);return s.repositoryProvider.getOfflineRepository().then(function(t){return t.update(l,e)})},t.deleteCachedQuery=function(e){if(!e)return r.Promise.resolve(null);return s.repositoryProvider.getOfflineRepository().then(function(t){return t.deleteById(l,e._id)})},t.clearQueryCache=function(e){return s.repositoryProvider.getOfflineRepository().then(function(t){var n=(new u.Query).equalTo("collectionName",e);return t.delete(l,n)})};var r=n(2),i=c(n(31)),o=c(n(27)),u=n(15),s=n(17),a=n(16);function c(e){return e&&e.__esModule?e:{default:e}}var l=t.queryCacheCollectionName="_QueryCache";function f(e){if(e&&((0,i.default)(e.skip)&&e.skip>0||(0,i.default)(e.limit)))return null;var t=e?e.toQueryString():{};return t&&!(0,o.default)(t)?JSON.stringify(t):""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(145);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(147);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(149);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(387);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Middleware=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r},s=n(405);t.Middleware=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Middleware";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t}return i(e,[{key:"handle",value:function(){return u.default.reject(new Error("A subclass middleware must override the handle function."))}},{key:"cancel",value:function(){return u.default.resolve()}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{value:this.name,level:e,nodes:[]}}},{key:"toString",value:function(){var e=this.generateTree();return s.AsciiTree.generate(e)}}]),e}()},function(e,t,n){var r=n(182),i=n(14),o=Object.prototype,u=o.hasOwnProperty,s=o.propertyIsEnumerable,a=r(function(){return arguments}())?r:function(e){return i(e)&&u.call(e,"callee")&&!s.call(e,"callee")};e.exports=a},function(e,t){var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?n:t)&&("number"==i||"symbol"!=i&&r.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var r=n(76),i=n(35),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var u=e[t];o.call(e,t)&&i(u,n)&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyObservable=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.wrapInObservable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,l.isPromiseLike)(e);return _.create(function(r){var i=void 0;if(n)i=e;else{var o=e(r);i=(0,l.wrapInPromise)(o)}i.then(function(e){n&&r.next(e),t&&r.complete()}).catch(function(e){return r.error(e)})})};var o=f(n(2)),u=n(109),s=n(110),a=n(73),c=f(n(25)),l=n(3);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y={closed:!0,next:function(){},error:function(e){throw e},complete:function(){},status:function(){},presence:function(){}},v=function(e){function t(e,n,r,i,o,u){h(this,t);var s=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=void 0,l=s;return s._parentSubscriber=e,(0,c.default)(n)?a=n:n&&(a=n.next,r=n.error,i=n.complete,n!==y&&(l=Object.create(n),(0,c.default)(l.unsubscribe)&&s.add(l.unsubscribe.bind(l)),l.unsubscribe=s.unsubscribe.bind(s))),s._context=l,s._next=a,s._error=r,s._complete=i,s._status=o,s._presence=u,s}return d(t,s.Subscriber),i(t,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"status",value:function(e){if(!this.isStopped&&this._status){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._status,e)&&this.unsubscribe():this.__tryOrUnsub(this._status,e)}}},{key:"presence",value:function(e){if(!this.isStopped&&this._presence){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._presence,e)&&this.unsubscribe():this.__tryOrUnsub(this._presence,e)}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(e){throw this.error(e),e}}},{key:"__tryOrSetError",value:function(e,t,n){try{t.call(this._context,n)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),t}(),b=function(e){function t(e,n,i,o,u){h(this,t);var a=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));switch(arguments.length){case 0:a.destination=y;break;case 1:if(!1===(0,l.isDefined)(e)){a.destination=y;break}if("object"===(void 0===e?"undefined":r(e))){e instanceof s.Subscriber?(a.destination=e,a.destination.add(a)):(a.syncErrorThrowable=!0,a.destination=new v(a,e));break}default:a.syncErrorThrowable=!0,a.destination=new v(a,e,n,i,o,u)}return a}return d(t,s.Subscriber),i(t,[{key:"status",value:function(e){this.isStopped||this._status(e)}},{key:"presence",value:function(e){this.isStopped||this._presence(e)}},{key:"_status",value:function(e){this.destination.status(e)}},{key:"_presence",value:function(e){this.destination.presence(e)}}]),t}();var _=t.KinveyObservable=function(e){function t(){return h(this,t),p(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,u.Observable),i(t,[{key:"subscribe",value:function(e,t,n,r,i){var o=this.operator,u=function(e,t,n,r,i){if(e){if(e instanceof b)return e;if(e[a.rxSubscriber])return e[a.rxSubscriber]()}return e||t||n||r||i?new b(e,t,n,r,i):new b(y)}(e,t,n,r,i);if(o?o.call(u,this.source):u.add(this._trySubscribe(u)),u.syncErrorThrowable&&(u.syncErrorThrowable=!1,u.syncErrorThrown))throw u.syncErrorValue;return u}},{key:"toPromise",value:function(){var e=this;return new o.default(function(t,n){var r=void 0;e.subscribe(function(e){r=e},n,function(){t(r)})})}}],[{key:"create",value:function(e){return new t(e)}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Aggregation=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=p(n(12)),o=p(n(99)),u=p(n(10)),s=p(n(11)),a=p(n(25)),c=p(n(159)),l=n(1),f=n(3),h=n(15);function p(e){return e&&e.__esModule?e:{default:e}}t.Aggregation=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,i.default)({query:null,initial:{},key:{},reduceFn:function(){}.toString()},t),this.query=t.query,this.initial=t.initial,this.key=t.key,this.reduceFn=t.reduceFn}return r(e,[{key:"by",value:function(e){return this.key[e]=!0,this}},{key:"process",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.toPlainObject(),n=Object.keys(t.key),r=t.reduceFn.replace(/function[\s\S]*?\([\s\S]*?\)/,"");if(t.reduce=new Function(["doc","out"],r),this.query&&(e=this.query.process(e)),n.length>0){var u=[];return n.forEach(function(n){var r={};e.forEach(function(e){var i=e[n],o=(0,f.isDefined)(r[i])?r[i]:(0,c.default)(t.initial),u=t.reduce(e,o);(0,f.isDefined)(u)&&(o=u),r[i]=o}),Object.keys(r).forEach(function(e){var t={};t[n]=e,t=(0,i.default)({},t,r[e]),u.push(t)})}),u}var s=(0,c.default)(t.initial);return(0,o.default)(e,function(e){var n=t.reduce(e,s);(0,f.isDefined)(n)&&(s=n)}),s}},{key:"toPlainObject",value:function(){return{key:this.key,initial:this.initial,reduce:this.reduceFn,reduceFn:this.reduceFn,condition:this.query?this.query.toPlainObject().filter:{},query:this.query?this.query.toPlainObject():null}}},{key:"initial",get:function(){return(0,c.default)(this._initial)},set:function(e){if(!(0,s.default)(e))throw new l.KinveyError("initial must be an Object.");this._initial=e}},{key:"query",get:function(){return this._query},set:function(e){if((0,f.isDefined)(e)&&!(e instanceof h.Query))throw new l.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"reduceFn",get:function(){return this._reduceFn},set:function(e){if((0,a.default)(e)&&(e=e.toString()),!(0,u.default)(e))throw new l.KinveyError("fn argument must be of type function or string.");this._reduceFn=e}}],[{key:"count",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var n=new e;return n.by(t),n.initial={count:0},n.reduceFn="function(doc, out) {  out.count += 1;  return out;}",n}},{key:"sum",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var n=new e;return n.initial={sum:0},n.reduceFn='function(doc, out) {  out.sum += doc["'+t+'"];  return out;}',n}},{key:"min",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var n=new e;return n.initial={min:1/0},n.reduceFn='function(doc, out) {  out.min = Math.min(out.min, doc["'+t+'"]);  return out;}',n}},{key:"max",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var n=new e;return n.initial={max:-1/0},n.reduceFn='function(doc, out) {  out.max = Math.max(out.max, doc["'+t+'"]);  return out;}',n}},{key:"average",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var n=new e;return n.initial={count:0,average:0},n.reduceFn='function(doc, out) {  out.average = (out.average * out.count + doc["'+t+'"]) / (out.count + 1);  out.count += 1;  return out;}',n}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(300);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(130);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(51);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(129);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(367);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,n){var r=n(342),i=n(355),o=n(44),u=n(6),s=n(364);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?u(e)?i(e[0],e[1]):r(e):s(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(55);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(377);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(89);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var s=n(378);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var a=n(382);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,n){var r=n(184),i=n(69),o=n(70),u=o&&o.isTypedArray,s=u?i(u):r;e.exports=s},function(e,t){var n=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(98),i="object"==typeof t&&t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,u=o&&o.exports===i&&r.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e||u&&u.binding&&u.binding("util")}catch(e){}}();e.exports=s}).call(t,n(41)(e))},function(e,t,n){var r=n(104)(Object.getPrototypeOf,Object);e.exports=r},function(e,t,n){"use strict";(function(e){var n="undefined"!=typeof window&&window,r="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i=n||void 0!==e&&e||r;t.root=i,function(){if(!i)throw new Error("RxJS could not find any global context (window, self, global)")}()}).call(t,n(19))},function(e,t,n){"use strict";var r=n(72).root.Symbol;t.rxSubscriber="function"==typeof r&&"function"==typeof r.for?r.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},function(e,t,n){var r=n(23)(n(13),"Map");e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheStore=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=n(12),s=(r=u)&&r.__esModule?r:{default:r},a=n(3),c=n(78),l=n(36),f=n(37),h=n(57),p=n(16);t.CacheStore=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=(0,p.formTaggedCollectionName)(e,r.tag);var i=n||f.processorFactory.getCacheOfflineDataProcessor(),o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,r));return o.ttl=r.ttl||void 0,o.syncManager=h.syncManagerProvider.getSyncManager(),o.useDeltaSet=!0===r.useDeltaSet,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.NetworkStore),i(t,[{key:"removeById",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,a.isDefined)(e)?function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeById",this).call(this,e,n):o.Promise.resolve({count:0})}},{key:"clear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._validateQuery(e);if(n)return n;var r=this._buildOperationObject(l.OperationType.Clear,e);return this._executeOperation(r,t).then(function(e){return{count:e}})}},{key:"pendingSyncCount",value:function(e){return this.syncManager.getSyncItemCountByEntityQuery(this.collection,e)}},{key:"pendingSyncEntities",value:function(e){return this.syncManager.getSyncEntities(this.collection,e)}},{key:"push",value:function(e,t){return this.syncManager.push(this.collection,e,t)}},{key:"pull",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n=(0,s.default)({useDeltaSet:this.useDeltaSet},n),this.syncManager.getSyncItemCountByEntityQuery(this.collection,e).then(function(e){if(e>0){var t=(0,p.getEntitiesPendingPushError)(e,"fetch the entities");return o.Promise.reject(t)}return o.Promise.resolve()}).then(function(){return t.syncManager.pull(t.collection,e,n)})}},{key:"sync",value:function(e,t){var n=this;t=(0,s.default)({useDeltaSet:this.useDeltaSet},t);var r={};return this.push(e,t).then(function(i){return r.push=i,n.pull(e,t)}).then(function(e){return r.pull=e,r})}},{key:"clearSync",value:function(e){return this.syncManager.clearSync(this.collection,e)}}]),t}()},function(e,t,n){var r=n(116);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){var r=n(35),i=n(24),o=n(60),u=n(11);e.exports=function(e,t,n){if(!u(n))return!1;var s=typeof t;return!!("number"==s?i(n)&&o(t,n.length):"string"==s&&t in n)&&r(n[t],e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkStore=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=b(n(10)),u=b(n(6)),s=b(n(12)),a=n(1),c=n(15),l=n(7),f=n(3),h=n(62),p=n(63),d=n(64),y=n(36),v=n(37);function b(e){return e&&e.__esModule?e:{default:e}}t.NetworkStore=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._processor=n||v.processorFactory.getNetworkProcessor(),t&&!(0,o.default)(t))throw new a.KinveyError("Collection must be a string.");this.collection=t,this.client=r.client}return r(e,[{key:"find",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._validateQuery(e);if(n)return(0,h.wrapInObservable)(n);t=(0,s.default)({useDeltaSet:this.useDeltaSet},t);var r=this._buildOperationObject(y.OperationType.Read,e),i=this._executeOperation(r,t);return this._ensureObservable(i)}},{key:"findById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return(0,h.wrapInObservable)(function(e){e.next(void 0)});var n=this._buildOperationObject(y.OperationType.ReadById,null,null,e),r=this._executeOperation(n,t);return this._ensureObservable(r)}},{key:"group",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._validateAggregationQuery(e);if(n)return this._ensureObservable(n);var r=this._buildOperationObject(y.OperationType.Group,e),i=this._executeOperation(r,t);return this._ensureObservable(i)}},{key:"count",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._validateQuery(e);if(n)return(0,h.wrapInObservable)(n);var r=this._buildOperationObject(y.OperationType.Count,e),i=this._executeOperation(r,t);return this._ensureObservable(i)}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return i.Promise.resolve(null);if((0,u.default)(e))return i.Promise.reject(new a.KinveyError("Unable to create an array of entities.","Please create entities one by one."));var n=this._buildOperationObject(y.OperationType.Create,null,e);return this._executeOperation(n,t)}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return i.Promise.resolve(null);if((0,u.default)(e)){var n=new a.KinveyError("Unable to update an array of entities.","Please update entities one by one.");return i.Promise.reject(n)}if(!(0,f.isDefined)(e._id)){return i.Promise.reject(new a.KinveyError("The entity provided does not contain an _id. An _id is required to update the entity.",e))}var r=this._buildOperationObject(y.OperationType.Update,null,e),o=this._executeOperation(r,t);return this._ensurePromise(o)}},{key:"save",value:function(e,t){return e._id?this.update(e,t):this.create(e,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._validateQuery(e);if(n)return n;var r=this._buildOperationObject(y.OperationType.Delete,e),i=this._executeOperation(r,t).then(function(e){return{count:e}});return this._ensurePromise(i)}},{key:"removeById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return i.Promise.resolve(void 0);var n=this._buildOperationObject(y.OperationType.DeleteById,null,null,e);return this._executeOperation(n,t).then(function(e){return{count:e}})}},{key:"subscribe",value:function(e){return(0,d.getLiveCollectionManager)().subscribeCollection(this.collection,e)}},{key:"unsubscribe",value:function(){return(0,d.getLiveCollectionManager)().unsubscribeCollection(this.collection)}},{key:"_validateQuery",value:function(e){return!e||e instanceof c.Query?null:i.Promise.reject(new a.KinveyError("Invalid query. It must be an instance of the Query class."))}},{key:"_validateAggregationQuery",value:function(e){return e instanceof p.Aggregation?null:i.Promise.reject(new a.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class."))}},{key:"_buildOperationObject",value:function(e,t,n,r){return new y.Operation(e,this.collection,t,n,r)}},{key:"_executeOperation",value:function(e,t){return this._processor.process(e,t)}},{key:"_ensureObservable",value:function(e){if((0,f.isPromiseLike)(e))return(0,h.wrapInObservable)(e);if((0,f.isObservable)(e))return e;throw new a.KinveyError("Unexpected result type.")}},{key:"_ensurePromise",value:function(e){if((0,f.isPromiseLike)(e))return e;throw new a.KinveyError("Unexpected result type.")}},{key:"client",get:function(){return(0,f.isDefined)(this._client)?this._client:l.Client.sharedInstance()},set:function(e){e instanceof l.Client?this._client=e:this._client=null}},{key:"pathname",get:function(){var e="/appdata/"+this.client.appKey;return this.collection&&(e=e+"/"+this.collection),e}}]),e}()},function(e,t,n){var r=n(47),i=n(263),o=n(264),u=n(265),s=n(266),a=n(267);function c(e){var t=this.__data__=new r(e);this.size=t.size}c.prototype.clear=i,c.prototype.delete=o,c.prototype.get=u,c.prototype.has=s,c.prototype.set=a,e.exports=c},function(e,t,n){var r=n(268),i=n(275),o=n(277),u=n(278),s=n(279);function a(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}a.prototype.clear=r,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=u,a.prototype.set=s,e.exports=a},function(e,t,n){var r=n(285),i=n(121),o=Object.prototype.propertyIsEnumerable,u=Object.getOwnPropertySymbols,s=u?function(e){return null==e?[]:(e=Object(e),r(u(e),function(t){return o.call(e,t)}))}:i;e.exports=s},function(e,t,n){var r=n(125);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(304),o=(r=i)&&r.__esModule?r:{default:r};t.default={createUUID:function(){return o.default.uuid?o.default.uuid():(0,o.default)()}},e.exports=t.default},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,u,s,a,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),u=(c=n.slice()).length,a=0;a<u;a++)c[a].apply(this,s);return!0},n.prototype.addListener=function(e,t){var u;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(u=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&u>0&&this._events[e].length>u&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,u,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(u=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=u;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){var r=n(6),i=n(86),o=n(357),u=n(360);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(u(e))}},function(e,t,n){var r=n(6),i=n(45),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||u.test(e)||!o.test(e)||null!=t&&e in Object(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineDataProcessor=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0},u=n(2),s=n(53),a=(r=s)&&r.__esModule?r:{default:r},c=n(36),l=n(17),f=n(142),h=n(16),p=n(3),d=n(56);t.OfflineDataProcessor=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._syncManager=e,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.DataProcessor),i(t,[{key:"process",value:function(e,n){return e.type===c.OperationType.Clear?this._processClear(e.collection,e.query,n):o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this,e,n)}},{key:"_getRepository",value:function(){return this._repoPromise||(this._repoPromise=l.repositoryProvider.getOfflineRepository()),this._repoPromise}},{key:"_deleteEntityAndHandleOfflineState",value:function(e,n,r){var i=this;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processDeleteById",this).call(this,e,n._id,r).then(function(t){return t?i._syncManager.addDeleteEvent(e,n).then(function(){return t}):t})}},{key:"_deleteEntitiesAndHandleOfflineState",value:function(e,n,r,i){var u=this;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processDelete",this).call(this,e,r,i).then(function(t){return u._syncManager.addDeleteEvent(e,n).then(function(){return t})})}},{key:"_processUpdate",value:function(e,n,r){var i=this;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processUpdate",this).call(this,e,n,r).then(function(t){return i._syncManager.addUpdateEvent(e,t).then(function(){return t})})}},{key:"_processClear",value:function(e,t,n){var r=this;return this._syncManager.clearSync(e,t).then(function(){return(0,d.clearQueryCache)(e)}).then(function(){return r._getRepository()}).then(function(r){return r.delete(e,t,n)})}},{key:"_processDelete",value:function(e,t,n){var r=this;return this._getRepository().then(function(r){return r.read(e,t,n)}).then(function(i){return(0,h.isEmpty)(i)?u.Promise.resolve(0):r._deleteEntitiesAndHandleOfflineState(e,i,t,n)})}},{key:"_processCreate",value:function(e,n,r){var i=this;return n=this._addMetadataToEntities(n),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCreate",this).call(this,e,n,r).then(function(t){return i._syncManager.addCreateEvent(e,t).then(function(){return t})})}},{key:"_processDeleteById",value:function(e,t,n){var r=this;return this._getRepository().then(function(n){return n.readById(e,t)}).then(function(t){return r._deleteEntityAndHandleOfflineState(e,t,n)})}},{key:"_addOfflineMetadataToEntity",value:function(e){var t=e._kmd||{};t.local=!0,e._kmd=t,e._id=(0,h.generateEntityId)()}},{key:"_addMetadataToEntities",value:function(e){var t=this,n=!Array.isArray(e),r=(0,p.ensureArray)(e).map(function(e){return(0,p.isDefined)(e._id)||(e=(0,a.default)(e),t._addOfflineMetadataToEntity(e)),e});return n?r[0]:r}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Repository=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"_throwNotImplementedError",value:function(){throw new Error("Repository class abstract method not implemented")}},{key:"create",value:function(e,t){this._throwNotImplementedError(t)}},{key:"read",value:function(e,t){this._throwNotImplementedError(t)}},{key:"readById",value:function(e,t){this._throwNotImplementedError(t)}},{key:"count",value:function(e,t){this._throwNotImplementedError(t)}},{key:"update",value:function(e,t){this._throwNotImplementedError(t)}},{key:"delete",value:function(e,t){this._throwNotImplementedError(t)}},{key:"deleteById",value:function(e,t){this._throwNotImplementedError(t)}},{key:"group",value:function(e,t){this._throwNotImplementedError(t)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyValueStorePersister=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(7),u=n(1),s=n(55);t.KeyValueStorePersister=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.KeyValuePersister),r(t,[{key:"readEntity",value:function(e,t){var n=this;return this._readEntityFromPersistance(e,t).then(function(r){return r||i.Promise.reject(n._getEntityNotFoundError(e,t))})}},{key:"writeEntities",value:function(e,t){var n=this;return this._writeEntitiesToPersistance(e,t).then(function(){return n._invalidateCache(e),!0})}},{key:"deleteEntity",value:function(e,t){var n=this;return this._deleteEntityFromPersistance(e,t).then(function(r){return n._invalidateCache(e),0===r?i.Promise.reject(n._getEntityNotFoundError(e,t)):!(r>1)||i.Promise.reject(new u.KinveyError("Delete by id matched more than one entity"))})}},{key:"_readEntityFromPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_writeEntitiesToPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_deleteEntityFromPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_getEntityNotFoundError",value:function(e,t){return new u.NotFoundError("An entity with _id = "+t+" was not found in the "+e+" collection on the "+this._storeName+" database.")}},{key:"_storeName",get:function(){return o.Client.sharedInstance().appKey}}]),t}()},function(e,t,n){"use strict";var r=n(391),i=n(392),o=n(152);e.exports={formats:o,parse:i,stringify:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyResponse=t.Response=t.StatusCode=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(12),u=(r=o)&&r.__esModule?r:{default:r},s=n(42),a=n(1);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=t.StatusCode={Ok:200,Created:201,Empty:204,MovedPermanently:301,Found:302,NotModified:304,TemporaryRedirect:307,PermanentRedirect:308,Unauthorized:401,Forbidden:403,NotFound:404,ServerError:500};Object.freeze(l);var f=t.Response=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),t=(0,u.default)({statusCode:l.Empty,headers:new s.Headers,data:null},t),this.statusCode=t.statusCode,this.headers=t.headers,this.data=t.data}return i(e,[{key:"isSuccess",value:function(){return this.statusCode>=200&&this.statusCode<300||this.statusCode===l.MovedPermanently||this.statusCode===l.Found||this.statusCode===l.NotModified||this.statusCode===l.TemporaryRedirect||this.statusCode===l.PermanentRedirect}},{key:"isServerError",value:function(){return this.statusCode>=500&&this.statusCode<600}},{key:"isClientError",value:function(){return this.statusCode>=400&&this.statusCode<500}},{key:"toPlainObject",value:function(){return{statusCode:this.statusCode,headers:this.headers.toPlainObject(),data:this.data}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof s.Headers||(e=new s.Headers(e)),this._headers=e}},{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},t=e.message||e.description,n=e.debug,r=this.statusCode,i=this.headers.get("X-Kinvey-Request-ID");return r===l.Unauthorized?new a.InsufficientCredentialsError(t,n,r,i):r===l.NotFound?new a.NotFoundError(t,n,r,i):r===l.ServerError?new a.ServerError(t,n,r,i):new a.KinveyError(t,n,r,i)}}]),e}();t.KinveyResponse=function(e){function t(){return c(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f),i(t,[{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},n=e.name||e.error,r=e.message||e.description,i=e.debug,o=this.statusCode,u=this.headers.get("X-Kinvey-Request-ID"),s=void 0;if("APIVersionNotAvailable"===n)s=new a.APIVersionNotAvailableError(r,i,o,u);else if("APIVersionNotImplemented"===n)s=new a.APIVersionNotImplementedError(r,i,o,u);else if("AppProblem"===n)s=new a.AppProblemError(r,i,o,u);else if("AppProblem"===n)s=new a.AppProblemError(r,i,o,u);else if("BadRequest"===n)s=new a.BadRequestError(r,i,o,u);else if("BLInternalError"===n||"BLRuntimeError"===n||"BLSyntaxError"===n||"BLTimeoutError"===n||"BLViolationError"===n)s=new a.BLError(r,i,o,u);else if("CORSDisabled"===n)s=new a.CORSDisabledError(r,i,o,u);else if("DuplicateEndUsers"===n)s=new a.DuplicateEndUsersError(r,i,o,u);else if("FeatureUnavailable"===n)s=new a.FeatureUnavailableError(r,i,o,u);else if("IncompleteRequestBody"===n)s=new a.IncompleteRequestBodyError(r,i,o,u);else if("IndirectCollectionAccessDisallowed"===n)s=new a.IndirectCollectionAccessDisallowedError(r,i,o,u);else if("InsufficientCredentials"===n)s=new a.InsufficientCredentialsError(r,i,o,u);else if("InvalidCredentials"===n)s=new a.InvalidCredentialsError(r,i,o,u);else if("InvalidIdentifier"===n)s=new a.InvalidIdentifierError(r,i,o,u);else if("InvalidQuerySyntax"===n)s=new a.InvalidQuerySyntaxError(r,i,o,u);else if("JSONParseError"===n)s=new a.JSONParseError(r,i,o,u);else if("KinveyInternalErrorRetry"===n)s=new a.KinveyInternalErrorRetry(r,i,o,u);else if("KinveyInternalErrorStop"===n)s=new a.KinveyInternalErrorStop(r,i,o,u);else if("MissingQuery"===n)s=new a.MissingQueryError(r,i,o,u);else if("MissingRequestHeader"===n)s=new a.MissingRequestHeaderError(r,i,o,u);else if("MissingRequestParameter"===n)s=new a.MissingRequestParameterError(r,i,o,u);else if("MissingConfiguration"===n)s=new a.MissingConfigurationError(r,i,o,u);else if("EntityNotFound"===n||"CollectionNotFound"===n||"AppNotFound"===n||"UserNotFound"===n||"BlobNotFound"===n||"DocumentNotFound"===n)s=new a.NotFoundError(r,i,o,u);else if("ParameterValueOutOfRange"===n)s=new a.ParameterValueOutOfRangeError(r,i,o,u);else if("ResultSetSizeExceeded"===n)s=new a.ResultSetSizeExceededError(r,i,o,u);else if("ServerError"===n)s=new a.ServerError(r,i,o,u);else if("StaleRequest"===n)s=new a.StaleRequestError(r,i,o,u);else if("UserAlreadyExists"===n)s=new a.UserAlreadyExistsError(r,i,o,u);else{if("WritesToCollectionDisallowed"!==n)return function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"error",this);s=new a.WritesToCollectionDisallowedError(r,i,o,u)}return s}}]),t}()},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},function(e,t,n){var r=n(85),i=n(40);e.exports=function(e,t){for(var n=0,o=(t=r(t,e)).length;null!=e&&n<o;)e=e[i(t[n++])];return n&&n==o?e:void 0}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(97);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(168);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=t.SocialIdentity={Kinvey:"kinvey",MobileIdentityConnect:"kinveyAuth"};Object.freeze(r)},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,n(19))},function(e,t,n){var r=n(100),i=n(39),o=n(105),u=n(6);e.exports=function(e,t){return(u(e)?r:i)(e,o(t))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},function(e,t,n){var r=n(102),i=n(59),o=n(6),u=n(43),s=n(60),a=n(67),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),l=!n&&i(e),f=!n&&!l&&u(e),h=!n&&!l&&!f&&a(e),p=n||l||f||h,d=p?r(e.length,String):[],y=d.length;for(var v in e)!t&&!c.call(e,v)||p&&("length"==v||f&&("offset"==v||"parent"==v)||h&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,y))||d.push(v);return d}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(32),i=n(185),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var r=n(44);e.exports=function(e){return"function"==typeof e?e:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isDefined=s,t.isNumber=function(e){return!Number.isNaN(parseFloat(e))&&Number.isFinite(e)},t.nested=function(e,t,n){if(!1===s(t))return e=n||e;var r=t.split("."),i=r.shift();for(;i&&e;)e=e[i],i=r.shift();return n||e},t.keyBy=function(e,t){if(!e)return{};return e.reduce(function(e,n){return e[t]=n[t],e},{})},t.isEmpty=function(e){return!s(e)||!(e.length>0)&&(0===e.length||"object"!==(void 0===e?"undefined":r(e))||Object.keys(e).reduce(function(t,n){return!!t&&!Object.hasOwnProperty.call(e,n)},!0))};var i=u(n(187)),o=u(n(188));function u(e){return e&&e.__esModule?e:{default:e}}function s(e){return!1===(0,o.default)(e)&&!1===(0,i.default)(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueue=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r},s=n(108);t.PromiseQueue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pendingPromises=0,this.maxPendingPromises=t,this.maxQueuedPromises=n,this.queue=[]}return i(e,[{key:"enqueue",value:function(e){var t=this;return new u.default(function(n,r,i){t.queue.length>=t.maxQueuedPromises?r(new Error("Queue limit reached")):(t.queue.push({promiseGenerator:e,resolve:n,reject:r,notify:i||s.noop}),t._dequeue())})}},{key:"getPendingLength",value:function(){return this.pendingPromises}},{key:"getQueueLength",value:function(){return this.queue.length}},{key:"_dequeue",value:function(){var e=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var t=this.queue.shift();if(!t)return!1;try{this.pendingPromises+=1,(0,s.wrapInPromise)(t.promiseGenerator()).then(function(n){e.pendingPromises-=1,t.resolve(n),e._dequeue()},function(n){e.pendingPromises-=1,t.reject(n),e._dequeue()},function(e){t.notify(e)})}catch(e){this.pendingPromises-=1,t.reject(e),this._dequeue()}return!0}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.activeUserKey=void 0,t.noop=function(){},t.isPromiseLike=p,t.isObservable=function(e){return e instanceof i.Observable},t.wrapInPromise=function(e){if(p(e))return e;return r.Promise.resolve(e)},t.useIfDefined=d,t.ensureArray=y,t.isValidStorageProviderValue=function(e){var t=a.repositoryProvider.getSupportedStorages(),n=y(e);return!!e&&n.length&&n.every(function(e){return t.some(function(t){return e===t})})},t.forEachAsync=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,i=new c.PromiseQueue(n);return function(e,t){var n=0,i=e.length;if((0,o.default)(e))return r.Promise.resolve();return new r.Promise(function(r){var o=function(){(n+=1)===i&&r()};e.forEach(function(e){t(e).then(o).catch(o)})})}(e,function(e){return i.enqueue(function(){return t(e)})})},t.splitQueryIntoPages=function(e,t,n){if(!(0,s.default)(t)||!(0,s.default)(n))throw new f.KinveyError("Invalid page size or expected entity count parameter");var r=Math.ceil(n/t);return(0,u.default)(r,function(r){var i=new l.Query(e);return i.skip=e.skip+r*t,i.limit=Math.min(n-r*t,t),i})};var r=n(2),i=n(109),o=h(n(27)),u=h(n(115)),s=h(n(31)),a=n(26),c=n(107),l=n(15),f=n(1);function h(e){return e&&e.__esModule?e:{default:e}}t.activeUserKey="active_user";function p(e){return!!e&&"function"==typeof e.then&&"function"==typeof e.catch}function d(e,t){return void 0!==e?e:t}function y(e){return e=d(e,[]),Array.isArray(e)?e:[e]}},function(e,t,n){"use strict";var r=n(72),i=n(189),o=n(195),u=n(196),s=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,o=i.toSubscriber(e,t,n);if(r?r.call(o,this.source):o.add(this.source||!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var n=this;if(t||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?t=r.root.Rx.config.Promise:r.root.Promise&&(t=r.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,r){var i;i=n.subscribe(function(t){if(i)try{e(t)}catch(e){r(e),i.unsubscribe()}else e(t)},r,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[o.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:u.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(r.root.Rx&&r.root.Rx.config&&r.root.Rx.config.Promise?e=r.root.Rx.config.Promise:r.root.Promise&&(e=r.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();t.Observable=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=n(111),o=n(190),u=n(113),s=n(73),a=function(e){function t(t,n,r){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=u.empty;break;case 1:if(!t){this.destination=u.empty;break}if("object"==typeof t){if(l(t)){var i=t[s.rxSubscriber]();this.syncErrorThrowable=i.syncErrorThrowable,this.destination=i,i.add(this)}else this.syncErrorThrowable=!0,this.destination=new c(this,t);break}default:this.syncErrorThrowable=!0,this.destination=new c(this,t,n,r)}}return r(t,e),t.prototype[s.rxSubscriber]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(o.Subscription);t.Subscriber=a;var c=function(e){function t(t,n,r,o){var s;e.call(this),this._parentSubscriber=t;var a=this;i.isFunction(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==u.empty&&(a=Object.create(n),i.isFunction(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=s,this._error=r,this._complete=o}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,n){try{t.call(this._context,n)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(a);function l(e){return e instanceof a||"syncErrorThrowable"in e&&e[s.rxSubscriber]}},function(e,t,n){"use strict";t.isFunction=function(e){return"function"==typeof e}},function(e,t,n){"use strict";t.errorObject={e:{}}},function(e,t,n){"use strict";t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(102),i=n(105),o=n(206),u=9007199254740991,s=4294967295,a=Math.min;e.exports=function(e,t){if((e=o(e))<1||e>u)return[];var n=s,c=a(e,s);t=i(t),e-=s;for(var l=r(c,t);++n<e;)t(n);return l}},function(e,t,n){var r=n(23),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},function(e,t,n){var r=n(118),i=n(77);e.exports=function(e){return r(function(t,n){var r=-1,o=n.length,u=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(u=e.length>3&&"function"==typeof u?(o--,u):void 0,s&&i(n[0],n[1],s)&&(u=o<3?void 0:u,o=1),t=Object(t);++r<o;){var a=n[r];a&&e(t,a,r,u)}return t})}},function(e,t,n){var r=n(44),i=n(157),o=n(158);e.exports=function(e,t){return o(i(e,t,r),e+"")}},function(e,t,n){var r=n(118),i=n(35),o=n(77),u=n(46),s=Object.prototype,a=s.hasOwnProperty,c=r(function(e,t){e=Object(e);var n=-1,r=t.length,c=r>2?t[2]:void 0;for(c&&o(t[0],t[1],c)&&(r=1);++n<r;)for(var l=t[n],f=u(l),h=-1,p=f.length;++h<p;){var d=f[h],y=e[d];(void 0===y||i(y,s[d])&&!a.call(e,d))&&(e[d]=l[d])}return e});e.exports=c},function(e,t,n){var r=n(79),i=n(100),o=n(61),u=n(280),s=n(281),a=n(282),c=n(283),l=n(284),f=n(286),h=n(123),p=n(287),d=n(34),y=n(288),v=n(289),b=n(294),_=n(6),g=n(43),m=n(296),w=n(11),O=n(298),k=n(22),P=1,E=2,j=4,S="[object Arguments]",C="[object Function]",M="[object GeneratorFunction]",T="[object Object]",A={};A[S]=A["[object Array]"]=A["[object ArrayBuffer]"]=A["[object DataView]"]=A["[object Boolean]"]=A["[object Date]"]=A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Map]"]=A["[object Number]"]=A[T]=A["[object RegExp]"]=A["[object Set]"]=A["[object String]"]=A["[object Symbol]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A["[object Error]"]=A[C]=A["[object WeakMap]"]=!1,e.exports=function e(t,n,x,R,I,N){var q,D=n&P,U=n&E,K=n&j;if(x&&(q=I?x(t,R,I,N):x(t)),void 0!==q)return q;if(!w(t))return t;var L=_(t);if(L){if(q=y(t),!D)return c(t,q)}else{var F=d(t),B=F==C||F==M;if(g(t))return a(t,D);if(F==T||F==S||B&&!I){if(q=U||B?{}:b(t),!D)return U?f(t,s(q,t)):l(t,u(q,t))}else{if(!A[F])return I?t:{};q=v(t,F,D)}}N||(N=new r);var G=N.get(t);if(G)return G;if(N.set(t,q),O(t))return t.forEach(function(r){q.add(e(r,n,x,r,t,N))}),q;if(m(t))return t.forEach(function(r,i){q.set(i,e(r,n,x,i,t,N))}),q;var H=K?U?p:h:U?keysIn:k,z=L?void 0:H(t);return i(z||t,function(r,i){z&&(r=t[i=r]),o(q,i,e(r,n,x,i,t,N))}),q}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(92),i=n(71),o=n(81),u=n(121),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:u;e.exports=s},function(e,t,n){var r=n(124),i=n(81),o=n(22);e.exports=function(e){return r(e,o,i)}},function(e,t,n){var r=n(92),i=n(6);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},function(e,t,n){var r=n(13).Uint8Array;e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(o(n(29)),o(n(305)));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var n=t.config;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=n,this._iv="0123456789012345",this._allowedKeyEncodings=["hex","utf8","base64","binary"],this._allowedKeyLengths=[128,256],this._allowedModes=["ecb","cbc"],this._defaultOptions={encryptKey:!0,keyEncoding:"utf8",keyLength:256,mode:"cbc"}}return r(e,[{key:"HMACSHA256",value:function(e){return i.default.HmacSHA256(e,this._config.secretKey).toString(i.default.enc.Base64)}},{key:"SHA256",value:function(e){return i.default.SHA256(e).toString(i.default.enc.Hex)}},{key:"_parseOptions",value:function(e){var t=e||{};return t.hasOwnProperty("encryptKey")||(t.encryptKey=this._defaultOptions.encryptKey),t.hasOwnProperty("keyEncoding")||(t.keyEncoding=this._defaultOptions.keyEncoding),t.hasOwnProperty("keyLength")||(t.keyLength=this._defaultOptions.keyLength),t.hasOwnProperty("mode")||(t.mode=this._defaultOptions.mode),-1===this._allowedKeyEncodings.indexOf(t.keyEncoding.toLowerCase())&&(t.keyEncoding=this._defaultOptions.keyEncoding),-1===this._allowedKeyLengths.indexOf(parseInt(t.keyLength,10))&&(t.keyLength=this._defaultOptions.keyLength),-1===this._allowedModes.indexOf(t.mode.toLowerCase())&&(t.mode=this._defaultOptions.mode),t}},{key:"_decodeKey",value:function(e,t){return"base64"===t.keyEncoding?i.default.enc.Base64.parse(e):"hex"===t.keyEncoding?i.default.enc.Hex.parse(e):e}},{key:"_getPaddedKey",value:function(e,t){return e=this._decodeKey(e,t),t.encryptKey?i.default.enc.Utf8.parse(this.SHA256(e).slice(0,32)):e}},{key:"_getMode",value:function(e){return"ecb"===e.mode?i.default.mode.ECB:i.default.mode.CBC}},{key:"_getIV",value:function(e){return"cbc"===e.mode?i.default.enc.Utf8.parse(this._iv):null}},{key:"encrypt",value:function(e,t,n){return this._config.customEncrypt?this._config.customEncrypt(e):this.pnEncrypt(e,t,n)}},{key:"decrypt",value:function(e,t,n){return this._config.customDecrypt?this._config.customDecrypt(e):this.pnDecrypt(e,t,n)}},{key:"pnEncrypt",value:function(e,t,n){if(!t&&!this._config.cipherKey)return e;n=this._parseOptions(n);var r=this._getIV(n),o=this._getMode(n),u=this._getPaddedKey(t||this._config.cipherKey,n);return i.default.AES.encrypt(e,u,{iv:r,mode:o}).ciphertext.toString(i.default.enc.Base64)||e}},{key:"pnDecrypt",value:function(e,t,n){if(!t&&!this._config.cipherKey)return e;n=this._parseOptions(n);var r=this._getIV(n),o=this._getMode(n),u=this._getPaddedKey(t||this._config.cipherKey,n);try{var s=i.default.enc.Base64.parse(e),a=i.default.AES.decrypt({ciphertext:s},u,{iv:r,mode:o}).toString(i.default.enc.Utf8);return JSON.parse(a)}catch(e){return null}}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(n(4),n(52)),u=(r=o)&&r.__esModule?r:{default:r};var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._listeners=[]}return i(e,[{key:"addListener",value:function(e){this._listeners.push(e)}},{key:"removeListener",value:function(e){var t=[];this._listeners.forEach(function(n){n!==e&&t.push(n)}),this._listeners=t}},{key:"removeAllListeners",value:function(){this._listeners=[]}},{key:"announcePresence",value:function(e){this._listeners.forEach(function(t){t.presence&&t.presence(e)})}},{key:"announceStatus",value:function(e){this._listeners.forEach(function(t){t.status&&t.status(e)})}},{key:"announceMessage",value:function(e){this._listeners.forEach(function(t){t.message&&t.message(e)})}},{key:"announceNetworkUp",value:function(){var e={};e.category=u.default.PNNetworkUpCategory,this.announceStatus(e)}},{key:"announceNetworkDown",value:function(){var e={};e.category=u.default.PNNetworkDownCategory,this.announceStatus(e)}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNTimeOperation},t.getURL=function(){return"/time/0"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.prepareParams=function(){return{}},t.isAuthSupported=function(){return!1},t.handleResponse=function(e,t){return{timetoken:t[0]}},t.validateParams=function(){};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PubNubListener=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(84);t.PubNubListener=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EventEmitter),r(t,[{key:"message",value:function(e){this.emit(e.channel,e.message)}},{key:"status",value:function(e){var n=this,r=this._getEventNamesFromStatus(e.affectedChannels,e.affectedChannelGroups);r.length?r.forEach(function(r){n.emit(""+t.statusPrefix+r,e)}):this.emit(t.unclassifiedEvents,e)}},{key:"_getEventNamesFromStatus",value:function(e,t){var n=t||[];return(e||[]).concat(n)}}],[{key:"statusPrefix",get:function(){return"status:"}},{key:"unclassifiedEvents",get:function(){return"pubNubEventsNotRouted"}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(338);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(131);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamACL=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=a(n(6)),o=a(n(339)),u=n(1),s=n(3);function a(e){return e&&e.__esModule?e:{default:e}}t.StreamACL=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.publishers=[],this.subscribers=[],this.publisherGroups=[],this.subscriberGroups=[],t&&(t instanceof e&&(t=t.toPlainObject()),this._parsePlainObject(t))}return r(e,[{key:"addPublishers",value:function(e){return this._addToAcl(this.publishers,e),this}},{key:"addSubscribers",value:function(e){return this._addToAcl(this.subscribers,e),this}},{key:"addPublisherGroups",value:function(e){return this._addToAcl(this.publisherGroups,e),this}},{key:"addSubscriberGroups",value:function(e){return this._addToAcl(this.subscriberGroups,e),this}},{key:"removePublishers",value:function(e){return this._removeFromAcl(this.publishers,e),this}},{key:"removeSubscribers",value:function(e){return this._removeFromAcl(this.subscribers,e),this}},{key:"removePublisherGroups",value:function(e){return this._removeFromAcl(this.publisherGroups,e),this}},{key:"removeSubscriberGroups",value:function(e){return this._removeFromAcl(this.subscriberGroups,e),this}},{key:"isNotEmpty",value:function(){return this.publishers.length||this.subscribers.length||this.publisherGroups.length||this.subscriberGroups.length}},{key:"toPlainObject",value:function(){var e={};return this.subscribers.length&&(e.subscribe=this.subscribers.slice(0)),this.publishers.length&&(e.publish=this.publishers.slice(0)),this.subscriberGroups.length&&(e.groups=e.groups||{},e.groups.subscribe=this.addSubscriberGroups.slice(0)),this.publisherGroups.length&&(e.groups=e.groups||{},e.groups.publish=this.publisherGroups.slice(0)),e}},{key:"_parsePlainObject",value:function(e){e.subscribe&&(this.subscribers=this._ensureValidIdArray(e.subscribe)),e.publish&&(this.publishers=this._ensureValidIdArray(e.publish)),e.groups&&(e.groups.publish&&(this.publisherGroups=this._ensureValidIdArray(e.groups.publish)),e.groups.subscribe&&(this.subscriberGroups=this._ensureValidIdArray(e.groups.subscribe)))}},{key:"_ensureValidIdArray",value:function(e){if(!this._isValidIdArray(e))throw new u.KinveyError("Invalid ACL object value");return e}},{key:"_isValidIdArray",value:function(e){var t=this;return(0,i.default)(e)&&(0,o.default)(e,function(e){var n=t._getAsId(e);return(0,s.isNonemptyString)(n)})}},{key:"_addToAcl",value:function(e,t){var n=this,r=(0,i.default)(t)?t:[t];if(!this._isValidIdArray(r))throw new u.KinveyError("Invalid ACL object value");r.forEach(function(t){var r=n._getAsId(t);e.push(r)})}},{key:"_removeFromAcl",value:function(e,t){var n=this;((0,i.default)(t)?t:[t]).forEach(function(t){var r=n._getAsId(t),i=e.indexOf(r);i>=0&&e.splice(i,1)})}},{key:"_getAsId",value:function(e){return e&&e._id?e._id:e}}],[{key:"isValidACLObject",value:function(t){try{return new e(t).isNotEmpty()}catch(e){return!1}}}]),e}()},function(e,t,n){var r=n(344),i=n(14);e.exports=function e(t,n,o,u,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,u,e,s))}},function(e,t,n){var r=n(345),i=n(348),o=n(349),u=1,s=2;e.exports=function(e,t,n,a,c,l){var f=n&u,h=e.length,p=t.length;if(h!=p&&!(f&&p>h))return!1;var d=l.get(e);if(d&&l.get(t))return d==t;var y=-1,v=!0,b=n&s?new r:void 0;for(l.set(e,t),l.set(t,e);++y<h;){var _=e[y],g=t[y];if(a)var m=f?a(g,_,y,t,e,l):a(_,g,y,e,t,l);if(void 0!==m){if(m)continue;v=!1;break}if(b){if(!i(t,function(e,t){if(!o(b,t)&&(_===e||c(_,e,n,a,l)))return b.push(t)})){v=!1;break}}else if(_!==g&&!c(_,g,n,a,l)){v=!1;break}}return l.delete(e),l.delete(t),v}},function(e,t,n){var r=n(11);e.exports=function(e){return e==e&&!r(e)}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheOfflineDataProcessor=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0},u=n(2),s=n(53),a=(r=s)&&r.__esModule?r:{default:r},c=n(15),l=n(1),f=n(87),h=n(3),p=n(62),d=n(16),y=n(143),v=n(56);t.CacheOfflineDataProcessor=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._networkRepository=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.OfflineDataProcessor),i(t,[{key:"_deleteEntityAndHandleOfflineState",value:function(e,n,r){var i=this;if((0,d.isLocalEntity)(n))return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_deleteEntityAndHandleOfflineState",this).call(this,e,n,r);return this._attemptDeleteByIdOverNetwork(e,n._id,r).then(function(t){return t?i._syncManager.removeSyncItemForEntityId(e,n._id).then(function(){return i._getRepository()}).then(function(t){return t.deleteById(e,n._id,r)}):i._syncManager.addDeleteEvent(e,n).then(function(){return 0})})}},{key:"_processDelete",value:function(e,t,n){var r=this,i=void 0;return this._attemptDeleteOverNetwork(e,t,n).then(function(e){return i=e,r._getRepository()}).then(function(r){return r.read(e,t,n)}).then(function(o){return(0,d.isEmpty)(o)?0:i?r._deleteEntitiesOffline(e,t,o,n):r._syncManager.addDeleteEvent(e,o).then(function(){return 0})})}},{key:"_processCreate",value:function(e,n,r){var i=this,u=void 0;return n=(0,a.default)(n),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCreate",this).call(this,e,n,r).then(function(t){return u=t,i._networkRepository.create(e,n,r)}).then(function(t){return i._replaceNetworkEntityOffline(e,u._id,t).then(function(){return i._syncManager.removeSyncItemForEntityId(e,u._id)}).then(function(){return t})})}},{key:"_processRead",value:function(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=void 0,a=i.useDeltaSet;return(0,p.wrapInObservable)(function(f){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processRead",r).call(r,e,n,i).then(function(t){return s=t,f.next(s),r._ensureCountBeforeRead(e,"fetch the entities",n)}).then(function(){return a?(0,y.deltaSet)(e,n,i).catch(function(t){if(t instanceof l.InvalidCachedQuery)return a=!1,(0,v.getCachedQuery)(e,n).then(function(e){return(0,v.deleteCachedQuery)(e)}).catch(function(e){if(e instanceof l.NotFoundError)return null;throw e}).then(function(){return r._networkRepository.read(e,n,Object.assign(i,{dataOnly:!1}))});throw t}):r._networkRepository.read(e,n,Object.assign(i,{dataOnly:!1}))}).then(function(t){return(0,v.getCachedQuery)(e,n).then(function(e){return e&&t.headers?(e.lastRequest=t.headers.requestStart,(0,v.updateCachedQuery)(e)):null}).then(function(){return t.data?t.data:t})}).then(function(t){if(a){var n=[];if(t.deleted.length>0){var i=new c.Query;i.contains("_id",t.deleted.map(function(e){return e._id})),n.push(r._deleteEntitiesOffline(e,i,t.deleted))}return t.changed.length>0&&n.push(r._replaceOfflineEntities(e,t.changed,t.changed)),u.Promise.all(n)}return r._replaceOfflineEntities(e,s,t)}).then(function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processRead",r).call(r,e,n,i)}).then(function(e){return f.next(e),e})})}},{key:"_processReadById",value:function(e,n,r){var i=this,u=void 0;return(0,p.wrapInObservable)(function(s){var a=(new c.Query).equalTo("_id",n);return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processReadById",i).call(i,e,n,r).catch(function(e){return i._catchNotFoundError(e)}).then(function(t){return s.next(t),u=t,i._ensureCountBeforeRead(e,"find the entity",a)}).then(function(){return i._networkRepository.readById(e,n,r)}).then(function(t){return s.next(t),i._replaceOfflineEntities(e,u,(0,h.ensureArray)(t))})})}},{key:"_processUpdate",value:function(e,n,r){var i=this;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processUpdate",this).call(this,e,n,r).then(function(){return i._networkRepository.update(e,n,r)}).then(function(t){return i._getRepository().then(function(n){return n.update(e,t,r)}).then(function(){return i._syncManager.removeSyncItemForEntityId(e,t._id)}).then(function(){return t})})}},{key:"_processCount",value:function(e,n,r){var i=this;return(0,p.wrapInObservable)(function(u){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCount",i).call(i,e,n,r).then(function(t){return u.next(t),i._networkRepository.count(e,n,r)}).then(function(e){return u.next(e)})})}},{key:"_processGroup",value:function(e,n,r){var i=this;return(0,p.wrapInObservable)(function(u){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processGroup",i).call(i,e,n,r).catch(function(){return[]}).then(function(t){return u.next(t),i._networkRepository.group(e,n,r)}).then(function(e){return u.next(e)})})}},{key:"_replaceNetworkEntityOffline",value:function(e,t,n){return this._getRepository().then(function(r){var i=u.Promise.resolve();return t&&(i=r.deleteById(e,t)),i.then(function(){return r.create(e,n)})})}},{key:"_replaceOfflineEntities",value:function(e,t,n){var r=this,i=u.Promise.resolve(),o=(0,h.ensureArray)(t);if(t&&(0,d.isNotEmpty)(o)){var s=(new c.Query).contains("_id",o.map(function(e){return e._id}));i=this._getRepository().then(function(t){return t.delete(e,s)})}return i.then(function(){return r._getRepository()}).then(function(t){return t.create(e,n)})}},{key:"_attemptDeleteByIdOverNetwork",value:function(e,t,n){var r=this;return new u.Promise(function(i){return r._networkRepository.deleteById(e,t,n).then(function(){return i(!0)}).catch(function(e){e instanceof l.NotFoundError?i(!0):i(!1)})})}},{key:"_attemptDeleteOverNetwork",value:function(e,t,n){var r=this;return new u.Promise(function(i){r._networkRepository.delete(e,t,n).then(function(){return i(!0)}).catch(function(){return i(!1)})})}},{key:"_deleteEntitiesOffline",value:function(e,t,n,r){var i=this;return this._getRepository().then(function(n){return n.delete(e,t,r)}).then(function(t){return i._syncManager.removeSyncItemsForIds(e,n.map(function(e){return e._id})).then(function(){return t})})}},{key:"_ensureCountBeforeRead",value:function(e,t,n){return this._syncManager.getSyncItemCountByEntityQuery(e,n).then(function(e){return 0===e?e:u.Promise.reject((0,d.getEntitiesPendingPushError)(e,t))})}},{key:"_catchNotFoundError",value:function(e){if(!(e instanceof l.NotFoundError))return u.Promise.reject(e)}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StorageProvider={Memory:"Memory",WebSQL:"WebSQL",IndexedDB:"IndexedDB",LocalStorage:"LocalStorage",SessionStorage:"SessionStorage",SQLite:"SQLite"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(139);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(376);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InmemoryOfflineRepository=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=n(370),s=(r=u)&&r.__esModule?r:{default:r},a=n(1),c=n(140),l=n(54),f=n(3);t.InmemoryOfflineRepository=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._persister=e,r._queue=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.OfflineRepository),i(t,[{key:"create",value:function(e,t){var n=this;return this._enqueueCrudOperation(e,function(){return n._create(e,t).then(function(){return t})})}},{key:"read",value:function(e,t){return this._readAll(e).then(function(e){return t?(0,l.applyQueryToDataset)(e,t):e})}},{key:"readById",value:function(e,t){return this._readAll(e).then(function(n){var r=n.find(function(e){return e._id===t});if(!r){var i="An entity with id "+t+' was not found in the collection "'+e+'"';return o.Promise.reject(new a.NotFoundError(i))}return r})}},{key:"count",value:function(e,t){return this._readAll(e).then(function(e){return(0,l.applyQueryToDataset)(e,t).length})}},{key:"update",value:function(e,t){var n=this;return this._enqueueCrudOperation(e,function(){return n._update(e,t).then(function(){return t})})}},{key:"delete",value:function(e,t){var n=this;return this._enqueueCrudOperation(e,function(){return n._delete(e,t)})}},{key:"deleteById",value:function(e,t){var n=this;return this._enqueueCrudOperation(e,function(){return n._deleteById(e,t)})}},{key:"clear",value:function(e){var t=this,n=o.Promise.resolve(e);return e||(n=this._getAllCollections()),n.then(function(e){return t._clearCollections(e)})}},{key:"group",value:function(e,t){return this._readAll(e).then(function(e){return(0,l.applyAggregationToDataset)(e,t)})}},{key:"_formCollectionKey",value:function(e){return this._getAppKey()+"."+e}},{key:"_deleteMatchingEntitiesFromPersistance",value:function(e,t,n){var r=(0,s.default)(n,"_id"),i=t.filter(function(e){return!r[e._id]});return t.length-i.length>0?this._saveAll(e,i):o.Promise.resolve()}},{key:"_delete",value:function(e,t){var n=this;return this._readAll(e).then(function(r){var i=(0,l.applyQueryToDataset)(r,t);return n._deleteMatchingEntitiesFromPersistance(e,r,i).then(function(){return i.length})})}},{key:"_deleteById",value:function(e,t){var n=this;return this._readAll(e).then(function(r){var i=r.findIndex(function(e){return e._id===t});return i>-1?(r.splice(i,1),n._saveAll(e,r).then(function(){return 1})):o.Promise.resolve(0)})}},{key:"_getAllCollections",value:function(){var e=this;return this._persister.getKeys().then(function(t){var n=[];return(t=t||[]).forEach(function(t){e._keyBelongsToApp(t)&&n.push(e._getCollectionFromKey(t))}),n})}},{key:"_update",value:function(e,t){var n=this,r=(0,f.ensureArray)(t),i=(0,s.default)(r,"_id"),o=r.length;return this._readAll(e).then(function(t){return t.forEach(function(e,n){o>0&&i[e._id]&&(t[n]=i[e._id],delete i[e._id],o-=1)}),o>0&&Object.keys(i).forEach(function(e){t.push(i[e])}),n._saveAll(e,t)})}},{key:"_readAll",value:function(e){var t=this._formCollectionKey(e);return this._persister.read(t).then(function(e){return e||[]})}},{key:"_saveAll",value:function(e,t){var n=this._formCollectionKey(e);return this._persister.write(n,t)}},{key:"_deleteAll",value:function(e){var t=this._getAppKey(),n=this._formCollectionKey(e);return n!==t+"."+f.activeUserKey?this._persister.delete(n):o.Promise.resolve()}},{key:"_enqueueCrudOperation",value:function(e,t){var n=this._formCollectionKey(e);return this._queue.enqueue(n,t)}},{key:"_keyBelongsToApp",value:function(e){var t=this._getAppKey();return 0===e.indexOf(t)}},{key:"_getCollectionFromKey",value:function(e){var t=this._getAppKey();return e.substring((t+".").length)}},{key:"_clearCollections",value:function(e){var t=this,n=(0,f.ensureArray)(e).map(function(e){return t._enqueueCrudOperation(e,function(){return t._deleteAll(e)})});return o.Promise.all(n).then(function(){return!0})}},{key:"_create",value:function(e,t){var n=this;return this._readAll(e).then(function(r){return r=r.concat(t),n._saveAll(e,r)})}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineRepository=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),o=n(88);t.OfflineRepository=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Repository),r(t,[{key:"clear",value:function(){this._throwNotImplementedError()}},{key:"_throwNotImplementedError",value:function(){throw new Error("Method of OfflineRepository not implemented")}},{key:"_getAppKey",value:function(){return i.Client.sharedInstance().appKey}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRepository=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(9),u=n(63),s=n(88),a=n(3),c=n(54);t.NetworkRepository=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Repository),r(t,[{key:"read",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this._buildRequestConfig(e,o.RequestMethod.GET,null,t,null,null,n);return this._makeHttpRequest(r,n.dataOnly)}},{key:"readById",value:function(e,t,n){var r=this._buildRequestConfig(e,o.RequestMethod.GET,null,null,t,null,n);return this._makeHttpRequest(r)}},{key:"create",value:function(e,t,n){return this._processBatch(e,o.RequestMethod.POST,t,null,n)}},{key:"update",value:function(e,t,n){return this._processBatch(e,o.RequestMethod.PUT,t,n)}},{key:"deleteById",value:function(e,t,n){var r=this._buildRequestConfig(e,o.RequestMethod.DELETE,null,null,t,null,n);return this._makeHttpRequest(r).then(function(e){return e.count})}},{key:"delete",value:function(e,t,n){var r=this._buildRequestConfig(e,o.RequestMethod.DELETE,null,t,null,null,n);return this._makeHttpRequest(r).then(function(e){return e.count})}},{key:"count",value:function(e,t,n){var r=this._buildRequestConfig(e,o.RequestMethod.GET,null,t,null,"_count",null,n);return this._makeHttpRequest(r,n.dataOnly).then(function(e){return!1===n.dataOnly?e:e.count})}},{key:"group",value:function(e,t,n){var r=this._buildRequestConfig(e,o.RequestMethod.POST,null,t,null,"_group",null,n);return this._makeHttpRequest(r)}},{key:"_processBatch",value:function(e,t,n,r){var u=this,s=!Array.isArray(n),c=(0,a.ensureArray)(n).map(function(n){var i=t===o.RequestMethod.PUT?n._id:null,s=u._buildRequestConfig(e,t,n,null,i,null,r);return u._makeHttpRequest(s)});return i.Promise.all(c).then(function(e){return s?e&&e[0]:e})}},{key:"_makeHttpRequest",value:function(e,t){return o.KinveyRequest.execute(e,null,t)}},{key:"_buildRequestConfig",value:function(e,t,n,r,i,o,s){s=s||{};var a={method:t,pathname:(0,c.buildCollectionUrl)(e,i,o),timeout:s.timeout,properties:s.properties,trace:s.trace,skipBL:s.skipBL,kinveyFileTTL:s.kinveyFileTTL,kinveyFileTLS:s.kinveyFileTLS};return n&&(a.body=n),r instanceof u.Aggregation?a.aggregation=r:a.query=r,a}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProcessor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(1),u=n(36);n(3);t.DataProcessor=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"_getRepository",value:function(){throw new Error("_getRepository not implemented")}},{key:"process",value:function(e,t){var n=e.collection,r=e.data,s=e.query,a=e.entityId;switch(e.type){case u.OperationType.Create:return this._processCreate(n,r,t);case u.OperationType.Read:return this._processRead(n,s,t);case u.OperationType.ReadById:return this._processReadById(n,a,t);case u.OperationType.Update:return this._processUpdate(n,r,t);case u.OperationType.Delete:return this._processDelete(n,s,t);case u.OperationType.DeleteById:return this._processDeleteById(n,a,t);case u.OperationType.Count:return this._processCount(n,s,t);case u.OperationType.Group:return this._processGroup(n,s,t);default:var c=new o.KinveyError("Unexpected operation type: "+e.type);return i.Promise.reject(c)}}},{key:"_processCreate",value:function(e,t,n){return this._getRepository().then(function(r){return r.create(e,t,n)})}},{key:"_processRead",value:function(e,t,n){return this._getRepository().then(function(r){return r.read(e,t,n)})}},{key:"_processReadById",value:function(e,t,n){return this._getRepository().then(function(r){return r.readById(e,t,n)})}},{key:"_processUpdate",value:function(e,t,n){return this._getRepository().then(function(r){return r.update(e,t,n)})}},{key:"_processDelete",value:function(e,t,n){return this._getRepository().then(function(r){return r.delete(e,t,n)})}},{key:"_processDeleteById",value:function(e,t,n){return this._getRepository().then(function(r){return r.deleteById(e,t,n)})}},{key:"_processCount",value:function(e,t,n){return this._getRepository().then(function(r){return r.count(e,t,n)})}},{key:"_processGroup",value:function(e,t,n){return this._getRepository().then(function(r){return r.group(e,t,n)})}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deltaSet=function(e,t,n){return(0,a.getCachedQuery)(e,t).then(function(a){if(!a||!a.lastRequest)throw new u.InvalidCachedQuery;var c=o.Client.sharedInstance(),l=new i.KinveyRequest({authType:i.AuthType.Default,method:i.RequestMethod.GET,url:(0,r.format)({protocol:c.apiProtocol,host:c.apiHost,pathname:(0,s.buildCollectionUrl)(e,null,"_deltaset"),query:{since:a.lastRequest}}),query:t,timeout:n.timeout,followRedirect:n.followRedirect,cache:n.cache,properties:n.properties,skipBL:n.skipBL,trace:n.trace,client:c});return l.execute().catch(function(e){if(e instanceof u.ParameterValueOutOfRangeError||e instanceof u.ResultSetSizeExceededError||e instanceof u.MissingConfigurationError)throw new u.InvalidCachedQuery;throw e})})};var r=n(21),i=n(9),o=n(7),u=n(1),s=n(16),a=n(56)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkDataProcessor=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(142),u=n(17);t.NetworkDataProcessor=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.DataProcessor),r(t,[{key:"_getRepository",value:function(){if(!this._repoPromise){var e=u.repositoryProvider.getNetworkRepository();this._repoPromise=i.Promise.resolve(e)}return this._repoPromise}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncManager=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=n(53),s=(r=u)&&r.__esModule?r:{default:r},a=n(18),c=n(1),l=n(162),f=n(147),h=n(148),p=n(16),d=n(17),y=n(15),v=n(3),b=n(143),_=n(56);var g=(0,l.getPlatformConfig)(),m=g.maxConcurrentPullRequests,w=g.maxConcurrentPushRequests,O={};t.SyncManager=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._networkRepo=t,this._syncStateManager=n}return i(e,[{key:"push",value:function(e,t){var n=this;if((0,p.isEmpty)(e)||!(0,v.isNonemptyString)(e))return o.Promise.reject(new c.KinveyError("Invalid or missing collection name"));if(this._pushIsInProgress(e))return o.Promise.reject(new c.SyncError("Data is already being pushed to the backend. Please wait for it to complete before pushing new data to the backend."));this._markPushStart(e);var r=o.Promise.resolve();return t&&(r=this._getEntityIdsForQuery(e,t)),r.then(function(t){return n._syncStateManager.getSyncItems(e,t)}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n._processSyncItems(e,t)}).then(function(t){return n._markPushEnd(e),t}).catch(function(e){return n._markPushEnd(),o.Promise.reject(e)})}},{key:"pull",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o.Promise.resolve().then(function(){if(!(0,v.isNonemptyString)(e))throw new c.KinveyError("Invalid or missing collection name")}).then(function(){return r.useDeltaSet?(0,b.deltaSet)(e,t,r).then(function(n){return(0,_.getCachedQuery)(e,t).then(function(e){return e?(e.lastRequest=n.headers.requestStart,(0,_.updateCachedQuery)(e)):null}).then(function(){return n.data})}).then(function(t){if(t.deleted.length>0){var r=new y.Query;return r.contains("_id",t.deleted.map(function(e){return e._id})),n._deleteOfflineEntities(e,r).then(function(){return t})}return t}).then(function(t){return t.changed.length>0?n._getOfflineRepo().then(function(n){return n.update(e,t.changed)}).then(function(){return t.changed.length}):0}):r.autoPagination?n._paginatedPull(e,t,r):n._fetchItemsFromServer(e,t,r).then(function(n){return(0,_.getCachedQuery)(e,t).then(function(e){return e&&n.headers?(e.lastRequest=n.headers.requestStart,(0,_.updateCachedQuery)(e)):null}).then(function(){return n.data?n.data:n})}).then(function(r){return n._replaceOfflineEntities(e,t,r).then(function(e){return e.length})})}).catch(function(i){if(i instanceof c.InvalidCachedQuery)return(0,_.getCachedQuery)(e,t).then(function(e){return(0,_.deleteCachedQuery)(e)}).catch(function(e){if(e instanceof c.NotFoundError)return null;throw e}).then(function(){return n.pull(e,t,Object.assign(r,{useDeltaSet:!1}))});throw i})}},{key:"getSyncItemCount",value:function(e){return(0,v.isNonemptyString)(e)?this._syncStateManager.getSyncItemCount(e):o.Promise.reject(new c.KinveyError("Invalid or missing collection name"))}},{key:"getSyncItemCountByEntityQuery",value:function(e,t){var n=this;return t?this._getOfflineRepo().then(function(n){return n.read(e,t)}).then(function(t){var r=t.map(function(e){return e._id});return n._syncStateManager.getSyncItemCount(e,r)}):this._syncStateManager.getSyncItemCount(e)}},{key:"getSyncEntities",value:function(e,t){var n=this;return this._getOfflineRepo().then(function(n){return n.read(e,t)}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n._syncStateManager.getSyncItems(e,t.map(function(e){return e._id}))})}},{key:"clearSync",value:function(e,t){var n=this;return t?this._getEntityIdsForQuery(e,t).then(function(t){return n._syncStateManager.removeSyncItemsForIds(e,t)}):this._syncStateManager.removeAllSyncItems(e)}},{key:"addCreateEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Create)}},{key:"addDeleteEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Delete)}},{key:"addUpdateEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Update)}},{key:"removeSyncItemForEntityId",value:function(e,t){return this._syncStateManager.removeSyncItemForEntityId(e,t)}},{key:"removeSyncItemsForIds",value:function(e,t){return this._syncStateManager.removeSyncItemsForIds(e,t)}},{key:"_deleteOfflineEntities",value:function(e,t){return this._getOfflineRepo().then(function(n){return n.delete(e,t)})}},{key:"_replaceOfflineEntities",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t&&(t.hasSkip()||t.hasLimit())?this._getOfflineRepo().then(function(t){return t.update(e,r)}):this._deleteOfflineEntities(e,t).then(function(){return n._getOfflineRepo()}).then(function(t){return t.update(e,r)})}},{key:"_getPushOpResult",value:function(e,t){var n={_id:e,operation:t};return t!==f.SyncOperation.Delete&&(n.entity=null),n}},{key:"_sanitizeOfflineEntity",value:function(e){var t=(0,s.default)(e);return delete t._id,t._kmd&&delete t._kmd.local,t}},{key:"_replaceOfflineEntityWithNetwork",value:function(e,t,n){var r=void 0;return this._getOfflineRepo().then(function(n){return(r=n).deleteById(e,t)}).then(function(){return r.create(e,n)})}},{key:"_pushCreate",value:function(e,t){var n=this,r=t;t._kmd&&t._kmd.local&&(r=this._sanitizeOfflineEntity(t));var i=this._getPushOpResult(t._id,f.SyncOperation.Create);return this._networkRepo.create(e,r).then(function(r){return i.entity=r,n._replaceOfflineEntityWithNetwork(e,t._id,r)}).then(function(){return i}).catch(function(e){return i.error=e,i})}},{key:"_pushDelete",value:function(e,t){var n=this._getPushOpResult(t,f.SyncOperation.Delete);return this._networkRepo.deleteById(e,t).then(function(){return n}).catch(function(e){return n.error=e,n})}},{key:"_pushUpdate",value:function(e,t){var n=this,r=this._getPushOpResult(t._id,f.SyncOperation.Update);return this._networkRepo.update(e,t).then(function(e){return r.entity=e,n._getOfflineRepo()}).then(function(t){return t.update(e,r.entity)}).then(function(){return r}).catch(function(e){return r.entity=t,r.error=e,r})}},{key:"_handlePushOp",value:function(e,t,n){var r=t.state,i=t.entityId,o=r.operation;switch(o){case f.SyncOperation.Create:return this._pushCreate(e,n);case f.SyncOperation.Delete:return this._pushDelete(e,i);case f.SyncOperation.Update:return this._pushUpdate(e,n);default:var u=this._getPushOpResult(i,o);return u.error=new c.SyncError("Unexpected sync operation: "+o),u}}},{key:"_pushItem",value:function(e,t){var n=this,r=t.entityId,i=t.state;return this._getOfflineRepo().then(function(t){return t.readById(e,r)}).catch(function(t){return t instanceof c.NotFoundError?i.operation!==f.SyncOperation.Delete?n._syncStateManager.removeSyncItemForEntityId(e,r).then(function(){return o.Promise.reject(t)}):null:o.Promise.reject(t)}).then(function(r){return n._handlePushOp(e,t,r)})}},{key:"_processSyncItem",value:function(e,t){var n=this;return this._pushItem(e,t).then(function(e){return e.error?e:n._syncStateManager.removeSyncItemForEntityId(t.collection,t.entityId).then(function(){return e})}).catch(function(e){var r=n._getPushOpResult(t.entityId,t.state.operation);return r.error=e,r})}},{key:"_processSyncItems",value:function(e,t){var n=this,r=[];return(0,v.forEachAsync)(t,function(t){return n._processSyncItem(e,t).then(function(e){return r.push(e)})},w).then(function(){return r})}},{key:"_fetchItemsFromServer",value:function(e,t,n){return this._networkRepo.read(e,t,Object.assign(n,{dataOnly:!1}))}},{key:"_getOfflineRepo",value:function(){return this._offlineRepoPromise||(this._offlineRepoPromise=d.repositoryProvider.getOfflineRepository()),this._offlineRepoPromise}},{key:"_pushIsInProgress",value:function(e){return!!O[e]}},{key:"_markPushStart",value:function(e){this._pushIsInProgress(e)?a.Log.debug("Marking push start, when push already started"):O[e]=!0}},{key:"_markPushEnd",value:function(e){this._pushIsInProgress(e)?delete O[e]:a.Log.debug("Marking push end, when push is NOT started")}},{key:"_getEntityIdsForQuery",value:function(e,t){return this._getOfflineRepo().then(function(n){return n.read(e,t)}).then(function(e){return e.map(function(e){return e._id})})}},{key:"_addEvent",value:function(e,t,n){var r=this._validateCrudEventEntities(t);return r||this._setState(e,t,n).then(function(){return t})}},{key:"_validateCrudEventEntities",value:function(e){if(!e||(0,p.isEmpty)(e))return o.Promise.reject(new c.SyncError("Invalid or missing entity/entities array."));var t=(0,v.ensureArray)(e).find(function(e){return!e._id});if(t){return o.Promise.reject(new c.SyncError("An entity is missing an _id. All entities must have an _id in order to be added to the sync table.",t))}return null}},{key:"_setState",value:function(e,t,n){switch(n){case f.SyncOperation.Create:return this._syncStateManager.addCreateEvent(e,t);case f.SyncOperation.Update:return this._syncStateManager.addUpdateEvent(e,t);case f.SyncOperation.Delete:return this._syncStateManager.addDeleteEvent(e,t);default:return o.Promise.reject(new c.SyncError("Invalid sync event name"))}}},{key:"_getInternalPullQuery",value:function(e,t){var n,r,i,o=e=e||{},u=o.filter,s=o.sort,a=o.fields,c=new y.Query({filter:u,sort:s,fields:a});return c.limit=t,s&&!(0,p.isEmpty)(s)||(c.sort=(n={},r=h.defaultPullSortField,i=1,r in n?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n)),c}},{key:"_fetchAndUpdateEntities",value:function(e,t,n){var r=this;return this._networkRepo.read(e,t,n).then(function(t){return r._getOfflineRepo().then(function(n){return n.update(e,t)})})}},{key:"_executePaginationQueries",value:function(e,t,n){var r=this,i=0;return(0,v.forEachAsync)(t,function(t){return r._fetchAndUpdateEntities(e,t,n).then(function(e){i+=e.length})},m).then(function(){return i})}},{key:"_getExpectedEntityCount",value:function(e,t){var n=new y.Query({filter:t.filter});return this._networkRepo.count(e,n,{dataOnly:!1}).then(function(e){return{lastRequest:e.headers?e.headers.requestStart:void 0,count:e.data?e.data.count:e}})}},{key:"_paginatedPull",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0;return t=t||new y.Query,this._getExpectedEntityCount(e,t).then(function(o){var u=o.lastRequest,s=o.count;return i=n._getInternalPullQuery(t,s),n._deleteOfflineEntities(e).then(function(){var t=r.autoPagination&&r.autoPagination.pageSize||h.maxEntityLimit,o=(0,v.splitQueryIntoPages)(i,t,s);return n._executePaginationQueries(e,o,r)}).then(function(n){return(0,_.getCachedQuery)(e,t).then(function(e){return e?(e.lastRequest=u,(0,_.updateCachedQuery)(e)):null}).then(function(){return n})})})}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.platformName={nativeScript:"NativeScript",html5:"HTML5",nodeJs:"nodejs",phoneGap:"PhoneGap"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SyncOperation={Create:"POST",Update:"PUT",Delete:"DELETE"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.syncCollectionName="kinvey_sync",t.maxEntityLimit=1e4,t.defaultPullSortField="_kmd.ect"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStateManager=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=n(53),s=(r=u)&&r.__esModule?r:{default:r},a=n(15),c=n(57),l=n(17),f=n(148),h=n(3),p=n(16);t.SyncStateManager=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"addCreateEvent",value:function(e,t){var n=this._buildSyncItemsForEntities(e,t,c.SyncOperation.Create);return this._createSyncItems(e,n)}},{key:"addUpdateEvent",value:function(e,t){var n=this._buildSyncItemsForEntities(e,t,c.SyncOperation.Update);return this._upsertSyncItems(e,n)}},{key:"addDeleteEvent",value:function(e,t){var n=this._groupSyncItemDataForDeleteEvent(e,t),r=o.Promise.resolve();if((0,p.isNotEmpty)(n.localEntityIds)){var i=this._getEntitiesFilter(e,n.localEntityIds);r=this._deleteSyncItems(e,i)}var u=o.Promise.resolve();return(0,p.isNotEmpty)(n.syncItemsToUpsert)&&(u=this._upsertSyncItems(e,n.syncItemsToUpsert,n.syncItemsToUpsertIds)),o.Promise.all([r,u])}},{key:"getSyncItems",value:function(e,t){var n=this,r=this._getEntitiesFilter(e,t);return this._getRepository().then(function(t){return t.read(n._getSyncCollectionName(e),r)})}},{key:"getSyncItemCount",value:function(e,t){var n=this,r=this._getEntitiesFilter(e,t);return this._getRepository().then(function(t){return t.count(n._getSyncCollectionName(e),r)})}},{key:"removeSyncItemForEntityId",value:function(e,t){var n=(new a.Query).equalTo("entityId",t);return this._deleteSyncItems(e,n)}},{key:"removeSyncItemsForIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this._getEntitiesFilter(e,t);return this._deleteSyncItems(e,n)}},{key:"removeAllSyncItems",value:function(e){var t=this._getCollectionFilter(e);return this._deleteSyncItems(e,t)}},{key:"_getRepository",value:function(){return this._repoPromise||(this._repoPromise=l.repositoryProvider.getOfflineRepository()),this._repoPromise}},{key:"_deleteSyncItems",value:function(e,t){var n=this;return this._getRepository().then(function(r){return r.delete(n._getSyncCollectionName(e),t)})}},{key:"_getSyncItemsByEntityIds",value:function(e){var t=(new a.Query).contains("entityId",e);return this._getRepository().then(function(e){return e.read(f.syncCollectionName,t)})}},{key:"_getUpdatedSyncItem",value:function(e,t){var n=(0,s.default)(e);return n._id=t._id,n}},{key:"_upsertSyncItems",value:function(e,t,n){var r=this;n||(n=t.map(function(e){return e.entityId}));var i=(new a.Query).contains("entityId",n);return this._getRepository().then(function(t){return t.delete(r._getSyncCollectionName(e),i).then(function(){return t})}).then(function(n){return n.create(r._getSyncCollectionName(e),t)})}},{key:"_getEntitiesFilter",value:function(e,t){var n=this._getCollectionFilter(e);return t&&n.and().contains("entityId",(0,h.ensureArray)(t)),n}},{key:"_getCollectionFilter",value:function(e){var t=new a.Query;return t.equalTo("collection",e),(0,p.collectionHasTag)(e)&&t.or().equalTo("collection",(0,p.stripTagFromCollectionName)(e)),t}},{key:"_buildSyncItem",value:function(e,t,n){return{_id:(0,p.generateEntityId)(),collection:e,entityId:n,state:{operation:t}}}},{key:"_buildSyncItemsForEntities",value:function(e,t,n){var r=this;return(0,h.ensureArray)(t).map(function(t){return r._buildSyncItem(e,n,t._id)})}},{key:"_groupSyncItemDataForDeleteEvent",value:function(e,t){var n=this,r=[],i=[],o=[];return(0,h.ensureArray)(t).forEach(function(t){if((0,p.isLocalEntity)(t))r.push(t._id);else{var u=n._buildSyncItem(e,c.SyncOperation.Delete,t._id);i.push(u),o.push(t._id)}}),{localEntityIds:r,syncItemsToUpsert:i,syncItemsToUpsertIds:o}}},{key:"_createSyncItems",value:function(e,t){var n=this;return this._getRepository().then(function(r){return r.create(n._getSyncCollectionName(e),t)})}},{key:"_getSyncCollectionName",value:function(e){var t=(0,p.getTagFromCollectionName)(e);return(0,p.formTaggedCollectionName)(f.syncCollectionName,t)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStore=void 0;var r=n(75),i=n(37);t.SyncStore=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=n||i.processorFactory.getOfflineProcessor();return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.CacheStore),t}()},function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:o,assign:function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],r=0;r<t.length;++r)for(var i=t[r],o=i.obj[i.prop],u=Object.keys(o),s=0;s<u.length;++s){var a=u[s],c=o[a];"object"==typeof c&&null!==c&&-1===n.indexOf(c)&&(t.push({obj:o,prop:a}),n.push(c))}return function(e){for(var t;e.length;){var n=e.pop();if(t=n.obj[n.prop],Array.isArray(t)){for(var r=[],i=0;i<t.length;++i)void 0!==t[i]&&r.push(t[i]);n.obj[n.prop]=r}}return t}(t)},decode:function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},encode:function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),n="",r=0;r<t.length;++r){var o=t.charCodeAt(r);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?n+=t.charAt(r):o<128?n+=i[o]:o<2048?n+=i[192|o>>6]+i[128|63&o]:o<55296||o>=57344?n+=i[224|o>>12]+i[128|o>>6&63]+i[128|63&o]:(r+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(r)),n+=i[240|o>>18]+i[128|o>>12&63]+i[128|o>>6&63]+i[128|63&o])}return n},isBuffer:function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(t,n,i){if(!n)return t;if("object"!=typeof n){if(Array.isArray(t))t.push(n);else{if("object"!=typeof t)return[t,n];(i.plainObjects||i.allowPrototypes||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if("object"!=typeof t)return[t].concat(n);var u=t;return Array.isArray(t)&&!Array.isArray(n)&&(u=o(t,i)),Array.isArray(t)&&Array.isArray(n)?(n.forEach(function(n,o){r.call(t,o)?t[o]&&"object"==typeof t[o]?t[o]=e(t[o],n,i):t.push(n):t[o]=n}),t):Object.keys(n).reduce(function(t,o){var u=n[o];return r.call(t,o)?t[o]=e(t[o],u,i):t[o]=u,t},u)}}},function(e,t,n){"use strict";var r=String.prototype.replace,i=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestMethod=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=d(n(2)),o=d(n(90)),u=d(n(12)),s=d(n(10)),a=d(n(31)),c=n(7),l=n(1),f=n(3),h=n(91),p=n(42);function d(e){return e&&e.__esModule?e:{default:e}}var y=t.RequestMethod={GET:"GET",POST:"POST",PATCH:"PATCH",PUT:"PUT",DELETE:"DELETE"};Object.freeze(y);t.Request=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,u.default)({followRedirect:!0},t),this.id=(0,f.randomString)(),this.client=t.client,this.method=t.method||y.GET,this.headers=t.headers||new p.Headers,this.url=t.url||"",this.body=t.body||t.data,this.timeout=(0,f.isDefined)(t.timeout)?t.timeout:this.client.defaultTimeout,this.followRedirect=!0===t.followRedirect,this.cache=!0===t.cache}return r(e,[{key:"execute",value:function(){return!1===(0,f.isDefined)(this.rack)?(Log.error("Unable to execute the request. Please provide a rack to execute the request."),i.default.reject(new l.KinveyError("Unable to execute the request. Please provide a rack to execute the request."))):this.rack.execute(this.toPlainObject()).then(function(e){if(!1===(0,f.isDefined)(e))throw new l.NoResponseError;return e instanceof h.Response==!1&&(e=new h.Response({statusCode:e.statusCode,headers:e.headers,data:e.data})),e})}},{key:"cancel",value:function(){return this.rack.cancel()}},{key:"toPlainObject",value:function(){return{id:this.id,method:this.method,headers:this.headers.toPlainObject(),url:this.url,body:this.body,timeout:this.timeout,followRedirect:this.followRedirect,encryptionKey:this.client.encryptionKey}}},{key:"client",get:function(){return this._client||c.Client.sharedInstance()},set:function(e){if(e&&e instanceof c.Client==!1)throw new l.KinveyError("client must be an instance of the Client class.");this._client=e}},{key:"method",get:function(){return this._method},set:function(e){switch((0,s.default)(e)||(e=String(e)),e=e.toUpperCase()){case y.GET:case y.POST:case y.PATCH:case y.PUT:case y.DELETE:this._method=e;break;default:throw new l.KinveyError("Invalid request method. Only GET, POST, PATCH, PUT, and DELETE are allowed.")}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof p.Headers||(e=new p.Headers(e)),this._headers=e}},{key:"url",get:function(){return!0===this.cache?(0,f.appendQuery)(this._url,o.default.stringify({_:Math.random().toString(36).substr(2)})):this._url},set:function(e){this._url=e}},{key:"data",get:function(){return this.body},set:function(e){this.body=e}},{key:"timeout",get:function(){return this._timeout},set:function(e){if(e=parseInt(e,10),!1===(0,a.default)(e)||isNaN(e))throw new l.KinveyError("Invalid timeout. Timeout must be a number.");this._timeout=e}},{key:"followRedirect",get:function(){return this._followRedirect},set:function(e){this._followRedirect=!!e}},{key:"cache",get:function(){return this._cache},set:function(e){this._cache=!!e}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRack=t.Rack=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0},o=h(n(2)),u=h(n(399)),s=h(n(25)),a=h(n(402)),c=n(3),l=n(18),f=n(155);function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=t.Rack=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Rack";p(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.middlewares=[],n.canceled=!1,n.activeMiddleware=void 0,n}return y(t,f.Middleware),r(t,[{key:"use",value:function(e){if((0,c.isDefined)(e)){if(e instanceof f.Middleware)return void this.middlewares.push(e);throw new Error("Unable to use the middleware. It must be an instance of Middleware.")}}},{key:"reset",value:function(){this.middlewares=[]}},{key:"execute",value:function(e){var t=this;return!1===(0,c.isDefined)(e)?o.default.reject(new Error("Request is undefined. Please provide a valid request.")):(0,u.default)((0,a.default)(this.middlewares),function(n,r){return n.then(function(n){var i=n.request,u=n.response;return t.canceled?o.default.reject(new Error("Cancelled")):(t.activeMiddleware=r,r.handle(i||e,u))})},o.default.resolve({request:e})).then(function(e){var n=e.response;return!0===t.canceled?o.default.reject(new Error("Cancelled")):(t.canceled=!1,t.activeMiddleware=void 0,n)}).catch(function(e){throw t.canceled=!1,t.activeMiddleware=void 0,e})}},{key:"cancel",value:function(){return this.canceled=!0,(0,c.isDefined)(this.activeMiddleware)&&(0,s.default)(this.activeMiddleware.cancel)?this.activeMiddleware.cancel():o.default.resolve()}},{key:"handle",value:function(e){return this.execute(e)}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"generateTree",this).call(this,e);return(0,a.default)(this.middlewares).forEach(function(t){n.nodes.push(t.generateTree(e+1))}),n}}]),t}(),b=new(function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Network Rack";p(this,t);var n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.use(new f.SerializeMiddleware),n.use(new f.HttpMiddleware),n.use(new f.ParseMiddleware),n}return y(t,v),r(t,[{key:"useHttpMiddleware",value:function(e){this.reset(),this.use(new f.SerializeMiddleware),this.use(e),this.use(new f.ParseMiddleware)}},{key:"execute",value:function(e){return l.Log.debug("Executing network request",e),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this,e).then(function(t){return l.Log.debug("Received response for network request: "+e.id,t),t}).catch(function(t){throw l.Log.error("Received error for network request id: "+e.id,t),t})}}]),t}());t.NetworkRack=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(404);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(58);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(406);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var u=n(407);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},,function(e,t,n){var r=n(209),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,u=-1,s=i(o.length-t,0),a=Array(s);++u<s;)a[u]=o[t+u];u=-1;for(var c=Array(t+1);++u<t;)c[u]=o[u];return c[t]=n(a),r(e,this,c)}}},function(e,t,n){var r=n(210),i=n(212)(r);e.exports=i},function(e,t,n){var r=n(120),i=1,o=4;e.exports=function(e){return r(e,i|o)}},function(e,t){e.exports=require("http")},function(e,t,n){var r=n(362),i=n(363);e.exports=function(e,t){return null!=e&&i(e,t,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(146);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(385);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(411);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=c(n(33)),o=c(n(6)),u=c(n(12)),s=n(1),a=n(3);function c(e){return e&&e.__esModule?e:{default:e}}t.Acl=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,i.default)(t))throw new s.KinveyError("entity argument must be an object");t._acl=t._acl||{},this.entity=t}return r(e,[{key:"addReader",value:function(e){var t=this.readers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.r=t,this}},{key:"addReaderGroup",value:function(e){var t=this.readerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{r:t}),this}},{key:"addWriter",value:function(e){var t=this.writers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.w=t,this}},{key:"addWriterGroup",value:function(e){var t=this.writerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{w:t}),this}},{key:"isGloballyReadable",value:function(){return!0===this.entity._acl.gr&&this.entity._acl.gr}},{key:"isGloballyWritable",value:function(){return!0===this.entity._acl.gw&&this.entity._acl.gw}},{key:"removeReader",value:function(e){var t=this.readers,n=t.indexOf(e);return-1!==n&&t.splice(n,1),this.entity._acl.r=t,this}},{key:"removeReaderGroup",value:function(e){var t=this.readerGroups,n=t.indexOf(e);return-1!==n&&t.splice(n,1),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{r:t}),this}},{key:"removeWriter",value:function(e){var t=this.writers,n=t.indexOf(e);return-1!==n&&t.splice(n,1),this.entity._acl.w=t,this}},{key:"removeWriterGroup",value:function(e){var t=this.writerGroups,n=t.indexOf(e);return-1!==n&&t.splice(n,1),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{w:t}),this}},{key:"toPlainObject",value:function(){return this.entity._acl}},{key:"creator",get:function(){return this.entity._acl.creator}},{key:"readers",get:function(){return(0,o.default)(this.entity._acl.r)?this.entity._acl.r:[]}},{key:"writers",get:function(){return(0,o.default)(this.entity._acl.w)?this.entity._acl.w:[]}},{key:"readerGroups",get:function(){return(0,a.isDefined)(this.entity._acl.groups)&&(0,o.default)(this.entity._acl.groups.r)?this.entity._acl.groups.r:[]}},{key:"writerGroups",get:function(){return(0,a.isDefined)(this.entity._acl.groups)&&(0,o.default)(this.entity._acl.groups.w)?this.entity._acl.groups.w:[]}},{key:"globallyReadable",set:function(e){this.entity._acl.gr=!0===e&&e}},{key:"globallyWritable",set:function(e){this.entity._acl.gw=!0===e&&e}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(33),u=(r=o)&&r.__esModule?r:{default:r},s=n(1),a=n(3);t.Metadata=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,u.default)(t))throw new s.KinveyError("entity argument must be an object");t._kmd=t._kmd||{},this.entity=t}return i(e,[{key:"isLocal",value:function(){return!0===this.entity._kmd.local}},{key:"toPlainObject",value:function(){return this.entity._kmd}},{key:"createdAt",get:function(){if((0,a.isDefined)(this.entity._kmd.ect))return new Date(this.entity._kmd.ect)}},{key:"ect",get:function(){return this.createdAt}},{key:"emailVerification",get:function(){if((0,a.isDefined)(this.entity._kmd.emailVerification))return this.entity._kmd.emailVerification.status}},{key:"lastModified",get:function(){if((0,a.isDefined)(this.entity._kmd.lmt))return new Date(this.entity._kmd.lmt)}},{key:"lmt",get:function(){return this.lastModified}},{key:"authtoken",get:function(){return this.entity._kmd.authtoken}}]),e}()},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnect=t.AuthorizationGrant=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=d(n(2)),o=d(n(10)),u=d(n(21)),s=d(n(178)),a=n(9),c=n(1),l=n(3),f=n(408),h=n(409),p=n(97);function d(e){return e&&e.__esModule?e:{default:e}}var y=f.Popup,v=t.AuthorizationGrant={AuthorizationCodeLoginPage:"AuthorizationCodeLoginPage",AuthorizationCodeAPI:"AuthorizationCodeAPI"};Object.freeze(v);t.MobileIdentityConnect=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.Identity),r(t,[{key:"isSupported",value:function(){return!0}},{key:"_getMicPath",value:function(e){var t=3;return e.version&&(t=e.version),!1===(0,o.default)(t)&&(t=String(t)),(0,s.default)(0===t.indexOf("v")?t:"v"+t,"/oauth/auth")}},{key:"login",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.AuthorizationCodeLoginPage,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(0,o.default)(e))return i.default.reject(new c.KinveyError("A redirectUri is required and must be a string."));var s=this.client.appKey;return(0,o.default)(u.micId)&&(s=s+"."+u.micId),i.default.resolve().then(function(){if(r===v.AuthorizationCodeLoginPage)return n.requestCodeWithPopup(s,e,u);if(r===v.AuthorizationCodeAPI)return n.requestTempLoginUrl(s,e,u).then(function(t){return n.requestCodeWithUrl(t,s,e,u)});throw new c.KinveyError("The authorization grant "+r+" is unsupported. Please use a supported authorization grant.")}).then(function(t){return n.requestToken(t,s,e,u)}).then(function(r){return r.identity=t.identity,r.client_id=s,r.redirect_uri=e,r.protocol=n.client.micProtocol,r.host=n.client.micHost,r})}},{key:"refresh",value:function(e,n,r){var o=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.default.resolve().then(function(){return o.refreshToken(e,n,r,u)}).then(function(e){return e.identity=t.identity,e.client_id=n,e.redirect_uri=r,e.protocol=o.client.micProtocol,e.host=o.client.micHost,e})}},{key:"requestTempLoginUrl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new a.KinveyRequest({method:a.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:this._getMicPath(n)}),properties:n.properties,body:{client_id:e,redirect_uri:t,response_type:"code"}}).execute().then(function(e){return e.data.temp_login_uri})}},{key:"requestCodeWithPopup",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.default.resolve().then(function(){return(new y).open(u.default.format({protocol:n.client.micProtocol,host:n.client.micHost,pathname:n._getMicPath(r),query:{client_id:e,redirect_uri:t,response_type:"code",scope:"openid"}}))}).then(function(e){return new i.default(function(n,r){var i=!1;function o(o){try{if(o.url&&0===o.url.indexOf(t)&&!1===i){var s=u.default.parse(o.url,!0).query||{};i=!0,e.removeAllListeners(),e.close(),s.code?n(s.code):s.error?r(new c.KinveyError(s.error,s.error_description)):r(new c.KinveyError("The redirect uri did not contain a code or error."))}}catch(e){}}e.on("loadstart",o),e.on("loadstop",o),e.on("error",function(o){try{if(o.url&&0===o.url.indexOf(t)&&!1===i){var s=u.default.parse(o.url,!0).query||{};i=!0,e.removeAllListeners(),e.close(),s.code?n(s.code):s.error?r(new c.KinveyError(s.error,s.error_description)):r(new c.KinveyError("The redirect uri did not contain a code or error."))}else!1===i&&(e.removeAllListeners(),e.close(),r(new c.KinveyError(o.message,"",o.code)))}catch(e){}}),e.on("exit",function(){!1===i&&(e.removeAllListeners(),r(new c.KinveyError("Login has been cancelled.")))})})})}},{key:"requestCodeWithUrl",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.default.resolve().then(function(){return new a.KinveyRequest({method:a.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:e,properties:r.properties,body:{client_id:t,redirect_uri:n,response_type:"code",username:r.username,password:r.password,scope:"openid"},followRedirect:!1}).execute()}).then(function(e){var t=e.headers.get("location");if(t)return u.default.parse(t,!0).query.code;throw new c.MobileIdentityConnectError("Unable to authorize user with username "+r.username+".","A location header was not provided with a code to exchange for an auth token.")})}},{key:"requestToken",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new a.KinveyRequest({method:a.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:a.AuthType.Client,url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),properties:r.properties,body:{grant_type:"authorization_code",client_id:t,redirect_uri:n,code:e},clientId:t}).execute().then(function(e){return e.data})}},{key:"refreshToken",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new a.KinveyRequest({method:a.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:a.AuthType.Client,url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:t,redirect_uri:n,refresh_token:e},clientId:t,properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data})}},{key:"logout",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.default.resolve()}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}],[{key:"isSupported",value:function(){return!0}},{key:"usePopupClass",value:function(e){(0,l.isDefined)(e)&&(y=e)}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}]),t}()},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(e){r=u}}();var a,c=[],l=!1,f=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=s(h);l=!0;for(var t=c.length;t;){for(a=c,c=[];++f<t;)a&&a[f].run();f=-1,t=c.length}a=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||s(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){},function(e,t,n){var r=n(30),i=Object.prototype,o=i.hasOwnProperty,u=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=u.call(e);return r&&(t?e[s]=n:delete e[s]),i}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){(function(e,r){var i;!function(o){"object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType;var u="object"==typeof r&&r;u.global!==u&&u.window!==u&&u.self;var s,a=2147483647,c=36,l=1,f=26,h=38,p=700,d=72,y=128,v="-",b=/^xn--/,_=/[^\x20-\x7E]/,g=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=c-l,O=Math.floor,k=String.fromCharCode;function P(e){throw new RangeError(m[e])}function E(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function j(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+E((e=e.replace(g,".")).split("."),t).join(".")}function S(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function C(e){return E(e,function(e){var t="";return e>65535&&(t+=k((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=k(e)}).join("")}function M(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,n){var r=0;for(e=n?O(e/p):e>>1,e+=O(e/t);e>w*f>>1;r+=c)e=O(e/w);return O(r+(w+1)*e/(e+h))}function A(e){var t,n,r,i,o,u,s,h,p,b,_,g=[],m=e.length,w=0,k=y,E=d;for((n=e.lastIndexOf(v))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&P("not-basic"),g.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(o=w,u=1,s=c;i>=m&&P("invalid-input"),((h=(_=e.charCodeAt(i++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||h>O((a-w)/u))&&P("overflow"),w+=h*u,!(h<(p=s<=E?l:s>=E+f?f:s-E));s+=c)u>O(a/(b=c-p))&&P("overflow"),u*=b;E=T(w-o,t=g.length+1,0==o),O(w/t)>a-k&&P("overflow"),k+=O(w/t),w%=t,g.splice(w++,0,k)}return C(g)}function x(e){var t,n,r,i,o,u,s,h,p,b,_,g,m,w,E,j=[];for(g=(e=S(e)).length,t=y,n=0,o=d,u=0;u<g;++u)(_=e[u])<128&&j.push(k(_));for(r=i=j.length,i&&j.push(v);r<g;){for(s=a,u=0;u<g;++u)(_=e[u])>=t&&_<s&&(s=_);for(s-t>O((a-n)/(m=r+1))&&P("overflow"),n+=(s-t)*m,t=s,u=0;u<g;++u)if((_=e[u])<t&&++n>a&&P("overflow"),_==t){for(h=n,p=c;!(h<(b=p<=o?l:p>=o+f?f:p-o));p+=c)E=h-b,w=c-b,j.push(k(M(b+E%w,0))),h=O(E/w);j.push(k(M(h,0))),o=T(n,m,r==i),n=0,++r}++n,++t}return j.join("")}s={version:"1.4.1",ucs2:{decode:S,encode:C},decode:A,encode:x,toASCII:function(e){return j(e,function(e){return _.test(e)?"xn--"+x(e):e})},toUnicode:function(e){return j(e,function(e){return b.test(e)?A(e.slice(4).toLowerCase()):e})}},void 0===(i=function(){return s}.call(t,n,t,e))||(e.exports=i)}()}).call(t,n(41)(e),n(19))},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(176),t.encode=t.stringify=n(177)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var u={};if("string"!=typeof e||0===e.length)return u;var s=/\+/g;e=e.split(t);var a=1e3;o&&"number"==typeof o.maxKeys&&(a=o.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var l=0;l<c;++l){var f,h,p,d,y=e[l].replace(s,"%20"),v=y.indexOf(n);v>=0?(f=y.substr(0,v),h=y.substr(v+1)):(f=y,h=""),p=decodeURIComponent(f),d=decodeURIComponent(h),r(u,p)?i(u[p])?u[p].push(d):u[p]=[u[p],d]:u[p]=d}return u};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?o(u(e),function(u){var s=encodeURIComponent(r(u))+n;return i(e[u])?o(e[u],function(e){return s+encodeURIComponent(r(e))}).join(t):s+encodeURIComponent(r(e[u]))}).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var u=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){var r,i,o;o=function(){return function(){var e=arguments;"object"==typeof arguments[0]&&(e=arguments[0],arguments[1]);var t,n=[].slice.call(e,0).join("/");return t=(t=(t=function(e,t){return e.substr(0,t.length)===t}(t=n,"file://")?t.replace(/(\/{0,3})\/*/g,"$1"):(t=t.replace(/:\//g,"://")).replace(/([^:\s\%\3\A])\/+/g,"$1/")).replace(/\/(\?|&|#[^!])/g,"$1")).replace(/(\?.+)\?/g,"$1&")}},void 0!==e&&e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},function(e,t,n){var r=n(180),i=n(22);e.exports=function(e,t){return e&&r(e,t,i)}},function(e,t,n){var r=n(181)();e.exports=r},function(e,t){e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),u=r(t),s=u.length;s--;){var a=u[e?s:++i];if(!1===n(o[a],a,o))break}return t}}},function(e,t,n){var r=n(20),i=n(14),o="[object Arguments]";e.exports=function(e){return i(e)&&r(e)==o}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(20),i=n(68),o=n(14),u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Arguments]"]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u["[object Map]"]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u["[object Set]"]=u["[object String]"]=u["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!u[r(e)]}},function(e,t,n){var r=n(104)(Object.keys,Object);e.exports=r},function(e,t,n){var r=n(24);e.exports=function(e,t){return function(n,i){if(null==n)return n;if(!r(n))return e(n,i);for(var o=n.length,u=t?o:-1,s=Object(n);(t?u--:++u<o)&&!1!==i(s[u],u,s););return n}}},function(e,t){e.exports=function(e){return null===e}},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,n){"use strict";var r=n(110),i=n(73),o=n(113);t.toSubscriber=function(e,t,n){if(e){if(e instanceof r.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||n?new r.Subscriber(e,t,n):new r.Subscriber(o.empty)}},function(e,t,n){"use strict";var r=n(191),i=n(192),o=n(111),u=n(193),s=n(112),a=n(194),c=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,c=this._parents,f=this._unsubscribe,h=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var p=-1,d=c?c.length:0;n;)n.remove(this),n=++p<d&&c[p]||null;if(o.isFunction(f))u.tryCatch(f).call(this)===s.errorObject&&(t=!0,e=e||(s.errorObject.e instanceof a.UnsubscriptionError?l(s.errorObject.e.errors):[s.errorObject.e]));if(r.isArray(h))for(p=-1,d=h.length;++p<d;){var y=h[p];if(i.isObject(y))if(u.tryCatch(y.unsubscribe).call(y)===s.errorObject){t=!0,e=e||[];var v=s.errorObject.e;v instanceof a.UnsubscriptionError?e=e.concat(l(v.errors)):e.push(v)}}if(t)throw new a.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;t&&t!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}();function l(e){return e.reduce(function(e,t){return e.concat(t instanceof a.UnsubscriptionError?t.errors:t)},[])}t.Subscription=c},function(e,t,n){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";t.isObject=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";var r,i=n(112);function o(){try{return r.apply(this,arguments)}catch(e){return i.errorObject.e=e,i.errorObject}}t.tryCatch=function(e){return r=e,o}},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=function(e){function t(t){e.call(this),this.errors=t;var n=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return r(t,e),t}(Error);t.UnsubscriptionError=i},function(e,t,n){"use strict";var r=n(72);function i(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}t.getSymbolObservable=i,t.observable=i(r.root),t.$$observable=t.observable},function(e,t,n){"use strict";var r=n(197);function i(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:r.noop}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i(e)},t.pipeFromArray=i},function(e,t,n){"use strict";t.noop=function(){}},function(e,t,n){var r=n(23)(n(13),"DataView");e.exports=r},function(e,t,n){var r=n(25),i=n(200),o=n(11),u=n(114),s=/^\[object .+?Constructor\]$/,a=Function.prototype,c=Object.prototype,l=a.toString,f=c.hasOwnProperty,h=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(u(e))}},function(e,t,n){var r,i=n(201),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(13)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(23)(n(13),"Promise");e.exports=r},function(e,t,n){var r=n(23)(n(13),"Set");e.exports=r},function(e,t,n){var r=n(23)(n(13),"WeakMap");e.exports=r},function(e,t,n){var r=n(207);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},function(e,t,n){var r=n(208),i=1/0,o=1.7976931348623157e308;e.exports=function(e){return e?(e=r(e))===i||e===-i?(e<0?-1:1)*o:e==e?e:0:0===e?e:0}},function(e,t,n){var r=n(11),i=n(45),o=NaN,u=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(i(e))return o;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(u,"");var n=a.test(e);return n||c.test(e)?l(e.slice(2),n?2:8):s.test(e)?o:+e}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t,n){var r=n(211),i=n(116),o=n(44),u=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=u},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var n=800,r=16,i=Date.now;e.exports=function(e){var t=0,o=0;return function(){var u=i(),s=r-(u-o);if(o=u,s>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserError=i;var r=n(0);function i(e,t,n,r){this.name="ActiveUserError",this.message=e||"An active user already exists.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotAvailableError=i;var r=n(0);function i(e,t,n,r){this.name="APIVersionNotAvailableError",this.message=e||"This API version is not available for your app.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotImplementedError=i;var r=n(0);function i(e,t,n,r){this.name="APIVersionNotImplementedError",this.message=e||"This API version is not implemented.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppProblemError=i;var r=n(0);function i(e,t,n,r){this.name="AppProblemError",this.message=e||"There is a problem with this app backend that prevents execution of this operation. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BadRequestError=i;var r=n(0);function i(e,t,n,r){this.name="BadRequestError",this.message=e||"Unable to understand request.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLError=i;var r=n(0);function i(e,t,n,r){this.name="BLError",this.message=e||"The Business Logic script did not complete.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CORSDisabledError=i;var r=n(0);function i(e,t,n,r){this.name="CORSDisabledError",this.message=e||"Cross Origin Support is disabled for this application.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateEndUsersError=i;var r=n(0);function i(e,t,n,r){this.name="DuplicateEndUsersError",this.message=e||"More than one user registered with this username for this application.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureUnavailableError=i;var r=n(0);function i(e,t,n,r){this.name="FeatureUnavailableError",this.message=e||"Requested functionality is unavailable in this API version.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IncompleteRequestBodyError=i;var r=n(0);function i(e,t,n,r){this.name="IncompleteRequestBodyError",this.message=e||"The request body is either missing or incomplete.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndirectCollectionAccessDisallowedError=i;var r=n(0);function i(e,t,n,r){this.name="IndirectCollectionAccessDisallowedError",this.message=e||"Please use the appropriate API to access this collection for this app backend.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsufficientCredentialsError=i;var r=n(0);function i(e,t,n,r){this.name="InsufficientCredentialsError",this.message=e||"The credentials used to authenticate this request are not authorized to run this operation. Please retry your request with appropriate credentials.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCachedQuery=i;var r=n(0);function i(e,t,n,r){this.name="InvalidCachedQuery",this.message=e||"Invalid cached query.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCredentialsError=i;var r=n(0);function i(e,t,n,r){this.name="InvalidCredentialsError",this.message=e||"Invalid credentials. Please retry your request with correct credentials.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidIdentifierError=i;var r=n(0);function i(e,t,n,r){this.name="InvalidIdentifierError",this.message=e||"One of more identifier names in the request has an invalid format.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidQuerySyntaxError=i;var r=n(0);function i(e,t,n,r){this.name="InvalidQuerySyntaxError",this.message=e||"The query string in the request has an invalid syntax.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONParseError=i;var r=n(0);function i(e,t,n,r){this.name="JSONParseError",this.message=e||"Unable to parse the JSON in the request.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyError=i;var r=n(0);function i(e,t,n,r){this.name="KinveyError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorRetry=i;var r=n(0);function i(e,t,n,r){this.name="KinveyInternalErrorRetry",this.message=e||"The Kinvey server encountered an unexpected error. Please retry your request.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorStop=i;var r=n(0);function i(e,t,n,r){this.name="KinveyInternalErrorStop",this.message=e||"The Kinvey server encountered an unexpected error. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingConfigurationError=i;var r=n(0);function i(e,t,n,r){this.name="MissingConfigurationError",this.message=e||"Missing configuration error.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingQueryError=i;var r=n(0);function i(e,t,n,r){this.name="MissingQueryError",this.message=e||"The request is missing a query string.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestHeaderError=i;var r=n(0);function i(e,t,n,r){this.name="MissingRequestHeaderError",this.message=e||"The request is missing a required header.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestParameterError=i;var r=n(0);function i(e,t,n,r){this.name="MissingRequestParameterError",this.message=e||"A required parameter is missing from the request.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnectError=i;var r=n(0);function i(e,t,n,r){this.name="MobileIdentityConnectError",this.message=e||"An error has occurred with Mobile Identity Connect.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkConnectionError=i;var r=n(0);function i(e,t,n,r){this.name="NetworkConnectionError",this.message=e||"There was an error connecting to the network.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoActiveUserError=i;var r=n(0);function i(e,t,n,r){this.name="NoActiveUserError",this.message=e||"There is not an active user.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoResponseError=i;var r=n(0);function i(e,t,n,r){this.name="NoResponseError",this.message=e||"No response was provided.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotFoundError=i;var r=n(0);function i(e,t,n,r){this.name="NotFoundError",this.message=e||"The entity was not found.",this.debug=t||void 0,this.code=n||404,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterValueOutOfRangeError=i;var r=n(0);function i(e,t,n,r){this.name="ParameterValueOutOfRangeError",this.message=e||"The value specified for one of the request parameters is out of range.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PopupError=i;var r=n(0);function i(e,t,n,r){this.name="PopupError",this.message=e||"Unable to open a popup on this platform.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryError=i;var r=n(0);function i(e,t,n,r){this.name="QueryError",this.message=e||"An error occurred with the query.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultSetSizeExceededError=i;var r=n(0);function i(e,t,n,r){this.name="ResultSetSizeExceededError",this.message=e||"Result set size exceeded.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=i;var r=n(0);function i(e,t,n,r){this.name="ServerError",this.message=e||"An error occurred on the server.",this.debug=t||void 0,this.code=n||500,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaleRequestError=i;var r=n(0);function i(e,t,n,r){this.name="StaleRequestError",this.message=e||"The time window for this request has expired.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncError=i;var r=n(0);function i(e,t,n,r){this.name="SyncError",this.message=e||"An error occurred during sync.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutError=i;var r=n(0);function i(e,t,n,r){this.name="TimeoutError",this.message=e||"The request timed out.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserAlreadyExistsError=i;var r=n(0);function i(e,t,n,r){this.name="UserAlreadyExistsError",this.message=e||"This username is already taken. Please retry your request with a different username.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WritesToCollectionDisallowedError=i;var r=n(0);function i(e,t,n,r){this.name="WritesToCollectionDisallowedError",this.message=e||"This collection is configured to disallow any modifications to an existing entity or creation of new entities.",this.debug=t||void 0,this.code=n||void 0,this.kinveyRequestId=r||void 0,this.stack=(new Error).stack}i.prototype=Object.create(r.BaseError.prototype),i.prototype.constructor=i},function(e,t){!function(){"use strict";function n(e){return"function"==typeof e}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e){return e instanceof Date?e.getTime():r(e)?e.map(i):e&&"function"==typeof e.toJSON?e.toJSON():e}function o(e,t){return n(e.get)?e.get(t):e[t]}function u(e){return function(t,n){if(!r(n)||!n.length)return e(t,n);for(var i=0,u=n.length;i<u;i++)if(e(t,o(n,i)))return!0;return!1}}function s(e,t,n,r){return e.v(e.a,t,n,r)}var a,c={$eq:u(function(e,t){return e(t)}),$ne:(a=function(e,t){return!e(t)},function(e,t){if(!r(t)||!t.length)return a(e,t);for(var n=0,i=t.length;n<i;n++)if(!a(e,o(t,n)))return!1;return!0}),$gt:u(function(e,t){return b.compare(i(t),e)>0}),$gte:u(function(e,t){return b.compare(i(t),e)>=0}),$lt:u(function(e,t){return b.compare(i(t),e)<0}),$lte:u(function(e,t){return b.compare(i(t),e)<=0}),$mod:u(function(e,t){return t%e[0]==e[1]}),$in:function(e,t){if(!(t instanceof Array)){var n=i(t);if(n===t&&"object"==typeof t)for(u=e.length;u--;)if(String(e[u])===String(t)&&"[object Object]"!==String(t))return!0;if(void 0===n)for(u=e.length;u--;)if(null==e[u])return!0;for(u=e.length;u--;){var r=s(v(o(e,u),void 0),t,u,e);if(r&&"[object Object]"!==String(r)&&"[object Object]"!==String(t))return!0}return!!~e.indexOf(n)}for(var u=t.length;u--;)if(~e.indexOf(i(o(t,u))))return!0;return!1},$nin:function(e,t,n,r){return!c.$in(e,t,n,r)},$not:function(e,t,n,r){return!s(e,t,n,r)},$type:function(e,t){return void 0!=t&&(t instanceof e||t.constructor==e)},$all:function(e,t,n,r){return c.$and(e,t,n,r)},$size:function(e,t){return!!t&&e===t.length},$or:function(e,t,n,r){for(var i=0,u=e.length;i<u;i++)if(s(o(e,i),t,n,r))return!0;return!1},$nor:function(e,t,n,r){return!c.$or(e,t,n,r)},$and:function(e,t,n,r){for(var i=0,u=e.length;i<u;i++)if(!s(o(e,i),t,n,r))return!1;return!0},$regex:u(function(e,t){return"string"==typeof t&&e.test(t)}),$where:function(e,t,n,r){return e.call(t,t,n,r)},$elemMatch:function(e,t,n,i){return r(t)?!!~f(t,e):s(e,t,n,i)},$exists:function(e,t,n,r){return r.hasOwnProperty(n)===e}},l={$eq:function(e){return e instanceof RegExp?function(t){return"string"==typeof t&&e.test(t)}:e instanceof Function?e:r(e)&&!e.length?function(e){return r(e)&&!e.length}:null===e?function(e){return null==e}:function(t){return 0===b.compare(i(t),e)}},$ne:function(e){return l.$eq(e)},$and:function(e){return e.map(y)},$all:function(e){return l.$and(e)},$or:function(e){return e.map(y)},$nor:function(e){return e.map(y)},$not:function(e){return y(e)},$regex:function(e,t){return new RegExp(e,t.$options)},$where:function(e){return"string"==typeof e?new Function("obj","return "+e):e},$elemMatch:function(e){return y(e)},$exists:function(e){return!!e}};function f(e,t){for(var n=0;n<e.length;n++){o(e,n);if(s(t,o(e,n)))return n}return-1}function h(e,t){return{a:e,v:t}}function p(e,t){var n=[];if(function e(t,n,i,u,s){if(i===n.length||void 0==t)return void s.push([t,n[i-1],u]);var a=o(n,i);if(r(t)&&isNaN(Number(a)))for(var c=0,l=t.length;c<l;c++)e(o(t,c),n,i,t,s);else e(o(t,a),n,i+1,t,s)}(t,e.k,0,t,n),1===n.length){var i=n[0];return s(e.nv,i[0],i[1],i[2])}for(var u=0;u<n.length;u++){var a=n[u];if(s(e.nv,a[0],a[1],a[2]))return!0}return!1}function d(e,t){return{a:{k:e,nv:t},v:p}}function y(e){var t;(e=i(e))&&((t=e)&&t.constructor===Object)||(e={$eq:e});var n=[];for(var r in e){var o=e[r];if("$options"!==r)if(c[r])l[r]&&(o=l[r](o,e)),n.push(h(i(o),c[r]));else{if(36===r.charCodeAt(0))throw new Error("Unknown operation "+r);n.push(d(r.split("."),y(o)))}}return 1===n.length?n[0]:h(n,c.$and)}function v(e,t){var n=y(e);return t&&(n={a:n,v:function(e,n,r,i){return s(e,t(n),r,i)}}),n}function b(e,t,r){n(t)&&(r=t,t=void 0);var i=v(e,r);function o(e,t,n){return s(i,e,t,n)}return t?t.filter(o):o}b.use=function(e){if(n(e))return e(b);for(var t in e)36===t.charCodeAt(0)&&(c[t]=e[t])},b.indexOf=function(e,t,n){return f(t,v(e,n))},b.compare=function(e,t){if(e===t)return 0;if(typeof e==typeof t){if(e>t)return 1;if(e<t)return-1}},void 0!==e&&void 0!==e.exports&&(Object.defineProperty(t,"__esModule",{value:!0}),e.exports=b,t.default=e.exports.default=b),"undefined"!=typeof window&&(window.sift=b)}()},function(e,t,n){var r=n(11),i=n(32),o=n(254),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&u.call(e,s))&&n.push(s);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){var r,i;!function(o,u){"use strict";void 0===(i="function"==typeof(r=u)?r.call(t,n,t,e):r)||(e.exports=i)}(0,function(){"use strict";var e=function(){},t="undefined",n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(t){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(t,r){for(var i=0;i<n.length;i++){var o=n[i];this[o]=i<t?e:this.methodFactory(o,t,r)}this.log=this.debug}function o(n,o,u){return function(n){return"debug"===n&&(n="log"),typeof console!==t&&(void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}(n)||function(e,n,r){return function(){typeof console!==t&&(i.call(this,n,r),this[e].apply(this,arguments))}}.apply(this,arguments)}function u(e,r,u){var s,a=this,c="loglevel";function l(){var e;if(typeof window!==t){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var n=window.document.cookie,r=n.indexOf(encodeURIComponent(c)+"=");-1!==r&&(e=/^([^;]+)/.exec(n.slice(r))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}e&&(c+=":"+e),a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=u||o,a.getLevel=function(){return s},a.setLevel=function(r,o){if("string"==typeof r&&void 0!==a.levels[r.toUpperCase()]&&(r=a.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==o&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[c]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+r+";"}catch(e){}}}(r),i.call(a,r,e),typeof console===t&&r<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){l()||a.setLevel(e,!1)},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var f=l();null==f&&(f=null==r?"WARN":r),a.setLevel(f,!1)}var s=new u,a={};s.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=a[e];return t||(t=a[e]=new u(e,s.getLevel(),s.methodFactory)),t};var c=typeof window!==t?window.log:void 0;return s.noConflict=function(){return typeof window!==t&&window.log===s&&(window.log=c),s},s})},function(e,t,n){"use strict";function r(){this._cache=i(),this._timeouts=i()}function i(){return Object.create(null)}r.prototype.get=function(e){return this._cache[e]},r.prototype.set=function(e,t,n){this.delete(e),this._cache[e]=t,n&&(this._timeouts[e]=setTimeout(this.delete.bind(this,e),1e3*n))},r.prototype.delete=function(e){delete this._cache[e],e in this._timeouts&&(clearTimeout(this._timeouts[e]),delete this._timeouts[e])},r.prototype.clear=function(){for(var e in this._cache=i(),this._timeouts)clearTimeout(this._timeouts[e]);this._timeouts=i()},e.exports=r},function(e,t,n){var r=n(31);e.exports=function(e){return r(e)&&e!=+e}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(48),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},function(e,t,n){var r=n(48);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(48);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(48);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},function(e,t,n){var r=n(47);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(47),i=n(74),o=n(80),u=200;e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var s=n.__data__;if(!i||s.length<u-1)return s.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(s)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(269),i=n(47),o=n(74);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},function(e,t,n){var r=n(270),i=n(271),o=n(272),u=n(273),s=n(274);function a(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}a.prototype.clear=r,a.prototype.delete=i,a.prototype.get=o,a.prototype.has=u,a.prototype.set=s,e.exports=a},function(e,t,n){var r=n(49);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(49),i="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return n===i?void 0:n}return o.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(49),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},function(e,t,n){var r=n(49),i="__lodash_hash_undefined__";e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?i:t,this}},function(e,t,n){var r=n(50);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(50);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(50);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(50);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},function(e,t,n){var r=n(28),i=n(22);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t,n){var r=n(28),i=n(46);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t,n){(function(e){var r=n(13),i="object"==typeof t&&t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,u=o&&o.exports===i?r.Buffer:void 0,s=u?u.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=s?s(n):new e.constructor(n);return e.copy(r),r}}).call(t,n(41)(e))},function(e,t){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},function(e,t,n){var r=n(28),i=n(81);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var u=e[n];t(u,n,e)&&(o[i++]=u)}return o}},function(e,t,n){var r=n(28),i=n(122);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t,n){var r=n(124),i=n(122),o=n(46);e.exports=function(e){return r(e,o,i)}},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},function(e,t,n){var r=n(82),i=n(290),o=n(291),u=n(292),s=n(293),a="[object Boolean]",c="[object Date]",l="[object Map]",f="[object Number]",h="[object RegExp]",p="[object Set]",d="[object String]",y="[object Symbol]",v="[object ArrayBuffer]",b="[object DataView]",_="[object Float32Array]",g="[object Float64Array]",m="[object Int8Array]",w="[object Int16Array]",O="[object Int32Array]",k="[object Uint8Array]",P="[object Uint8ClampedArray]",E="[object Uint16Array]",j="[object Uint32Array]";e.exports=function(e,t,n){var S=e.constructor;switch(t){case v:return r(e);case a:case c:return new S(+e);case b:return i(e,n);case _:case g:case m:case w:case O:case k:case P:case E:case j:return s(e,n);case l:return new S;case f:case d:return new S(e);case h:return o(e);case p:return new S;case y:return u(e)}}},function(e,t,n){var r=n(82);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},function(e,t){var n=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){var r=n(30),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},function(e,t,n){var r=n(82);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t,n){var r=n(295),i=n(71),o=n(32);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},function(e,t,n){var r=n(11),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},function(e,t,n){var r=n(297),i=n(69),o=n(70),u=o&&o.isMap,s=u?i(u):r;e.exports=s},function(e,t,n){var r=n(34),i=n(14),o="[object Map]";e.exports=function(e){return i(e)&&r(e)==o}},function(e,t,n){var r=n(299),i=n(69),o=n(70),u=o&&o.isSet,s=u?i(u):r;e.exports=s},function(e,t,n){var r=n(34),i=n(14),o="[object Set]";e.exports=function(e){return i(e)&&r(e)==o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(301);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveCollectionManager=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.getLiveCollectionManager=function(e){l||(l=new c(e));return l};var i=n(2),o=n(7),u=n(1),s=n(9),a=n(51);var c=t.LiveCollectionManager=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||o.Client.sharedInstance()}return r(e,[{key:"subscribeCollection",value:function(e,t){var n=this;return(0,a.isValidChannelName)(e)?(0,a.isValidReceiver)(t)?this._makeSubscriptionRequest(e,"_subscribe").then(function(){var r=n._buildChannelName(e),i=n._buildPersonalChannelName(e),o=(0,a.getLiveService)();o.subscribeToChannel(r,t),o.subscribeToChannel(i,t)}):i.Promise.reject(new u.KinveyError("Invalid or missing receiver")):i.Promise.reject(new u.KinveyError("Invalid or missing collection name"))}},{key:"unsubscribeCollection",value:function(e){var t=this;return(0,a.isValidChannelName)(e)?this._makeSubscriptionRequest(e,"_unsubscribe").then(function(){var n=t._buildChannelName(e),r=t._buildPersonalChannelName(e),i=(0,a.getLiveService)();i.unsubscribeFromChannel(n),i.unsubscribeFromChannel(r)}):i.Promise.reject(new u.KinveyError("Invalid or missing collection name"))}},{key:"_buildChannelName",value:function(e){return this._client.appKey+".c-"+e}},{key:"_buildPersonalChannelName",value:function(e){return this._buildChannelName(e)+".u-"+this._client.getActiveUser()._id}},{key:"_makeSubscriptionRequest",value:function(e,t){return s.KinveyRequest.execute({method:s.RequestMethod.POST,pathname:"/appdata/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}})}}]),e}(),l=void 0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(303)),i=s(n(332)),o=s(n(333)),u=n(334);n(4);function s(e){return e&&e.__esModule?e:{default:e}}var a=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.db=new o.default,e.networking=new i.default({del:u.del,get:u.get,post:u.post}),e.sdkFamily="NativeScript",function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=q(n(29)),o=q(n(126)),u=q(n(306)),s=q(n(127)),a=q(n(309)),c=N(n(310)),l=N(n(311)),f=N(n(312)),h=N(n(313)),p=N(n(314)),d=N(n(315)),y=N(n(316)),v=N(n(317)),b=N(n(318)),_=N(n(319)),g=N(n(320)),m=N(n(321)),w=N(n(322)),O=N(n(323)),k=N(n(324)),P=N(n(325)),E=N(n(326)),j=N(n(327)),S=N(n(328)),C=N(n(329)),M=N(n(330)),T=N(n(128)),A=N(n(331)),x=q(n(5)),R=q(n(52)),I=(n(4),q(n(83)));function N(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function q(e){return e&&e.__esModule?e:{default:e}}var D=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=t.db,x=t.networking,R=this._config=new i.default({setup:t,db:r}),I=new o.default({config:R});x.init(R);var N={config:R,networking:x,crypto:I},q=a.default.bind(this,N,T),D=a.default.bind(this,N,_),U=a.default.bind(this,N,m),K=a.default.bind(this,N,O),L=a.default.bind(this,N,A),F=this._listenerManager=new s.default,B=new u.default({timeEndpoint:q,leaveEndpoint:D,heartbeatEndpoint:U,setStateEndpoint:K,subscribeEndpoint:L,crypto:N.crypto,config:N.config,listenerManager:F});this.addListener=F.addListener.bind(F),this.removeListener=F.removeListener.bind(F),this.removeAllListeners=F.removeAllListeners.bind(F),this.channelGroups={listGroups:a.default.bind(this,N,h),listChannels:a.default.bind(this,N,p),addChannels:a.default.bind(this,N,c),removeChannels:a.default.bind(this,N,l),deleteGroup:a.default.bind(this,N,f)},this.push={addChannels:a.default.bind(this,N,d),removeChannels:a.default.bind(this,N,y),deleteDevice:a.default.bind(this,N,b),listChannels:a.default.bind(this,N,v)},this.hereNow=a.default.bind(this,N,k),this.whereNow=a.default.bind(this,N,g),this.getState=a.default.bind(this,N,w),this.setState=B.adaptStateChange.bind(B),this.grant=a.default.bind(this,N,E),this.audit=a.default.bind(this,N,P),this.publish=a.default.bind(this,N,j),this.fire=function(e,t){return e.replicate=!1,e.storeInHistory=!1,n.publish(e,t)},this.history=a.default.bind(this,N,S),this.deleteMessages=a.default.bind(this,N,C),this.fetchMessages=a.default.bind(this,N,M),this.time=q,this.subscribe=B.adaptSubscribeChange.bind(B),this.presence=B.adaptPresenceChange.bind(B),this.unsubscribe=B.adaptUnsubscribeChange.bind(B),this.disconnect=B.disconnect.bind(B),this.reconnect=B.reconnect.bind(B),this.destroy=function(e){B.unsubscribeAll(e),B.disconnect()},this.stop=this.destroy,this.unsubscribeAll=B.unsubscribeAll.bind(B),this.getSubscribedChannels=B.getSubscribedChannels.bind(B),this.getSubscribedChannelGroups=B.getSubscribedChannelGroups.bind(B),this.encrypt=I.encrypt.bind(I),this.decrypt=I.decrypt.bind(I),this.getAuthKey=N.config.getAuthKey.bind(N.config),this.setAuthKey=N.config.setAuthKey.bind(N.config),this.setCipherKey=N.config.setCipherKey.bind(N.config),this.getUUID=N.config.getUUID.bind(N.config),this.setUUID=N.config.setUUID.bind(N.config),this.getFilterExpression=N.config.getFilterExpression.bind(N.config),this.setFilterExpression=N.config.setFilterExpression.bind(N.config),this.setHeartbeatInterval=N.config.setHeartbeatInterval.bind(N.config),x.hasModule("proxy")&&(this.setProxy=function(e){N.config.setProxy(e),n.reconnect()})}return r(e,[{key:"getVersion",value:function(){return this._config.getVersion()}},{key:"networkDownDetected",value:function(){this._listenerManager.announceNetworkDown(),this._config.restore?this.disconnect():this.destroy(!0)}},{key:"networkUpDetected",value:function(){this._listenerManager.announceNetworkUp(),this.reconnect()}}],[{key:"generateUUID",value:function(){return I.default.createUUID()}}]),e}();D.OPERATIONS=x.default,D.CATEGORIES=R.default,t.default=D,e.exports=t.default},function(e,t,n){var r,i,o,u;u=function(e){var t={3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[0-9A-F]{4}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,all:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i};function n(){var e,t,n="";for(e=0;e<32;e++)t=16*Math.random()|0,8!==e&&12!==e&&16!==e&&20!==e||(n+="-"),n+=(12===e?4:16===e?3&t|8:t).toString(16);return n}function r(e,n){var r=t[n||"all"];return r&&r.test(e)||!1}n.isUUID=r,n.VERSION="0.1.0",e.uuid=n,e.isUUID=r},i=[t],void 0===(o="function"==typeof(r=u)?r.apply(t,i):r)||(e.exports=o)},function(e,t,n){"use strict";var r,i,o,u,s,a=a||function(e,t){var n={},r=n.lib={},i=function(){},o=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=r.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new u.init(n,t)}}),s=n.enc={},a=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new u.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new u.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,s=i/(4*o);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,i=e.min(4*t,i),t){for(var a=0;a<t;a+=o)this._doProcessBlock(r,a);a=r.splice(0,t),n.sigBytes-=i}return new u.init(a,i)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);!function(e){for(var t=a,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,o=[],u=[],s=function(e){return 4294967296*(e-(0|e))|0},c=2,l=0;64>l;){var f;e:{f=c;for(var h=e.sqrt(f),p=2;p<=h;p++)if(!(f%p)){f=!1;break e}f=!0}f&&(8>l&&(o[l]=s(e.pow(c,.5))),u[l]=s(e.pow(c,1/3)),l++),c++}var d=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(o.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],f=n[7],h=0;64>h;h++){if(16>h)d[h]=0|e[t+h];else{var p=d[h-15],y=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10)+d[h-16]}p=f+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&l)+u[h]+d[h],y=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&o^i&o),f=l,l=c,c=a,a=s+p|0,s=o,o=i,i=r,r=p+y|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),i=(r=a).enc.Utf8,r.algo.HMAC=r.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),u=this._iKey=t.clone(),s=o.words,a=u.words,c=0;c<n;c++)s[c]^=1549556828,a[c]^=909522486;o.sigBytes=u.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),u=(o=a).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,u=0;4>u&&i+.75*u<n;u++)e.push(r.charAt(o>>>6*(3-u)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,n=this._map;(r=n.charAt(64))&&-1!=(r=e.indexOf(r))&&(t=r);for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=n.indexOf(e.charAt(o-1))<<o%4*2,a=n.indexOf(e.charAt(o))>>>6-o%4*2;r[i>>>2]|=(s|a)<<24-i%4*8,i++}return u.create(r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,i,o,u){return((e=e+(t&n|~t&r)+i+u)<<o|e>>>32-o)+t}function n(e,t,n,r,i,o,u){return((e=e+(t&r|n&~r)+i+u)<<o|e>>>32-o)+t}function r(e,t,n,r,i,o,u){return((e=e+(t^n^r)+i+u)<<o|e>>>32-o)+t}function i(e,t,n,r,i,o,u){return((e=e+(n^(t|~r))+i+u)<<o|e>>>32-o)+t}for(var o=a,u=(c=o.lib).WordArray,s=c.Hasher,c=o.algo,l=[],f=0;64>f;f++)l[f]=4294967296*e.abs(e.sin(f+1))|0;c=c.MD5=s.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,o){for(var u=0;16>u;u++){var s=e[f=o+u];e[f]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}u=this._hash.words;var a,c,f=e[o+0],h=(s=e[o+1],e[o+2]),p=e[o+3],d=e[o+4],y=e[o+5],v=e[o+6],b=e[o+7],_=e[o+8],g=e[o+9],m=e[o+10],w=e[o+11],O=e[o+12],k=e[o+13],P=e[o+14],E=e[o+15],j=u[0],S=i(S=i(S=i(S=i(S=r(S=r(S=r(S=r(S=n(S=n(S=n(S=n(S=t(S=t(S=t(S=t(S=u[1],c=t(c=u[2],a=t(a=u[3],j=t(j,S,c,a,f,7,l[0]),S,c,s,12,l[1]),j,S,h,17,l[2]),a,j,p,22,l[3]),c=t(c,a=t(a,j=t(j,S,c,a,d,7,l[4]),S,c,y,12,l[5]),j,S,v,17,l[6]),a,j,b,22,l[7]),c=t(c,a=t(a,j=t(j,S,c,a,_,7,l[8]),S,c,g,12,l[9]),j,S,m,17,l[10]),a,j,w,22,l[11]),c=t(c,a=t(a,j=t(j,S,c,a,O,7,l[12]),S,c,k,12,l[13]),j,S,P,17,l[14]),a,j,E,22,l[15]),c=n(c,a=n(a,j=n(j,S,c,a,s,5,l[16]),S,c,v,9,l[17]),j,S,w,14,l[18]),a,j,f,20,l[19]),c=n(c,a=n(a,j=n(j,S,c,a,y,5,l[20]),S,c,m,9,l[21]),j,S,E,14,l[22]),a,j,d,20,l[23]),c=n(c,a=n(a,j=n(j,S,c,a,g,5,l[24]),S,c,P,9,l[25]),j,S,p,14,l[26]),a,j,_,20,l[27]),c=n(c,a=n(a,j=n(j,S,c,a,k,5,l[28]),S,c,h,9,l[29]),j,S,b,14,l[30]),a,j,O,20,l[31]),c=r(c,a=r(a,j=r(j,S,c,a,y,4,l[32]),S,c,_,11,l[33]),j,S,w,16,l[34]),a,j,P,23,l[35]),c=r(c,a=r(a,j=r(j,S,c,a,s,4,l[36]),S,c,d,11,l[37]),j,S,b,16,l[38]),a,j,m,23,l[39]),c=r(c,a=r(a,j=r(j,S,c,a,k,4,l[40]),S,c,f,11,l[41]),j,S,p,16,l[42]),a,j,v,23,l[43]),c=r(c,a=r(a,j=r(j,S,c,a,g,4,l[44]),S,c,O,11,l[45]),j,S,E,16,l[46]),a,j,h,23,l[47]),c=i(c,a=i(a,j=i(j,S,c,a,f,6,l[48]),S,c,b,10,l[49]),j,S,P,15,l[50]),a,j,y,21,l[51]),c=i(c,a=i(a,j=i(j,S,c,a,O,6,l[52]),S,c,p,10,l[53]),j,S,m,15,l[54]),a,j,s,21,l[55]),c=i(c,a=i(a,j=i(j,S,c,a,_,6,l[56]),S,c,E,10,l[57]),j,S,v,15,l[58]),a,j,k,21,l[59]),c=i(c,a=i(a,j=i(j,S,c,a,d,6,l[60]),S,c,w,10,l[61]),j,S,h,15,l[62]),a,j,g,21,l[63]);u[0]=u[0]+j|0,u[1]=u[1]+S|0,u[2]=u[2]+c|0,u[3]=u[3]+a|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var o=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),o.MD5=s._createHelper(c),o.HmacMD5=s._createHmacHelper(c)}(Math),function(){var e,t=a,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),i=r.create(),o=i.words,u=s.keySize,s=s.iterations;o.length<u;){a&&n.update(a);var a=n.update(e).finalize(t);n.reset();for(var c=1;c<s;c++)a=n.finalize(a),n.reset();i.concat(a)}return i.sigBytes=4*u,i}});t.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),a.lib.Cipher||function(e){var t=(d=a).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,o=d.enc.Base64,u=d.algo.EvpKDF,s=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?y:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?y:p).decrypt(e,t,n,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var c=d.mode={},l=function(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},f=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();f.Encryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),f.Decryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=i}}),c=c.CBC=f,f=(d.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,o=[],u=0;u<n;u+=4)o.push(i);n=r.create(o,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:c,padding:f}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),p=(c=(d.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(o)},parse:function(e){var t=(e=o.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:c}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),d=(d.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=u.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:i})}},y=t.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:d}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=p.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,p.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=a,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],o=[],u=[],s=[],c=[],l=[],f=[],h=[],p=[],d=[],y=0;256>y;y++)d[y]=128>y?y<<1:y<<1^283;var v=0,b=0;for(y=0;256>y;y++){var _=(_=b^b<<1^b<<2^b<<3^b<<4)>>>8^255&_^99;r[v]=_,i[_]=v;var g=d[v],m=d[g],w=d[m],O=257*d[_]^16843008*_;o[v]=O<<24|O>>>8,u[v]=O<<16|O>>>16,s[v]=O<<8|O>>>24,c[v]=O,O=16843009*w^65537*m^257*g^16843008*v,l[_]=O<<24|O>>>8,f[_]=O<<16|O>>>16,h[_]=O<<8|O>>>24,p[_]=O,v?(v=g^d[d[d[w^g]]],b^=d[d[b]]):v=b=1}var k=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],o=0;o<n;o++)if(o<t)i[o]=e[o];else{var u=i[o-1];o%t?6<t&&4==o%t&&(u=r[u>>>24]<<24|r[u>>>16&255]<<16|r[u>>>8&255]<<8|r[255&u]):(u=r[(u=u<<8|u>>>24)>>>24]<<24|r[u>>>16&255]<<16|r[u>>>8&255]<<8|r[255&u],u^=k[o/t|0]<<24),i[o]=i[o-t]^u}for(e=this._invKeySchedule=[],t=0;t<n;t++)o=n-t,u=t%4?i[o]:i[o-4],e[t]=4>t||4>=o?u:l[r[u>>>24]]^f[r[u>>>16&255]]^h[r[u>>>8&255]]^p[r[255&u]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,u,s,c,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,h,p,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,o,u,s){for(var a=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],h=e[t+3]^n[3],p=4,d=1;d<a;d++){var y=r[c>>>24]^i[l>>>16&255]^o[f>>>8&255]^u[255&h]^n[p++],v=r[l>>>24]^i[f>>>16&255]^o[h>>>8&255]^u[255&c]^n[p++],b=r[f>>>24]^i[h>>>16&255]^o[c>>>8&255]^u[255&l]^n[p++];h=r[h>>>24]^i[c>>>16&255]^o[l>>>8&255]^u[255&f]^n[p++],c=y,l=v,f=b}y=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^n[p++],v=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[p++],b=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^n[p++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^n[p++],e[t]=y,e[t+1]=v,e[t+2]=b,e[t+3]=h},keySize:8});e.AES=t._createHelper(n)}(),a.mode.ECB=((s=a.lib.BlockCipherMode.extend()).Encryptor=s.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),s.Decryptor=s.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),s),e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(a(n(126)),a(n(29)),a(n(127)),a(n(307))),o=a(n(308)),u=a(n(8)),s=(n(4),a(n(52)));function a(e){return e&&e.__esModule?e:{default:e}}var c=function(){function e(t){var n=t.subscribeEndpoint,r=t.leaveEndpoint,u=t.heartbeatEndpoint,s=t.setStateEndpoint,a=t.timeEndpoint,c=t.config,l=t.crypto,f=t.listenerManager;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._listenerManager=f,this._config=c,this._leaveEndpoint=r,this._heartbeatEndpoint=u,this._setStateEndpoint=s,this._subscribeEndpoint=n,this._crypto=l,this._channels={},this._presenceChannels={},this._heartbeatChannels={},this._heartbeatChannelGroups={},this._channelGroups={},this._presenceChannelGroups={},this._pendingChannelSubscriptions=[],this._pendingChannelGroupSubscriptions=[],this._currentTimetoken=0,this._lastTimetoken=0,this._storedTimetoken=null,this._subscriptionStatusAnnounced=!1,this._isOnline=!0,this._reconnectionManager=new i.default({timeEndpoint:a}),this._dedupingManager=new o.default({config:c})}return r(e,[{key:"adaptStateChange",value:function(e,t){var n=this,r=e.state,i=e.channels,o=void 0===i?[]:i,u=e.channelGroups,s=void 0===u?[]:u;return o.forEach(function(e){e in n._channels&&(n._channels[e].state=r)}),s.forEach(function(e){e in n._channelGroups&&(n._channelGroups[e].state=r)}),this._setStateEndpoint({state:r,channels:o,channelGroups:s},t)}},{key:"adaptPresenceChange",value:function(e){var t=this,n=e.connected,r=e.channels,i=void 0===r?[]:r,o=e.channelGroups,u=void 0===o?[]:o;n?(i.forEach(function(e){t._heartbeatChannels[e]={state:{}}}),u.forEach(function(e){t._heartbeatChannelGroups[e]={state:{}}})):(i.forEach(function(e){e in t._heartbeatChannels&&delete t._heartbeatChannels[e]}),u.forEach(function(e){e in t._heartbeatChannelGroups&&delete t._heartbeatChannelGroups[e]}),!1===this._config.suppressLeaveEvents&&this._leaveEndpoint({channels:i,channelGroups:u},function(e){t._listenerManager.announceStatus(e)})),this.reconnect()}},{key:"adaptSubscribeChange",value:function(e){var t=this,n=e.timetoken,r=e.channels,i=void 0===r?[]:r,o=e.channelGroups,u=void 0===o?[]:o,s=e.withPresence,a=void 0!==s&&s,c=e.withHeartbeats,l=void 0===c||c;this._config.subscribeKey&&""!==this._config.subscribeKey?(n&&(this._lastTimetoken=this._currentTimetoken,this._currentTimetoken=n),"0"!==this._currentTimetoken&&0!==this._currentTimetoken&&(this._storedTimetoken=this._currentTimetoken,this._currentTimetoken=0),i.forEach(function(e){t._channels[e]={state:{}},a&&(t._presenceChannels[e]={}),l&&(t._heartbeatChannels[e]={}),t._pendingChannelSubscriptions.push(e)}),u.forEach(function(e){t._channelGroups[e]={state:{}},a&&(t._presenceChannelGroups[e]={}),l&&(t._heartbeatChannelGroups[e]={}),t._pendingChannelGroupSubscriptions.push(e)}),this._subscriptionStatusAnnounced=!1,this.reconnect()):console&&console.log&&console.log("subscribe key missing; aborting subscribe")}},{key:"adaptUnsubscribeChange",value:function(e,t){var n=this,r=e.channels,i=void 0===r?[]:r,o=e.channelGroups,u=void 0===o?[]:o,s=[],a=[];i.forEach(function(e){e in n._channels&&(delete n._channels[e],s.push(e),e in n._heartbeatChannels&&delete n._heartbeatChannels[e]),e in n._presenceChannels&&(delete n._presenceChannels[e],s.push(e))}),u.forEach(function(e){e in n._channelGroups&&(delete n._channelGroups[e],a.push(e),e in n._heartbeatChannelGroups&&delete n._heartbeatChannelGroups[e]),e in n._presenceChannelGroups&&(delete n._channelGroups[e],a.push(e))}),0===s.length&&0===a.length||(!1!==this._config.suppressLeaveEvents||t||this._leaveEndpoint({channels:s,channelGroups:a},function(e){e.affectedChannels=s,e.affectedChannelGroups=a,e.currentTimetoken=n._currentTimetoken,e.lastTimetoken=n._lastTimetoken,n._listenerManager.announceStatus(e)}),0===Object.keys(this._channels).length&&0===Object.keys(this._presenceChannels).length&&0===Object.keys(this._channelGroups).length&&0===Object.keys(this._presenceChannelGroups).length&&(this._lastTimetoken=0,this._currentTimetoken=0,this._storedTimetoken=null,this._region=null,this._reconnectionManager.stopPolling()),this.reconnect())}},{key:"unsubscribeAll",value:function(e){this.adaptUnsubscribeChange({channels:this.getSubscribedChannels(),channelGroups:this.getSubscribedChannelGroups()},e)}},{key:"getHeartbeatChannels",value:function(){return Object.keys(this._heartbeatChannels)}},{key:"getHeartbeatChannelGroups",value:function(){return Object.keys(this._heartbeatChannelGroups)}},{key:"getSubscribedChannels",value:function(){return Object.keys(this._channels)}},{key:"getSubscribedChannelGroups",value:function(){return Object.keys(this._channelGroups)}},{key:"reconnect",value:function(){this._startSubscribeLoop(),this._registerHeartbeatTimer()}},{key:"disconnect",value:function(){this._stopSubscribeLoop(),this._stopHeartbeatTimer(),this._reconnectionManager.stopPolling()}},{key:"_registerHeartbeatTimer",value:function(){this._stopHeartbeatTimer(),0!==this._config.getHeartbeatInterval()&&(this._performHeartbeatLoop(),this._heartbeatTimer=setInterval(this._performHeartbeatLoop.bind(this),1e3*this._config.getHeartbeatInterval()))}},{key:"_stopHeartbeatTimer",value:function(){this._heartbeatTimer&&(clearInterval(this._heartbeatTimer),this._heartbeatTimer=null)}},{key:"_performHeartbeatLoop",value:function(){var e=this,t=this.getHeartbeatChannels(),n=this.getHeartbeatChannelGroups(),r={};if(0!==t.length||0!==n.length){this.getSubscribedChannels().forEach(function(t){var n=e._channels[t].state;Object.keys(n).length&&(r[t]=n)}),this.getSubscribedChannelGroups().forEach(function(t){var n=e._channelGroups[t].state;Object.keys(n).length&&(r[t]=n)});this._heartbeatEndpoint({channels:t,channelGroups:n,state:r},function(t){t.error&&e._config.announceFailedHeartbeats&&e._listenerManager.announceStatus(t),t.error&&e._config.autoNetworkDetection&&e._isOnline&&(e._isOnline=!1,e.disconnect(),e._listenerManager.announceNetworkDown(),e.reconnect()),!t.error&&e._config.announceSuccessfulHeartbeats&&e._listenerManager.announceStatus(t)}.bind(this))}}},{key:"_startSubscribeLoop",value:function(){this._stopSubscribeLoop();var e=[],t=[];if(Object.keys(this._channels).forEach(function(t){return e.push(t)}),Object.keys(this._presenceChannels).forEach(function(t){return e.push(t+"-pnpres")}),Object.keys(this._channelGroups).forEach(function(e){return t.push(e)}),Object.keys(this._presenceChannelGroups).forEach(function(e){return t.push(e+"-pnpres")}),0!==e.length||0!==t.length){var n={channels:e,channelGroups:t,timetoken:this._currentTimetoken,filterExpression:this._config.filterExpression,region:this._region};this._subscribeCall=this._subscribeEndpoint(n,this._processSubscribeResponse.bind(this))}}},{key:"_processSubscribeResponse",value:function(e,t){var n=this;if(e.error)e.category===s.default.PNTimeoutCategory?this._startSubscribeLoop():e.category===s.default.PNNetworkIssuesCategory?(this.disconnect(),e.error&&this._config.autoNetworkDetection&&this._isOnline&&(this._isOnline=!1,this._listenerManager.announceNetworkDown()),this._reconnectionManager.onReconnection(function(){n._config.autoNetworkDetection&&!n._isOnline&&(n._isOnline=!0,n._listenerManager.announceNetworkUp()),n.reconnect(),n._subscriptionStatusAnnounced=!0;var t={category:s.default.PNReconnectedCategory,operation:e.operation,lastTimetoken:n._lastTimetoken,currentTimetoken:n._currentTimetoken};n._listenerManager.announceStatus(t)}),this._reconnectionManager.startPolling(),this._listenerManager.announceStatus(e)):e.category===s.default.PNBadRequestCategory?(this._stopHeartbeatTimer(),this._listenerManager.announceStatus(e)):this._listenerManager.announceStatus(e);else{if(this._storedTimetoken?(this._currentTimetoken=this._storedTimetoken,this._storedTimetoken=null):(this._lastTimetoken=this._currentTimetoken,this._currentTimetoken=t.metadata.timetoken),!this._subscriptionStatusAnnounced){var r={};r.category=s.default.PNConnectedCategory,r.operation=e.operation,r.affectedChannels=this._pendingChannelSubscriptions,r.subscribedChannels=this.getSubscribedChannels(),r.affectedChannelGroups=this._pendingChannelGroupSubscriptions,r.lastTimetoken=this._lastTimetoken,r.currentTimetoken=this._currentTimetoken,this._subscriptionStatusAnnounced=!0,this._listenerManager.announceStatus(r),this._pendingChannelSubscriptions=[],this._pendingChannelGroupSubscriptions=[]}var i=t.messages||[],o=this._config,a=o.requestMessageCountThreshold,c=o.dedupeOnSubscribe;if(a&&i.length>=a){var l={};l.category=s.default.PNRequestMessageCountExceededCategory,l.operation=e.operation,this._listenerManager.announceStatus(l)}i.forEach(function(e){var t=e.channel,r=e.subscriptionMatch,i=e.publishMetaData;if(t===r&&(r=null),c){if(n._dedupingManager.isDuplicate(e))return;n._dedupingManager.addEntry(e)}if(u.default.endsWith(e.channel,"-pnpres")){var o={channel:null,subscription:null};o.actualChannel=null!=r?t:null,o.subscribedChannel=null!=r?r:t,t&&(o.channel=t.substring(0,t.lastIndexOf("-pnpres"))),r&&(o.subscription=r.substring(0,r.lastIndexOf("-pnpres"))),o.action=e.payload.action,o.state=e.payload.data,o.timetoken=i.publishTimetoken,o.occupancy=e.payload.occupancy,o.uuid=e.payload.uuid,o.timestamp=e.payload.timestamp,e.payload.join&&(o.join=e.payload.join),e.payload.leave&&(o.leave=e.payload.leave),e.payload.timeout&&(o.timeout=e.payload.timeout),n._listenerManager.announcePresence(o)}else{var s={channel:null,subscription:null};s.actualChannel=null!=r?t:null,s.subscribedChannel=null!=r?r:t,s.channel=t,s.subscription=r,s.timetoken=i.publishTimetoken,s.publisher=e.issuingClientId,e.userMetadata&&(s.userMetadata=e.userMetadata),n._config.cipherKey?s.message=n._crypto.decrypt(e.payload):s.message=e.payload,n._listenerManager.announceMessage(s)}}),this._region=t.metadata.region,this._startSubscribeLoop()}}},{key:"_stopSubscribeLoop",value:function(){this._subscribeCall&&("function"==typeof this._subscribeCall.abort&&this._subscribeCall.abort(),this._subscribeCall=null)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(128);(r=o)&&r.__esModule,n(4);var u=function(){function e(t){var n=t.timeEndpoint;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._timeEndpoint=n}return i(e,[{key:"onReconnection",value:function(e){this._reconnectionCallback=e}},{key:"startPolling",value:function(){this._timeTimer=setInterval(this._performTimeLoop.bind(this),3e3)}},{key:"stopPolling",value:function(){clearInterval(this._timeTimer)}},{key:"_performTimeLoop",value:function(){var e=this;this._timeEndpoint(function(t){t.error||(clearInterval(e._timeTimer),e._reconnectionCallback())})}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(29);(r=o)&&r.__esModule,n(4);var u=function(){function e(t){var n=t.config;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hashHistory=[],this._config=n}return i(e,[{key:"getKey",value:function(e){var t=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n+=1)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}(JSON.stringify(e.payload)).toString();return e.publishMetaData.publishTimetoken+"-"+t}},{key:"isDuplicate",value:function(e){return this.hashHistory.includes(this.getKey(e))}},{key:"addEntry",value:function(e){this.hashHistory.length>=this._config.maximumCacheSize&&this.hashHistory.shift(),this.hashHistory.push(this.getKey(e))}},{key:"clearHistory",value:function(){this.hashHistory=[]}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=e.networking,u=e.config,c=null,l=null,f={};t.getOperation()===o.default.PNTimeOperation||t.getOperation()===o.default.PNChannelGroupsOperation?c=arguments.length<=2?void 0:arguments[2]:(f=arguments.length<=2?void 0:arguments[2],c=arguments.length<=3?void 0:arguments[3]),"undefined"==typeof Promise||c||(l=i.default.createPromise());var h=t.validateParams(e,f);if(h)return c?c(a(h)):l?(l.reject(new s("Validation failed, check status for details",a(h))),l.promise):void 0;var p=t.prepareParams(e,f),d=function(e,t,n){return e.usePost&&e.usePost(t,n)?e.postURL(t,n):e.getURL(t,n)}(t,e,f),y=void 0,v={url:d,operation:t.getOperation(),timeout:t.getRequestTimeout(e)};p.uuid=u.UUID,p.pnsdk=function(e){if(e.sdkName)return e.sdkName;var t="PubNub-JS-"+e.sdkFamily;e.partnerId&&(t+="-"+e.partnerId);return t+="/"+e.getVersion()}(u),u.useInstanceId&&(p.instanceid=u.instanceId),u.useRequestId&&(p.requestid=r.default.createUUID()),t.isAuthSupported()&&u.getAuthKey()&&(p.auth=u.getAuthKey()),u.secretKey&&function(e,t,n){var r=e.config,o=e.crypto;n.timestamp=Math.floor((new Date).getTime()/1e3);var u=r.subscribeKey+"\n"+r.publishKey+"\n"+t+"\n";u+=i.default.signPamFromParams(n);var s=o.HMACSHA256(u);s=(s=s.replace(/\+/g,"-")).replace(/\//g,"_"),n.signature=s}(e,d,p);var b=function(n,r){if(n.error)c?c(n):l&&l.reject(new s("PubNub call failed, check status for details",n));else{var i=t.handleResponse(e,r,f);c?c(n,i):l&&l.fulfill(i)}};if(t.usePost&&t.usePost(e,f)){var _=t.postPayload(e,f);y=n.POST(p,_,v,b)}else y=t.useDelete&&t.useDelete()?n.DELETE(p,v,b):n.GET(p,v,b);return t.getOperation()===o.default.PNSubscribeOperation?y:l?l.promise:void 0};var r=u(n(83)),i=(n(4),u(n(8))),o=(u(n(29)),u(n(5)));function u(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.name=r.constructor.name,r.status=n,r.message=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Error),t}();function a(e){return(t={message:e}).type="validationError",t.error=!0,t;var t}e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNAddChannelsToGroupOperation},t.validateParams=function(e,t){var n=t.channels,r=t.channelGroup,i=e.config;if(!r)return"Missing Channel Group";if(!n||0===n.length)return"Missing Channels";if(!i.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channelGroup;return"/v1/channel-registration/sub-key/"+e.config.subscribeKey+"/channel-group/"+i.default.encodeString(n)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.channels;return{add:(void 0===n?[]:n).join(",")}},t.handleResponse=function(){return{}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNRemoveChannelsFromGroupOperation},t.validateParams=function(e,t){var n=t.channels,r=t.channelGroup,i=e.config;if(!r)return"Missing Channel Group";if(!n||0===n.length)return"Missing Channels";if(!i.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channelGroup;return"/v1/channel-registration/sub-key/"+e.config.subscribeKey+"/channel-group/"+i.default.encodeString(n)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.channels;return{remove:(void 0===n?[]:n).join(",")}},t.handleResponse=function(){return{}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNRemoveGroupOperation},t.validateParams=function(e,t){var n=t.channelGroup,r=e.config;if(!n)return"Missing Channel Group";if(!r.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channelGroup;return"/v1/channel-registration/sub-key/"+e.config.subscribeKey+"/channel-group/"+i.default.encodeString(n)+"/remove"},t.isAuthSupported=function(){return!0},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.prepareParams=function(){return{}},t.handleResponse=function(){return{}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNChannelGroupsOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e){return"/v1/channel-registration/sub-key/"+e.config.subscribeKey+"/channel-group"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(){return{}},t.handleResponse=function(e,t){return{groups:t.payload.groups}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNChannelsForGroupOperation},t.validateParams=function(e,t){var n=t.channelGroup,r=e.config;if(!n)return"Missing Channel Group";if(!r.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channelGroup;return"/v1/channel-registration/sub-key/"+e.config.subscribeKey+"/channel-group/"+i.default.encodeString(n)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(){return{}},t.handleResponse=function(e,t){return{channels:t.payload.channels}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNPushNotificationEnabledChannelsOperation},t.validateParams=function(e,t){var n=t.device,r=t.pushGateway,i=t.channels,o=e.config;if(!n)return"Missing Device ID (device)";if(!r)return"Missing GW Type (pushGateway: gcm or apns)";if(!i||0===i.length)return"Missing Channels";if(!o.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.device;return"/v1/push/sub-key/"+e.config.subscribeKey+"/devices/"+n},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.pushGateway,r=t.channels,i=void 0===r?[]:r;return{type:n,add:i.join(",")}},t.handleResponse=function(){return{}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNPushNotificationEnabledChannelsOperation},t.validateParams=function(e,t){var n=t.device,r=t.pushGateway,i=t.channels,o=e.config;if(!n)return"Missing Device ID (device)";if(!r)return"Missing GW Type (pushGateway: gcm or apns)";if(!i||0===i.length)return"Missing Channels";if(!o.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.device;return"/v1/push/sub-key/"+e.config.subscribeKey+"/devices/"+n},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.pushGateway,r=t.channels,i=void 0===r?[]:r;return{type:n,remove:i.join(",")}},t.handleResponse=function(){return{}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNPushNotificationEnabledChannelsOperation},t.validateParams=function(e,t){var n=t.device,r=t.pushGateway,i=e.config;if(!n)return"Missing Device ID (device)";if(!r)return"Missing GW Type (pushGateway: gcm or apns)";if(!i.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.device;return"/v1/push/sub-key/"+e.config.subscribeKey+"/devices/"+n},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){return{type:t.pushGateway}},t.handleResponse=function(e,t){return{channels:t}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNRemoveAllPushNotificationsOperation},t.validateParams=function(e,t){var n=t.device,r=t.pushGateway,i=e.config;if(!n)return"Missing Device ID (device)";if(!r)return"Missing GW Type (pushGateway: gcm or apns)";if(!i.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.device;return"/v1/push/sub-key/"+e.config.subscribeKey+"/devices/"+n+"/remove"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){return{type:t.pushGateway}},t.handleResponse=function(){return{}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNUnsubscribeOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.channels,o=void 0===r?[]:r,u=o.length>0?o.join(","):",";return"/v2/presence/sub-key/"+n.subscribeKey+"/channel/"+i.default.encodeString(u)+"/leave"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.channelGroups,r=void 0===n?[]:n,i={};r.length>0&&(i["channel-group"]=r.join(","));return i},t.handleResponse=function(){return{}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNWhereNowOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.uuid,i=void 0===r?n.UUID:r;return"/v2/presence/sub-key/"+n.subscribeKey+"/uuid/"+i},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(){return{}},t.handleResponse=function(e,t){if(!t.payload)return{channels:[]};return{channels:t.payload.channels}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNHeartbeatOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.channels,o=void 0===r?[]:r,u=o.length>0?o.join(","):",";return"/v2/presence/sub-key/"+n.subscribeKey+"/channel/"+i.default.encodeString(u)+"/heartbeat"},t.isAuthSupported=function(){return!0},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.prepareParams=function(e,t){var n=t.channelGroups,r=void 0===n?[]:n,i=t.state,o=void 0===i?{}:i,u=e.config,s={};r.length>0&&(s["channel-group"]=r.join(","));return s.state=JSON.stringify(o),s.heartbeat=u.getPresenceTimeout(),s},t.handleResponse=function(){return{}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNGetStateOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.uuid,o=void 0===r?n.UUID:r,u=t.channels,s=void 0===u?[]:u,a=s.length>0?s.join(","):",";return"/v2/presence/sub-key/"+n.subscribeKey+"/channel/"+i.default.encodeString(a)+"/uuid/"+o},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.channelGroups,r=void 0===n?[]:n,i={};r.length>0&&(i["channel-group"]=r.join(","));return i},t.handleResponse=function(e,t,n){var r=n.channels,i=void 0===r?[]:r,o=n.channelGroups,u=void 0===o?[]:o,s={};1===i.length&&0===u.length?s[i[0]]=t.payload:s=t.payload;return{channels:s}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNSetStateOperation},t.validateParams=function(e,t){var n=e.config,r=t.state,i=t.channels,o=void 0===i?[]:i,u=t.channelGroups,s=void 0===u?[]:u;if(!r)return"Missing State";if(!n.subscribeKey)return"Missing Subscribe Key";if(0===o.length&&0===s.length)return"Please provide a list of channels and/or channel-groups"},t.getURL=function(e,t){var n=e.config,r=t.channels,o=void 0===r?[]:r,u=o.length>0?o.join(","):",";return"/v2/presence/sub-key/"+n.subscribeKey+"/channel/"+i.default.encodeString(u)+"/uuid/"+n.UUID+"/data"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.state,r=t.channelGroups,i=void 0===r?[]:r,o={};o.state=JSON.stringify(n),i.length>0&&(o["channel-group"]=i.join(","));return o},t.handleResponse=function(e,t){return{state:t.payload}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNHereNowOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.channels,o=void 0===r?[]:r,u=t.channelGroups,s=void 0===u?[]:u,a="/v2/presence/sub-key/"+n.subscribeKey;if(o.length>0||s.length>0){var c=o.length>0?o.join(","):",";a+="/channel/"+i.default.encodeString(c)}return a},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.channelGroups,r=void 0===n?[]:n,i=t.includeUUIDs,o=void 0===i||i,u=t.includeState,s=void 0!==u&&u,a={};o||(a.disable_uuids=1);s&&(a.state=1);r.length>0&&(a["channel-group"]=r.join(","));return a},t.handleResponse=function(e,t,n){var r=n.channels,i=void 0===r?[]:r,o=n.channelGroups,u=void 0===o?[]:o,s=n.includeUUIDs,a=void 0===s||s,c=n.includeState,l=void 0!==c&&c,f=void 0;f=i.length>1||u.length>0||0===u.length&&0===i.length?function(){var e={};return e.totalChannels=t.payload.total_channels,e.totalOccupancy=t.payload.total_occupancy,e.channels={},Object.keys(t.payload.channels).forEach(function(n){var r=t.payload.channels[n],i=[];return e.channels[n]={occupants:i,name:n,occupancy:r.occupancy},a&&r.uuids.forEach(function(e){l?i.push({state:e.state,uuid:e.uuid}):i.push({state:null,uuid:e})}),e}),e}():function(){var e={},n=[];e.totalChannels=1,e.totalOccupancy=t.occupancy,e.channels={},e.channels[i[0]]={occupants:n,name:i[0],occupancy:t.occupancy},a&&t.uuids&&t.uuids.forEach(function(e){l?n.push({state:e.state,uuid:e.uuid}):n.push({state:null,uuid:e})});return e}();return f};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNAccessManagerAudit},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e){return"/v2/auth/audit/sub-key/"+e.config.subscribeKey},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!1},t.prepareParams=function(e,t){var n=t.channel,r=t.channelGroup,i=t.authKeys,o=void 0===i?[]:i,u={};n&&(u.channel=n);r&&(u["channel-group"]=r);o.length>0&&(u.auth=o.join(","));return u},t.handleResponse=function(e,t){return t.payload};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return o.default.PNAccessManagerGrant},t.validateParams=function(e){var t=e.config;if(!t.subscribeKey)return"Missing Subscribe Key";if(!t.publishKey)return"Missing Publish Key";if(!t.secretKey)return"Missing Secret Key"},t.getURL=function(e){return"/v2/auth/grant/sub-key/"+e.config.subscribeKey},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!1},t.prepareParams=function(e,t){var n=t.channels,r=void 0===n?[]:n,i=t.channelGroups,o=void 0===i?[]:i,u=t.ttl,s=t.read,a=void 0!==s&&s,c=t.write,l=void 0!==c&&c,f=t.manage,h=void 0!==f&&f,p=t.authKeys,d=void 0===p?[]:p,y={};y.r=a?"1":"0",y.w=l?"1":"0",y.m=h?"1":"0",r.length>0&&(y.channel=r.join(","));o.length>0&&(y["channel-group"]=o.join(","));d.length>0&&(y.auth=d.join(","));(u||0===u)&&(y.ttl=u);return y},t.handleResponse=function(){return{}};n(4);var r,i=n(5),o=(r=i)&&r.__esModule?r:{default:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.getOperation=function(){return i.default.PNPublishOperation},t.validateParams=function(e,t){var n=e.config,r=t.message;if(!t.channel)return"Missing Channel";if(!r)return"Missing Message";if(!n.subscribeKey)return"Missing Subscribe Key"},t.usePost=function(e,t){var n=t.sendByPost;return void 0!==n&&n},t.getURL=function(e,t){var n=e.config,r=t.channel,i=t.message,u=s(e,i);return"/publish/"+n.publishKey+"/"+n.subscribeKey+"/0/"+o.default.encodeString(r)+"/0/"+o.default.encodeString(u)},t.postURL=function(e,t){var n=e.config,r=t.channel;return"/publish/"+n.publishKey+"/"+n.subscribeKey+"/0/"+o.default.encodeString(r)+"/0"},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.postPayload=function(e,t){var n=t.message;return s(e,n)},t.prepareParams=function(e,t){var n=t.meta,i=t.replicate,o=void 0===i||i,u=t.storeInHistory,s=t.ttl,a={};null!=u&&(a.store=u?"1":"0");s&&(a.ttl=s);!1===o&&(a.norep="true");n&&"object"===(void 0===n?"undefined":r(n))&&(a.meta=JSON.stringify(n));return a},t.handleResponse=function(e,t){return{timetoken:t[2]}};n(4);var i=u(n(5)),o=u(n(8));function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=e.crypto,r=e.config,i=JSON.stringify(t);return r.cipherKey&&(i=n.encrypt(i),i=JSON.stringify(i)),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNHistoryOperation},t.validateParams=function(e,t){var n=t.channel,r=e.config;if(!n)return"Missing channel";if(!r.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channel;return"/v2/history/sub-key/"+e.config.subscribeKey+"/channel/"+i.default.encodeString(n)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.start,r=t.end,i=t.reverse,o=t.count,u=void 0===o?100:o,s=t.stringifiedTimeToken,a=void 0!==s&&s,c={include_token:"true"};c.count=u,n&&(c.start=n);r&&(c.end=r);a&&(c.string_message_token="true");null!=i&&(c.reverse=i.toString());return c},t.handleResponse=function(e,t){var n={messages:[],startTimeToken:t[1],endTimeToken:t[2]};return t[0].forEach(function(t){var r={timetoken:t.timetoken,entry:function(e,t){var n=e.config,r=e.crypto;if(!n.cipherKey)return t;try{return r.decrypt(t)}catch(e){return t}}(e,t.message)};n.messages.push(r)}),n};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNDeleteMessagesOperation},t.validateParams=function(e,t){var n=t.channel,r=e.config;if(!n)return"Missing channel";if(!r.subscribeKey)return"Missing Subscribe Key"},t.useDelete=function(){return!0},t.getURL=function(e,t){var n=t.channel;return"/v3/history/sub-key/"+e.config.subscribeKey+"/channel/"+i.default.encodeString(n)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.start,r=t.end,i={};n&&(i.start=n);r&&(i.end=r);return i},t.handleResponse=function(e,t){return t.payload};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNFetchMessagesOperation},t.validateParams=function(e,t){var n=t.channels,r=e.config;if(!n||0===n.length)return"Missing channels";if(!r.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=t.channels,r=void 0===n?[]:n,o=e.config,u=r.length>0?r.join(","):",";return"/v3/history/sub-key/"+o.subscribeKey+"/channel/"+i.default.encodeString(u)},t.getRequestTimeout=function(e){return e.config.getTransactionTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=t.start,r=t.end,i=t.count,o=t.stringifiedTimeToken,u=void 0!==o&&o,s={};i&&(s.max=i);n&&(s.start=n);r&&(s.end=r);u&&(s.string_message_token="true");return s},t.handleResponse=function(e,t){var n={channels:{}};return Object.keys(t.channels||{}).forEach(function(r){n.channels[r]=[],(t.channels[r]||[]).forEach(function(t){var i={};i.channel=r,i.subscription=null,i.timetoken=t.timetoken,i.message=function(e,t){var n=e.config,r=e.crypto;if(!n.cipherKey)return t;try{return r.decrypt(t)}catch(e){return t}}(e,t.message),n.channels[r].push(i)})}),n};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOperation=function(){return r.default.PNSubscribeOperation},t.validateParams=function(e){if(!e.config.subscribeKey)return"Missing Subscribe Key"},t.getURL=function(e,t){var n=e.config,r=t.channels,o=void 0===r?[]:r,u=o.length>0?o.join(","):",";return"/v2/subscribe/"+n.subscribeKey+"/"+i.default.encodeString(u)+"/0"},t.getRequestTimeout=function(e){return e.config.getSubscribeTimeout()},t.isAuthSupported=function(){return!0},t.prepareParams=function(e,t){var n=e.config,r=t.channelGroups,i=void 0===r?[]:r,o=t.timetoken,u=t.filterExpression,s=t.region,a={heartbeat:n.getPresenceTimeout()};i.length>0&&(a["channel-group"]=i.join(","));u&&u.length>0&&(a["filter-expr"]=u);o&&(a.tt=o);s&&(a.tr=s);return a},t.handleResponse=function(e,t){var n=[];t.m.forEach(function(e){var t={publishTimetoken:e.p.t,region:e.p.r},r={shard:parseInt(e.a,10),subscriptionMatch:e.b,channel:e.c,payload:e.d,flags:e.f,issuingClientId:e.i,subscribeKey:e.k,originationTimetoken:e.o,userMetadata:e.u,publishMetaData:t};n.push(r)});var r={timetoken:t.t.t,region:t.t.r};return{messages:n,metadata:r}};n(4);var r=o(n(5)),i=o(n(8));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(o(n(29)),o(n(52)));n(4);function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._modules={},Object.keys(t).forEach(function(e){n._modules[e]=t[e].bind(n)})}return r(e,[{key:"init",value:function(e){this._config=e,this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(this._config.secure?"https://":"http://")+this._config.origin,this._coreParams={},this.shiftStandardOrigin()}},{key:"nextOrigin",value:function(){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var e;return this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),e=this._currentSubDomain.toString(),this._providedFQDN.replace("pubsub","ps"+e)}},{key:"hasModule",value:function(e){return e in this._modules}},{key:"shiftStandardOrigin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._standardOrigin=this.nextOrigin(e),this._standardOrigin}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"POST",value:function(e,t,n,r){return this._modules.post(e,t,n,r)}},{key:"GET",value:function(e,t,n){return this._modules.get(e,t,n)}},{key:"DELETE",value:function(e,t,n){return this._modules.del(e,t,n)}},{key:"_detectErrorCategory",value:function(e){if("ENOTFOUND"===e.code)return i.default.PNNetworkIssuesCategory;if("ECONNREFUSED"===e.code)return i.default.PNNetworkIssuesCategory;if("ECONNRESET"===e.code)return i.default.PNNetworkIssuesCategory;if("EAI_AGAIN"===e.code)return i.default.PNNetworkIssuesCategory;if(0===e.status||e.hasOwnProperty("status")&&void 0===e.status)return i.default.PNNetworkIssuesCategory;if(e.timeout)return i.default.PNTimeoutCategory;if("ETIMEDOUT"===e.code)return i.default.PNNetworkIssuesCategory;if(e.response){if(e.response.badRequest)return i.default.PNBadRequestCategory;if(e.response.forbidden)return i.default.PNAccessDeniedCategory}return i.default.PNUnknownCategory}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage={}}return r(e,[{key:"get",value:function(e){return this.storage[e]}},{key:"set",value:function(e,t){this.storage[e]=t}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=function(e,t,n){var r=this.getStandardOrigin()+t.url;return o.call(this,"GET",r,e,"",t,n)},t.post=function(e,t,n,r){var i=this.getStandardOrigin()+n.url;return o.call(this,"POST",i,e,t,n,r)},t.del=function(e,t,n){var r=this.getStandardOrigin()+t.url;return o.call(this,"DELETE",r,e,"",t,n)};var r=n(160),i=(n(4),n(335));function o(e,t,n,o,u,s){var a=this,c={};return c.operation=u.operation,(0,r.request)({method:e,url:(0,i.buildUrl)(t,n),content:o,timeout:u.timeout}).then(function(e){return c.error=!1,e.statusCode&&(c.statusCode=e.statusCode),e.content.toJSON()}).then(function(e){var r=e;a._config.logVerbosity&&function(e,t,n){var r=(new Date).getTime(),i=(new Date).toISOString(),o=(console&&console.log,console);o.log("<<<<<"),o.log("["+i+"]","\n",e,"\n",t),o.log("-----");var u=(new Date).getTime()-r,s=(new Date).toISOString();o.log(">>>>>>"),o.log("["+s+" / "+u+"]","\n",e,"\n",t,"\n",n),o.log("-----")}(t,n,r),s(c,r)}).catch(function(e){c.error=!0,c.errorData=e,c.category=a._detectErrorCategory(e),s(c,null)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t,n){null!=n?Array.isArray(n)?n.forEach(function(n){i(e,t,n)}):"object"===(void 0===n?"undefined":r(n))?Object.keys(n).forEach(function(r){i(e,t+"["+r+"]",n[r])}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n)):null===n&&e.push(encodeURIComponent(""+encodeURIComponent(t)))}t.encodedKeyValuePair=i,t.buildUrl=function(e,t){var n=[];return Object.keys(t).forEach(function(e){i(n,e,t[e])}),e+"?"+n.join("&")}},function(e,t,n){e.exports=n(337)},function(e,t,n){var r=n(28),i=n(117),o=n(46),u=i(function(e,t){r(t,o(t),e)});e.exports=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(1),u=n(7),s=n(3),a=n(51),c=n(9),l=n(131);t.Stream=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this._client=u.Client.sharedInstance(),this._liveService=(0,a.getLiveService)(this._client),this._subscribeChannels={},this._publishChannels={}}return r(e,[{key:"getSubstreams",value:function(){return this._makeStreamRequest("_substreams",c.RequestMethod.GET)}},{key:"getACL",value:function(e){return(0,s.isNonemptyString)(e)?this._makeStreamRequest(e,c.RequestMethod.GET):i.Promise.reject(new o.KinveyError("Invalid or missing id"))}},{key:"setACL",value:function(e,t){return(0,s.isNonemptyString)(e)?l.StreamACL.isValidACLObject(t)?(t instanceof l.StreamACL||(t=new l.StreamACL(t)),this._makeStreamRequest(e,c.RequestMethod.PUT,t.toPlainObject())):i.Promise.reject(new o.KinveyError("Invalid or missing ACL object")):i.Promise.reject(new o.KinveyError("Invalid or missing id"))}},{key:"follow",value:function(e,t){return this._subscribe(e,t)}},{key:"unfollow",value:function(e){return this._unsubscribe(e)}},{key:"post",value:function(e){var t=this._client.getActiveUser()._id;return this._publish(t,e)}},{key:"listen",value:function(e){var t=this._client.getActiveUser()._id;return this._subscribe(t,e)}},{key:"stopListening",value:function(){var e=this._client.getActiveUser()._id;return this._unsubscribe(e)}},{key:"send",value:function(e,t){return this._publish(e,t)}},{key:"_unsubscribeFromSubstream",value:function(e){var t=e+"/unsubscribe";return this._makeStreamRequest(t,c.RequestMethod.POST,{deviceId:this._client.deviceId})}},{key:"_subscribe",value:function(e,t){var n=this;return this._requestSubscribeAccess(e).then(function(){var r=n._subscribeChannels[e];n._liveService.subscribeToChannel(r,t)})}},{key:"_unsubscribe",value:function(e){var t=this;return this._unsubscribeFromSubstream(e).then(function(){var n=t._subscribeChannels[e];t._liveService.unsubscribeFromChannel(n),delete t._subscribeChannels[e]})}},{key:"_publish",value:function(e,t){return this._publishChannels[e]?this._retriablePublish(e,t):this._publishWithAccessRequest(e,t)}},{key:"_publishWithAccessRequest",value:function(e,t){var n=this;return this._requestPublishAccess(e).then(function(){var r=n._publishChannels[e];return n._liveService.publishToChannel(r,t)})}},{key:"_retriablePublish",value:function(e,t){var n=this,r=this._publishChannels[e];return this._liveService.publishToChannel(r,t).catch(function(r){var o=i.Promise.reject(r);return r.statusCode===c.StatusCode.Forbidden&&(o=n._publishWithAccessRequest(e,t)),o})}},{key:"_requestPublishAccess",value:function(e){var t=this;return this._makeStreamRequest(e+"/publish",c.RequestMethod.POST).then(function(n){return n.substreamChannelName&&(t._publishChannels[e]=n.substreamChannelName),n})}},{key:"_requestSubscribeAccess",value:function(e){var t=this,n={deviceId:this._client.deviceId};return this._makeStreamRequest(e+"/subscribe",c.RequestMethod.POST,n).then(function(n){return t._subscribeChannels[e]=n.substreamChannelName,n})}},{key:"_makeStreamRequest",value:function(e,t,n){return c.KinveyRequest.execute({method:t,pathname:"/stream/"+this._client.appKey+"/"+this.name+"/"+e,body:n},this._client)}}],[{key:"StreamACL",get:function(){return l.StreamACL}}]),e}()},function(e,t,n){var r=n(340),i=n(341),o=n(65),u=n(6),s=n(77);e.exports=function(e,t,n){var a=u(e)?r:i;return n&&s(e,t,n)&&(t=void 0),a(e,o(t,3))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}},function(e,t,n){var r=n(39);e.exports=function(e,t){var n=!0;return r(e,function(e,r,i){return n=!!t(e,r,i)}),n}},function(e,t,n){var r=n(343),i=n(354),o=n(135);e.exports=function(e){var t=i(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(n){return n===e||r(n,e,t)}}},function(e,t,n){var r=n(79),i=n(132),o=1,u=2;e.exports=function(e,t,n,s){var a=n.length,c=a,l=!s;if(null==e)return!c;for(e=Object(e);a--;){var f=n[a];if(l&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++a<c;){var h=(f=n[a])[0],p=e[h],d=f[1];if(l&&f[2]){if(void 0===p&&!(h in e))return!1}else{var y=new r;if(s)var v=s(p,d,h,e,t,y);if(!(void 0===v?i(d,p,o|u,s,y):v))return!1}}return!0}},function(e,t,n){var r=n(79),i=n(133),o=n(350),u=n(353),s=n(34),a=n(6),c=n(43),l=n(67),f=1,h="[object Arguments]",p="[object Array]",d="[object Object]",y=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,b,_){var g=a(e),m=a(t),w=g?p:s(e),O=m?p:s(t),k=(w=w==h?d:w)==d,P=(O=O==h?d:O)==d,E=w==O;if(E&&c(e)){if(!c(t))return!1;g=!0,k=!1}if(E&&!k)return _||(_=new r),g||l(e)?i(e,t,n,v,b,_):o(e,t,w,n,v,b,_);if(!(n&f)){var j=k&&y.call(e,"__wrapped__"),S=P&&y.call(t,"__wrapped__");if(j||S){var C=j?e.value():e,M=S?t.value():t;return _||(_=new r),b(C,M,n,v,_)}}return!!E&&(_||(_=new r),u(e,t,n,v,b,_))}},function(e,t,n){var r=n(80),i=n(346),o=n(347);function u(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}u.prototype.add=u.prototype.push=i,u.prototype.has=o,e.exports=u},function(e,t){var n="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,n),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(30),i=n(125),o=n(35),u=n(133),s=n(351),a=n(352),c=1,l=2,f="[object Boolean]",h="[object Date]",p="[object Error]",d="[object Map]",y="[object Number]",v="[object RegExp]",b="[object Set]",_="[object String]",g="[object Symbol]",m="[object ArrayBuffer]",w="[object DataView]",O=r?r.prototype:void 0,k=O?O.valueOf:void 0;e.exports=function(e,t,n,r,O,P,E){switch(n){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case m:return!(e.byteLength!=t.byteLength||!P(new i(e),new i(t)));case f:case h:case y:return o(+e,+t);case p:return e.name==t.name&&e.message==t.message;case v:case _:return e==t+"";case d:var j=s;case b:var S=r&c;if(j||(j=a),e.size!=t.size&&!S)return!1;var C=E.get(e);if(C)return C==t;r|=l,E.set(e,t);var M=u(j(e),j(t),r,O,P,E);return E.delete(e),M;case g:if(k)return k.call(e)==k.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){var r=n(123),i=1,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,u,s,a){var c=n&i,l=r(e),f=l.length;if(f!=r(t).length&&!c)return!1;for(var h=f;h--;){var p=l[h];if(!(c?p in t:o.call(t,p)))return!1}var d=a.get(e);if(d&&a.get(t))return d==t;var y=!0;a.set(e,t),a.set(t,e);for(var v=c;++h<f;){var b=e[p=l[h]],_=t[p];if(u)var g=c?u(_,b,p,t,e,a):u(b,_,p,e,t,a);if(!(void 0===g?b===_||s(b,_,n,u,a):g)){y=!1;break}v||(v="constructor"==p)}if(y&&!v){var m=e.constructor,w=t.constructor;m!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof m&&m instanceof m&&"function"==typeof w&&w instanceof w)&&(y=!1)}return a.delete(e),a.delete(t),y}},function(e,t,n){var r=n(134),i=n(22);e.exports=function(e){for(var t=i(e),n=t.length;n--;){var o=t[n],u=e[o];t[n]=[o,u,r(u)]}return t}},function(e,t,n){var r=n(132),i=n(356),o=n(161),u=n(86),s=n(134),a=n(135),c=n(40),l=1,f=2;e.exports=function(e,t){return u(e)&&s(t)?a(c(e),t):function(n){var u=i(n,e);return void 0===u&&u===t?o(n,e):r(t,u,l|f)}}},function(e,t,n){var r=n(93);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},function(e,t,n){var r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=n(358)(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(r,function(e,n,r,o){t.push(r?o.replace(i,"$1"):n||e)}),t});e.exports=o},function(e,t,n){var r=n(359),i=500;e.exports=function(e){var t=r(e,function(e){return n.size===i&&n.clear(),e}),n=t.cache;return t}},function(e,t,n){var r=n(80),i="Expected a function";function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(i);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var u=e.apply(this,r);return n.cache=o.set(i,u)||o,u};return n.cache=new(o.Cache||r),n}o.Cache=r,e.exports=o},function(e,t,n){var r=n(361);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(30),i=n(94),o=n(6),u=n(45),s=1/0,a=r?r.prototype:void 0,c=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(u(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-s?"-0":n}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var r=n(85),i=n(59),o=n(6),u=n(60),s=n(68),a=n(40);e.exports=function(e,t,n){for(var c=-1,l=(t=r(t,e)).length,f=!1;++c<l;){var h=a(t[c]);if(!(f=null!=e&&n(e,h)))break;e=e[h]}return f||++c!=l?f:!!(l=null==e?0:e.length)&&s(l)&&u(h,l)&&(o(e)||i(e))}},function(e,t,n){var r=n(365),i=n(366),o=n(86),u=n(40);e.exports=function(e){return o(e)?r(u(e)):i(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){var r=n(93);e.exports=function(e){return function(t){return r(t,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveServiceFacade=void 0;var r=n(7),i=n(130),o=n(51);function u(){var e=r.Client.sharedInstance();return(0,o.getLiveService)(e)}t.LiveServiceFacade={Stream:i.Stream,onConnectionStatusUpdates:function(e){u().onConnectionStatusUpdates(e)},offConnectionStatusUpdates:function(e){u().offConnectionStatusUpdates(e)},isInitialized:function(){return u().isInitialized()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Operation=function(){function e(t,n,r,i,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.collection=n,r&&(this.query=r),i&&(this.data=i),o&&(this.entityId=o)}return r(e,[{key:"clone",value:function(){return new e(this.type,this.collection,this.query,this.data,this.entityId)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OperationType={Create:"create",Read:"read",ReadById:"readById",Update:"update",Delete:"delete",DeleteById:"deleteById",Count:"count",Clear:"clear",Group:"group"}},function(e,t,n){var r=n(76),i=n(371)(function(e,t,n){r(e,n,t)});e.exports=i},function(e,t,n){var r=n(372),i=n(373),o=n(65),u=n(6);e.exports=function(e,t){return function(n,s){var a=u(n)?r:i,c=t?t():{};return a(n,e,o(s,2),c)}}},function(e,t){e.exports=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var u=e[i];t(r,u,n(u),e)}return r}},function(e,t,n){var r=n(39);e.exports=function(e,t,n,i){return r(e,function(e,r,o){t(i,e,n(e),o)}),i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildCollectionUrl=t.dataStoreTagSeparator=void 0;var r=n(54);Object.defineProperty(t,"buildCollectionUrl",{enumerable:!0,get:function(){return r.buildCollectionUrl}}),t.getEntitiesPendingPushError=function(e,t){var n="are "+e+" entities, matching the provided query";1===e&&(n="is "+e+" entity, matching the provided query or id");var r="Unable to "+t+" on the backend. There "+n+", pending push to the backend. The result will overwrite your local changes.";return new s.KinveyError(r)},t.generateEntityId=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t="abcdef0123456789",n="",r=0,i=t.length;r<e;r+=1){var o=Math.floor(Math.random()*i);n+=t.substring(o,o+1)}return n},t.isNotEmpty=function(e){return!(0,u.default)(e)},t.isEmpty=function(e){return(0,u.default)(e)},t.isLocalEntity=function(e){return!!e&&!!e._kmd&&!0===e._kmd.local},t.isValidDataStoreTag=function(e){return(0,a.isNonemptyString)(e)&&/^[a-z0-9-]+$/i.test(e)},t.collectionHasTag=function(e){return e.indexOf(c)>=0},t.formTaggedCollectionName=function(e,t){if(t)return""+e+c+t;return e},t.stripTagFromCollectionName=function(e){return e.split(c)[0]},t.getTagFromCollectionName=function(e){return e.split(c)[1]};var i,o=n(27),u=(i=o)&&i.__esModule?i:{default:i},s=n(1),a=n(3);var c=t.dataStoreTagSeparator="."},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueByKey=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3);t.PromiseQueueByKey=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._queuesByKey={},this._simultaneousOpsCount=t,this._maxQueueLength=n}return r(e,[{key:"enqueue",value:function(e,t){return this._queuesByKey[e]||(this._queuesByKey[e]=new i.PromiseQueue(this._simultaneousOpsCount,this._maxQueueLength)),this._queuesByKey[e].enqueue(t)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyValueStoreOfflineRepository=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(1),o=n(139),u=n(66);t.KeyValueStoreOfflineRepository=function(e){function t(e,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof u.KeyValueStorePersister))throw new i.KinveyError("KeyValueStoreOfflineRepository only works with an instance of KeyValueStorePersister");return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.InmemoryOfflineRepository),r(t,[{key:"create",value:function(e,t){return this._batchUpsert(e,t)}},{key:"update",value:function(e,t){return this._batchUpsert(e,t)}},{key:"readById",value:function(e,t){return this._persister.readEntity(e,t)}},{key:"deleteById",value:function(e,t){return this._persister.deleteEntity(e,t).then(function(e){return e?1:0})}},{key:"_formCollectionKey",value:function(e){return e}},{key:"_getAllCollections",value:function(){return this._persister.getKeys()}},{key:"_batchUpsert",value:function(e,t){return this._persister.writeEntities(e,t).then(function(){return t})}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryKeyValuePersister=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(55);var u={};t.MemoryKeyValuePersister=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.KeyValuePersister),r(t,[{key:"getKeys",value:function(){return i.Promise.resolve(Object.keys(u))}},{key:"_readFromPersistance",value:function(e){var t=u[e]||[];return i.Promise.resolve(t.slice(0))}},{key:"_writeToPersistance",value:function(e,t){return u[e]=t.slice(0),i.Promise.resolve(!0)}},{key:"_deleteFromPersistance",value:function(e){return delete u[e],i.Promise.resolve(!0)}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(379);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(380);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var o=n(381);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.WebSqlSqlModule=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(1),u=n(38);var s={};t.WebSqlSqlModule=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._databaseName=e}return r(t,[{key:"openTransaction",value:function(t,n,r){var a=this,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=s[this._databaseName],f='"'+t+'"',h=t===u.webSqlCollectionsMaster,p=Array.isArray(n);return n=p?n:[[n,r]],new i.Promise(function(r,i){try{l||(l=e.openDatabase(a._databaseName,1,"Kinvey Cache",u.webSqlDatabaseSize),s[a._databaseName]=l);var d=c||"function"!=typeof l.readTransaction;l[d?"transaction":"readTransaction"](function(e){c&&!h&&e.executeSql("CREATE TABLE IF NOT EXISTS "+f+" (key BLOB PRIMARY KEY NOT NULL, value BLOB NOT NULL)");var t=n.length,i=[];0===t?r(p?i:i.shift()):n.forEach(function(n){var o=n[0].replace("#{collection}",f);e.executeSql(o,n[1],function(e,n){var o=[];if(n.rows.length>0)for(var u=0,s=n.rows.length;u<s;u+=1)try{var a=n.rows.item(u).value,c=h?a:JSON.parse(a);o.push(c)}catch(e){}else o=n.rowsAffected;i.push(o),0===(t-=1)&&r(p?i:i.shift())})})},function(e){if((e="string"==typeof e?e:e.message)&&-1===e.indexOf("no such table"))return r([]);var n=["table",t];return a.openTransaction(u.webSqlCollectionsMaster,"SELECT name AS value from #{collection} WHERE type = ? AND name = ?",n).then(function(e){return 0===e?r([]):i(new o.KinveyError("Unable to open a transaction for the "+t+" collection on the "+a._databaseName+" WebSQL database."))}).catch(i)})}catch(e){i(e)}})}}]),t}()}).call(t,n(19))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDbKeyValueStorePersister=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(1),u=n(89),s=n(3),a=n(38);var c={};t.IndexedDbKeyValueStorePersister=function(t){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.inTransaction=!1,e.queue=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,u.KeyValueStorePersister),r(n,[{key:"getKeys",value:function(){return this._getDb().then(function(e){return(0,a.domStringListToStringArray)(e.objectStoreNames)})}},{key:"_readFromPersistance",value:function(e){var t=this;return new i.Promise(function(n,r){t._openTransaction(e,!1,function(t){var i=t.objectStore(e).openCursor(),o=[];i.onsuccess=function(e){var t=e.target.result;return(0,s.isDefined)(t)?(o.push(t.value),t.continue()):n(o)},i.onerror=function(e){r(e.target.error)}},function(e){e instanceof o.NotFoundError&&n([]),r(e)})})}},{key:"_writeToPersistance",value:function(e,t){var n=this;return t?this._deleteFromPersistance(e).then(function(){return n._upsertEntities(e,t)}):i.Promise.reject(new o.KinveyError("Invalid or missing entities array"))}},{key:"_deleteFromPersistance",value:function(e){var t=this;return new i.Promise(function(n,r){t._openTransaction(e,!0,function(t){t.objectStore(e).clear(),t.oncomplete=function(e){return n(e)},t.onerror=function(e){return r(e)}},r)})}},{key:"_readEntityFromPersistance",value:function(e,t){var n=this;return new i.Promise(function(r,i){n._openTransaction(e,!1,function(n){var o=n.objectStore(e).get(t);o.onsuccess=function(e){var t=e.target.result;r(t)},o.onerror=i},i)})}},{key:"_writeEntitiesToPersistance",value:function(e,t){return this._upsertEntities(e,t)}},{key:"_deleteEntityFromPersistance",value:function(e,t){var n=this;return new i.Promise(function(r,i){n._openTransaction(e,!0,function(o){var u=o.objectStore(e),a=u.get(t);u.delete(t),o.oncomplete=function(){var o=a.result;(0,s.isDefined)(o)?r({count:1}):i(n._getEntityNotFoundError(e,t))},o.onerror=function(){i(n._getEntityNotFoundError(e,t))}},i)})}},{key:"_openTransaction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments[2],r=this,i=arguments[3],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=c[this._storeName];if((0,s.isDefined)(l))if("function"==typeof l.objectStoreNames.contains?l.objectStoreNames.contains(e):-1!==l.objectStoreNames.indexOf(e))try{var f=t?a.inedxedDbTransctionMode.readWrite:a.inedxedDbTransctionMode.readOnly,h=l.transaction(e,f);if((0,s.isDefined)(h))return n(h);throw new o.KinveyError("Unable to open a transaction for "+e+" collection on the "+this._storeName+" IndexedDB database.")}catch(e){return i(e)}else if(!1===t)return i(new o.NotFoundError("The "+e+" collection was not found on the "+this._storeName+" IndexedDB database."));if(!1===u&&this.inTransaction)return this.queue.push(function(){r._openTransaction(e,t,n,i)});this.inTransaction=!0;var p=void 0;try{p=this._openDb()}catch(e){i(e)}return p.onupgradeneeded=function(n){l=n.target.result,c[r._storeName]=l,!0===t&&l.createObjectStore(e,{keyPath:"_id"})},p.onsuccess=function(o){l=o.target.result,c[r._storeName]=l,l.onversionchange=function(){(0,s.isDefined)(l)&&(l.close(),l=null,c[r._storeName]=null)};var u=function(e){return function(t){if(e(t),r.inTransaction=!1,r.queue.length>0){var n=r.queue;r.queue=[],n.forEach(function(e){e.call(r)})}}};return r._openTransaction(e,t,u(n),u(i),!0)},p.onblocked=function(){},p.onerror=function(e){i(new Error("Unable to open the "+r._storeName+" IndexedDB database. "+e.target.error.message+"."))},p}},{key:"_upsertEntities",value:function(e,t){var n=this,r=!Array.isArray(t);return 0===(t=(0,s.ensureArray)(t)).length?i.Promise.resolve(null):new i.Promise(function(i,u){n._openTransaction(e,!0,function(s){var a=s.objectStore(e);t.forEach(function(e){a.put(e)}),s.oncomplete=function(){i(r?t[0]:t)},s.onerror=function(t){u(new o.KinveyError("An error occurred while saving the entities to the "+e+" collection on the "+n._storeName+" IndexedDB database. "+t.target.error.message+"."))}},u)})}},{key:"_getIndexedDbObj",value:function(){return e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.msIndexedDB}},{key:"_openDb",value:function(){var e=c[this._storeName],t=this._getIndexedDbObj();if((0,s.isDefined)(e)){var n=e.version+1;return e.close(),t.open(this._storeName,n)}return t.open(this._storeName)}},{key:"_getDb",value:function(){var e=this,t=c[this._storeName];return t?i.Promise.resolve(t):new i.Promise(function(t,n){var r=function(e){var n=e.target.result;t(n)},i=e._openDb();i.onupgradeneeded=r,i.onsuccess=r,i.onerror=function(e){return n(e)}})}}]),n}()}).call(t,n(19))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserKeyValuePersister=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(7),u=n(55),s=n(38);t.BrowserKeyValuePersister=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,r));return i._store=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.KeyValuePersister),r(t,[{key:"getKeys",value:function(){return i.Promise.resolve(Object.keys(this._store))}},{key:"_readFromPersistance",value:function(e){var t=this._store.getItem(e);return this._deserialize(t)}},{key:"_writeToPersistance",value:function(e,t){var n=this;return this._ensureCollectionExists(e).then(function(){return n._serializeAndSet(e,t)})}},{key:"_deleteFromPersistance",value:function(e){return this._store.removeItem(e),i.Promise.resolve()}},{key:"_buildMasterCollectionName",value:function(){return o.Client.sharedInstance().appKey+"."+s.browserStorageCollectionsMaster}},{key:"_ensureCollectionExists",value:function(e){var t=this,n=this._buildMasterCollectionName();return this._readFromPersistance(n).then(function(r){return(r=r||[]).find(function(t){return t===e})?i.Promise.resolve():(r.push(e),t._serializeAndSet(n,r))})}},{key:"_serializeAndSet",value:function(e,t){var n=this;return this._serialize(t).then(function(t){return n._store.setItem(e,t)})}},{key:"_serialize",value:function(e){try{return i.Promise.resolve(JSON.stringify(e))}catch(e){return i.Promise.reject(e)}}},{key:"_deserialize",value:function(e){try{var t=JSON.parse(e);return i.Promise.resolve(t)}catch(e){return i.Promise.reject(e)}}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SqlKeyValueStorePersister=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(2),o=n(1),u=n(89),s=n(38),a=n(3);t.SqlKeyValueStorePersister=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,r));return i._sqlModule=e,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.KeyValueStorePersister),r(t,[{key:"getKeys",value:function(){return this._sqlModule.openTransaction(s.sqliteCollectionsMaster,"SELECT name AS value FROM #{collection} WHERE type = ?",["table"],!1).then(function(e){return e.filter(function(e){return"_QueryCache"===e||"__testSupport__"===e||/^[a-zA-Z0-9-]{1,128}/.test(e)})})}},{key:"_readFromPersistance",value:function(e){return this._sqlModule.openTransaction(e,"SELECT value FROM #{collection}",[]).catch(function(){return[]})}},{key:"_writeToPersistance",value:function(e,t){var n=this;return t?this._deleteFromPersistance(e).then(function(){return n._upsertEntities(e,t)}):i.Promise.reject(new o.KinveyError("Invalid or missing entities array"))}},{key:"_deleteFromPersistance",value:function(e){return this._sqlModule.openTransaction(e,"DELETE FROM #{collection}",void 0,!0).then(function(e){return{count:e}})}},{key:"_readEntityFromPersistance",value:function(e,t){return this._sqlModule.openTransaction(e,"SELECT value FROM #{collection} WHERE key = ?",[t]).then(function(e){return e[0]})}},{key:"_writeEntitiesToPersistance",value:function(e,t){return this._upsertEntities(e,(0,a.ensureArray)(t))}},{key:"_deleteEntityFromPersistance",value:function(e,t){return this._sqlModule.openTransaction(e,"DELETE FROM #{collection} WHERE key = ?",[t],!0)}},{key:"_upsertEntities",value:function(e,t){var n=!Array.isArray(t);if(0===(t=(0,a.ensureArray)(t)).length)return i.Promise.resolve(null);var r=t.map(function(e){return["REPLACE INTO #{collection} (key, value) VALUES (?, ?)",[e._id,JSON.stringify(e)]]});return this._sqlModule.openTransaction(e,r,null,!0).then(function(){return n?t[0]:t})}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.repositoryProvider=void 0;var r,i=n(2),o=n(22),u=(r=o)&&r.__esModule?r:{default:r},s=n(7),a=n(1),c=n(138),l=n(141),f=n(137),h=n(3),p=n(16),d=n(66),y=n(54);var v=new p.PromiseQueueByKey,b=void 0,_=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},f.StorageProvider.Memory,function(e){var t=new d.MemoryKeyValuePersister;return new c.InmemoryOfflineRepository(t,e)});function g(e){return e.reduce(function(e,t){return e.catch(function(){var e=function(e){var t=_[e];if(!t){var n='The requested storage provider "'+e+'" is not available in this environment';throw new a.KinveyError(n)}return t(v)}(t);return function(e){return e.create(y.testSupportCollection,{_id:"1"})}(e).then(function(){return e})})},i.Promise.reject())}function m(){return g((0,h.ensureArray)(s.Client.sharedInstance().storage)).catch(function(){return i.Promise.reject(new a.KinveyError("None of the selected storage providers are supported in this environment."))})}t.repositoryProvider={getNetworkRepository:function(){return new l.NetworkRepository},getOfflineRepository:function(){return b||(b=m()),b},setSupportedRepoBuilders:function(e){_=e},getSupportedStorages:function(){return(0,u.default)(_)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processorFactory=void 0;var r=n(17),i=n(87),o=n(144),u=n(136),s=n(57);t.processorFactory={getOfflineProcessor:function(){var e=s.syncManagerProvider.getSyncManager();return new i.OfflineDataProcessor(e)},getNetworkProcessor:function(){return new o.NetworkDataProcessor},getCacheOfflineDataProcessor:function(){var e=r.repositoryProvider.getNetworkRepository(),t=s.syncManagerProvider.getSyncManager();return new u.CacheOfflineDataProcessor(t,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlatformConfig=function(){if(!a)return u.Log.debug("getPlatformConfig() called before setPlatformConfig()"),s.platformConfigs.base;return a},t.setPlatformConfig=function(e){a=(0,o.default)(s.platformConfigs.base,s.platformConfigs[e]||{})};var r,i=n(12),o=(r=i)&&r.__esModule?r:{default:r},u=n(18),s=n(386);var a=void 0},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.platformConfigs=void 0;var i=n(146);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.platformConfigs=(o(r={base:{maxConcurrentPushRequests:100,maxConcurrentPullRequests:32}},i.platformName.nativeScript,{maxConcurrentPullRequests:2}),o(r,i.platformName.phoneGap,{maxConcurrentPullRequests:2}),r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncManagerProvider=void 0;var r=n(145),i=n(17),o=n(149);t.syncManagerProvider={getSyncManager:function(){var e=i.repositoryProvider.getNetworkRepository(),t=new o.SyncStateManager;return new r.SyncManager(e,t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataStore=t.DataStoreType=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(10),u=(r=o)&&r.__esModule?r:{default:r},s=n(1),a=n(3),c=n(78),l=n(75),f=n(150),h=n(37),p=n(17),d=n(16);var y=t.DataStoreType={Cache:"Cache",Network:"Network",Sync:"Sync"};Object.freeze(y);var v=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new s.KinveyError("Not allowed to construct a DataStore instance. Please use the collection() function to get a DataStore instance.")}return i(e,null,[{key:"collection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.Cache,n=arguments[2],r=void 0,i=n&&"tag"in n;if(!1===(0,a.isDefined)(e)||!1===(0,u.default)(e))throw new s.KinveyError("A collection is required and must be a string.");if(i&&!(0,d.isValidDataStoreTag)(n.tag))throw new s.KinveyError("Please provide a valid data store tag.");switch(t){case y.Network:if(i)throw new s.KinveyError('The tagged option is not valid for data stores of type "Network"');var o=h.processorFactory.getNetworkProcessor();r=new c.NetworkStore(e,o,n);break;case y.Sync:var p=h.processorFactory.getOfflineProcessor();r=new f.SyncStore(e,p,n);break;case y.Cache:default:var v=h.processorFactory.getCacheOfflineDataProcessor();r=new l.CacheStore(e,v,n)}return r}},{key:"getInstance",value:function(e,t,n){return this.collection(e,t,n)}},{key:"clearCache",value:function(){return p.repositoryProvider.getOfflineRepository().then(function(e){return e.clear()}).then(function(){return null})}}]),e}();t.DataStore=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:18;return""+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")+function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(e)},t.isNonemptyString=function(e){return"string"==typeof e&&""!==e},t.uuidv4=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendQuery=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=r.default.parse(e,!0),h=(0,a.default)(t)?i.default.parse(t):t,p=(0,o.default)({},f.query,h);n=(0,o.default)({encodeComponents:!0,removeNull:!1},n),f.query=null;var d=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r=arguments[2];var i=[];var o=!1;(0,u.default)(t)&&(0,l.isDefined)(r)&&(o=!0);Object.keys(t).forEach(function(u){var a=void 0,c=t[u],f=r?r+"["+(o?"":u)+"]":u;if(!1===(0,l.isDefined)(c)){if(!0===n.removeNull)return;a=!0===n.encodeComponents?encodeURIComponent(f):f}else a=(0,s.default)(c)?e(c,n,f):n.encodeComponents?encodeURIComponent(f)+"="+encodeURIComponent(c):f+"="+c;i.push(a)});return i.join("&")}(p,n);return f.search=(0,l.isDefined)(d)&&!1===(0,c.default)(d)?"?"+d:null,r.default.format(f)};var r=f(n(21)),i=f(n(90)),o=f(n(12)),u=f(n(6)),s=f(n(33)),a=f(n(10)),c=f(n(27)),l=n(106);function f(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";var r=n(151),i=n(152),o={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},u=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,serializeDate:function(e){return u.call(e)},skipNulls:!1,strictNullHandling:!1},a=function e(t,n,i,o,u,a,c,l,f,h,p,d){var y=t;if("function"==typeof c)y=c(n,y);else if(y instanceof Date)y=h(y);else if(null===y){if(o)return a&&!d?a(n,s.encoder):n;y=""}if("string"==typeof y||"number"==typeof y||"boolean"==typeof y||r.isBuffer(y))return a?[p(d?n:a(n,s.encoder))+"="+p(a(y,s.encoder))]:[p(n)+"="+p(String(y))];var v,b=[];if(void 0===y)return b;if(Array.isArray(c))v=c;else{var _=Object.keys(y);v=l?_.sort(l):_}for(var g=0;g<v.length;++g){var m=v[g];u&&null===y[m]||(b=Array.isArray(y)?b.concat(e(y[m],i(n,m),i,o,u,a,c,l,f,h,p,d)):b.concat(e(y[m],n+(f?"."+m:"["+m+"]"),i,o,u,a,c,l,f,h,p,d)))}return b};e.exports=function(e,t){var n=e,u=t?r.assign({},t):{};if(null!==u.encoder&&void 0!==u.encoder&&"function"!=typeof u.encoder)throw new TypeError("Encoder has to be a function.");var c=void 0===u.delimiter?s.delimiter:u.delimiter,l="boolean"==typeof u.strictNullHandling?u.strictNullHandling:s.strictNullHandling,f="boolean"==typeof u.skipNulls?u.skipNulls:s.skipNulls,h="boolean"==typeof u.encode?u.encode:s.encode,p="function"==typeof u.encoder?u.encoder:s.encoder,d="function"==typeof u.sort?u.sort:null,y=void 0!==u.allowDots&&u.allowDots,v="function"==typeof u.serializeDate?u.serializeDate:s.serializeDate,b="boolean"==typeof u.encodeValuesOnly?u.encodeValuesOnly:s.encodeValuesOnly;if(void 0===u.format)u.format=i.default;else if(!Object.prototype.hasOwnProperty.call(i.formatters,u.format))throw new TypeError("Unknown format option provided.");var _,g,m=i.formatters[u.format];"function"==typeof u.filter?n=(g=u.filter)("",n):Array.isArray(u.filter)&&(_=g=u.filter);var w,O=[];if("object"!=typeof n||null===n)return"";w=u.arrayFormat in o?u.arrayFormat:"indices"in u?u.indices?"indices":"repeat":"indices";var k=o[w];_||(_=Object.keys(n)),d&&_.sort(d);for(var P=0;P<_.length;++P){var E=_[P];f&&null===n[E]||(O=O.concat(a(n[E],E,k,l,f,h?p:null,g,d,y,v,m,b)))}var j=O.join(c),S=!0===u.addQueryPrefix?"?":"";return j.length>0?S+j:""}},function(e,t,n){"use strict";var r=n(151),i=Object.prototype.hasOwnProperty,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:r.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},u=function(e,t,n){if(e){var r=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,u=/(\[[^[\]]*])/.exec(r),s=u?r.slice(0,u.index):r,a=[];if(s){if(!n.plainObjects&&i.call(Object.prototype,s)&&!n.allowPrototypes)return;a.push(s)}for(var c=0;null!==(u=o.exec(r))&&c<n.depth;){if(c+=1,!n.plainObjects&&i.call(Object.prototype,u[1].slice(1,-1))&&!n.allowPrototypes)return;a.push(u[1])}return u&&a.push("["+r.slice(u.index)+"]"),function(e,t,n){for(var r=t,i=e.length-1;i>=0;--i){var o,u=e[i];if("[]"===u)o=(o=[]).concat(r);else{o=n.plainObjects?Object.create(null):{};var s="["===u.charAt(0)&&"]"===u.charAt(u.length-1)?u.slice(1,-1):u,a=parseInt(s,10);!isNaN(a)&&u!==s&&String(a)===s&&a>=0&&n.parseArrays&&a<=n.arrayLimit?(o=[])[a]=r:o[s]=r}r=o}return r}(a,t,n)}};e.exports=function(e,t){var n=t?r.assign({},t):{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.ignoreQueryPrefix=!0===n.ignoreQueryPrefix,n.delimiter="string"==typeof n.delimiter||r.isRegExp(n.delimiter)?n.delimiter:o.delimiter,n.depth="number"==typeof n.depth?n.depth:o.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:o.arrayLimit,n.parseArrays=!1!==n.parseArrays,n.decoder="function"==typeof n.decoder?n.decoder:o.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:o.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:o.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:o.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:o.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:o.strictNullHandling,""===e||null===e||void 0===e)return n.plainObjects?Object.create(null):{};for(var s="string"==typeof e?function(e,t){for(var n={},r=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,u=t.parameterLimit===1/0?void 0:t.parameterLimit,s=r.split(t.delimiter,u),a=0;a<s.length;++a){var c,l,f=s[a],h=f.indexOf("]="),p=-1===h?f.indexOf("="):h+1;-1===p?(c=t.decoder(f,o.decoder),l=t.strictNullHandling?null:""):(c=t.decoder(f.slice(0,p),o.decoder),l=t.decoder(f.slice(p+1),o.decoder)),i.call(n,c)?n[c]=[].concat(n[c]).concat(l):n[c]=l}return n}(e,n):e,a=n.plainObjects?Object.create(null):{},c=Object.keys(s),l=0;l<c.length;++l){var f=c[l],h=u(f,s[f],n);a=r.merge(a,h,n)}return r.compact(a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyRequest=t.Properties=t.AuthType=t.NetworkRequest=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r,i){var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var u=Object.getPrototypeOf(t);null!==u&&e(u,n,r,i)}else if("value"in o&&o.writable)o.value=r;else{var s=o.set;void 0!==s&&s.call(i,r)}return r},o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0},u=C(n(2)),s=n(394),a=C(n(90)),c=C(n(12)),l=C(n(119)),f=C(n(27)),h=C(n(11)),p=C(n(21)),d=C(n(10)),y=C(n(398)),v=n(7),b=n(15),_=n(63),g=n(3),m=n(1),w=n(153),O=n(42),k=n(154),P=n(91),E=n(18),j=n(64),S=n(26);function C(e){return e&&e.__esModule?e:{default:e}}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var x=new y.default({concurrency:1/0}),R=t.NetworkRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M(this,t);var n=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.rack=k.NetworkRack,n}return A(t,w.Request),t}(),I=t.AuthType={All:"All",App:"App",Basic:"Basic",Default:"Default",Master:"Master",None:"None",Session:"Session",Client:"Client"};Object.freeze(I);var N={all:function(e){return N.session(e).catch(function(){return N.basic(e)})},app:function(e){return e.appKey&&e.appSecret?u.default.resolve({scheme:"Basic",username:e.appKey,password:e.appSecret}):u.default.reject(new Error("Missing client appKey and/or appSecret. Use Kinvey.initialize() to set the appKey and appSecret for the client."))},basic:function(e){return N.master(e).catch(function(){return N.app(e)})},client:function(e,t){return e.appKey&&e.appSecret?(t||(t=e.appKey),u.default.resolve({scheme:"Basic",username:t,password:e.appSecret})):u.default.reject(new Error("Missing client appKey and/or appSecret Use Kinvey.initialize() to set the appKey and appSecret for the client."))},master:function(e){return e.appKey&&e.masterSecret?u.default.resolve({scheme:"Basic",username:e.appKey,password:e.masterSecret}):u.default.reject(new Error("Missing client appKey and/or masterSecret. Use Kinvey.initialize() to set the appKey and masterSecret for the client."))},none:function(){return u.default.resolve(null)},session:function(e){var t=e.getActiveUser();return(0,g.isDefined)(t)?(0,h.default)(t._kmd)&&(0,g.isDefined)(t._kmd.authtoken)?u.default.resolve({scheme:"Kinvey",credentials:t._kmd.authtoken}):u.default.reject(new m.NoActiveUserError("The active user does not have a valid auth token.")):u.default.reject(new m.NoActiveUserError("There is not an active user. Please login a user and retry the request."))}};function q(e){var t=(0,j.getLiveService)(e.client),n=u.default.resolve();return t.isInitialized()&&(n=t.fullUninitialization()),n.then(function(){return e.client.setActiveUser(null)}).catch(function(e){return E.Log.error(e),null}).then(function(){return S.DataStore.clearCache({client:e.client})}).catch(function(e){return E.Log.error(e),null})}var D=t.Properties=function(e){function t(){return M(this,t),T(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return A(t,O.Headers),t}();t.KinveyRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};M(this,t);var n=T(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e=(0,c.default)({skipBL:!1,trace:!1},e),n.authType=e.authType||I.None,n.query=e.query,n.aggregation=e.aggregation,n.properties=e.properties||new D,n.skipBL=!0===e.skipBL,n.trace=!0===e.trace,n.clientId=e.clientId,n.kinveyFileTTL=e.kinveyFileTTL,n.kinveyFileTLS=e.kinveyFileTLS,n}return A(t,R),r(t,[{key:"getAuthorizationHeader",value:function(e,t){var n=u.default.resolve(void 0);if(e)switch(e){case I.All:n=N.all(t);break;case I.App:n=N.app(t);break;case I.Basic:n=N.basic(t);break;case I.Client:n=N.client(t,this.clientId);break;case I.Master:n=N.master(t);break;case I.None:n=N.none(t);break;case I.Session:n=N.session(t);break;default:n=N.session(t).catch(function(e){return N.master(t).catch(function(){throw e})})}return n.then(function(e){if((0,g.isDefined)(e)){var t=e.credentials;return e.username&&(t=s.Buffer.from(e.username+":"+e.password).toString("base64")),e.scheme+" "+t}})}},{key:"execute",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getAuthorizationHeader(this.authType,this.client).then(function(t){(0,g.isDefined)(t)?e.headers.set("Authorization",t):e.headers.remove("Authorization")}).then(function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",e).call(e)}).then(function(e){if(e instanceof P.KinveyResponse==!1&&(e=new P.KinveyResponse({statusCode:e.statusCode,headers:e.headers,data:e.data})),!1===n&&!1===e.isSuccess())throw e.error;return e}).catch(function(i){if(i instanceof m.InvalidCredentialsError){if(r){if(x.isPaused)return x.add(function(){return e.execute(n,!1).catch(function(){return u.default.reject(i)})});x.pause();var o=e.client.getActiveUser(),s=(0,g.isDefined)(o)&&(0,g.isDefined)(o._socialIdentity)?o._socialIdentity:{},a=Object.keys(s).find(function(e){return"kinveyAuth"===s[e].identity}),c=s[a];if((0,g.isDefined)(c))return new t({method:w.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:I.Client,url:p.default.format({protocol:e.client.micProtocol,host:e.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:c.client_id,redirect_uri:c.redirect_uri,refresh_token:c.refresh_token},properties:e.properties,timeout:e.timeout,clientId:c.client_id}).execute().then(function(e){return e.data}).then(function(t){return t.identity=c.identity,t.client_id=c.client_id,t.redirect_uri=c.redirect_uri,t.protocol=e.client.micProtocol,t.host=e.client.micHost,t}).then(function(n){var r={};return s[n.identity]=n,r._socialIdentity=s,new t({method:w.RequestMethod.POST,authType:I.App,url:p.default.format({protocol:e.client.apiProtocol,host:e.client.apiHost,pathname:"/user/"+e.client.appKey+"/login"}),properties:e.properties,body:r,timeout:e.timeout,client:e.client}).execute().then(function(e){return e.data}).then(function(t){return t._socialIdentity[n.identity]=(0,l.default)(t._socialIdentity[n.identity],n),e.client.setActiveUser(t)})}).catch(function(){return q(e).then(function(){return x.start(),u.default.reject(i)})}).then(function(){return x.start(),e.execute(n,!1)});x.start()}return q(e).then(function(){return u.default.reject(i)})}return u.default.reject(i)})}},{key:"appVersion",get:function(){return this.client.appVersion}},{key:"query",get:function(){return this._query},set:function(e){if((0,g.isDefined)(e)&&!(e instanceof b.Query))throw new m.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"aggregation",get:function(){return this._aggregation},set:function(e){if((0,g.isDefined)(e)&&!(e instanceof _.Aggregation))throw new m.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class.");(0,g.isDefined)(e)&&(this.body=e.toPlainObject()),this._aggregation=e}},{key:"headers",get:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",this);if(e.has("Accept")||e.set("Accept","application/json; charset=utf-8"),e.has("Content-Type")||e.set("Content-Type","application/json; charset=utf-8"),e.has("X-Kinvey-Api-Version")||e.set("X-Kinvey-Api-Version",4),!0===this.skipBL?e.set("X-Kinvey-Skip-Business-Logic",!0):e.remove("X-Kinvey-Skip-Business-Logic"),!0===this.trace?(e.set("X-Kinvey-Include-Headers-In-Response","X-Kinvey-Request-Id"),e.set("X-Kinvey-ResponseWrapper",!0)):(e.remove("X-Kinvey-Include-Headers-In-Response"),e.remove("X-Kinvey-ResponseWrapper")),this.appVersion?e.set("X-Kinvey-Client-App-Version",this.appVersion):e.remove("X-Kinvey-Client-App-Version"),this.properties){var n=this.properties.toString();if((0,f.default)(n))e.remove("X-Kinvey-Custom-Request-Properties");else{var r=function(e){if(e){var t=0,n=e.length;e=String(e||"");for(var r=0;r<n;r+=1){var i=encodeURI(e[r]).split("%").length;t+=1===i?1:i-1}return t}return 0}(n);if(r>=2e3)throw new Error("The custom properties are "+r+" bytes.It must be less then 2000 bytes.","Please remove some custom properties.");e.set("X-Kinvey-Custom-Request-Properties",n)}}else e.remove("X-Kinvey-Custom-Request-Properties");return e},set:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",e,this)}},{key:"url",get:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",this),n={kinveyfile_ttl:this.kinveyFileTTL,kinveyfile_tls:this.kinveyFileTLS};return this.query&&(n=Object.assign({},n,this.query.toQueryString())),(0,f.default)(n)?e:(0,g.appendQuery)(e,a.default.stringify(n))},set:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",e,this)}},{key:"properties",get:function(){return this._properties},set:function(e){e&&e instanceof D==!1&&(e=new D(e)),this._properties=e}}],[{key:"execute",value:function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(0,c.default)({method:w.RequestMethod.GET,authType:I.Default},e);n=n||v.Client.sharedInstance(),!i.url&&(0,d.default)(i.pathname)&&n&&(i.url=p.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:i.pathname}));var o=new t(i).execute();return r&&(o=o.then(function(e){return e.data})),o}}]),t}()},function(e,t,n){"use strict";(function(e){var r=n(395),i=n(396),o=n(397);function u(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(u()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=a.prototype:(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);a.TYPED_ARRAY_SUPPORT?(e=t).__proto__=a.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(a.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):h(e,t);if("Buffer"===t.type&&o(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=s(e,t<0?0:0|p(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=u())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+u().toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return L(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return L(e).length;t=(""+t).toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,i){var o,u=1,s=e.length,a=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;u=2,s/=2,a/=2,n/=2}function c(e,t){return 1===u?e[t]:e.readUInt16BE(t*u)}if(i){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===a)return l*u}else-1!==l&&(o-=o-l),l=-1}else for(n+a>s&&(n=s-a),o=n;o>=0;o--){for(var f=!0,h=0;h<a;h++)if(c(e,o+h)!==c(t,h)){f=!1;break}if(f)return o}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var u=0;u<r;++u){var s=parseInt(t.substr(2*u,2),16);if(isNaN(s))return u;e[n+u]=s}return u}function g(e,t,n,r){return B(L(t,e.length-n),e,n,r)}function m(e,t,n,r){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return m(e,t,n,r)}function O(e,t,n,r){return B(F(t),e,n,r)}function k(e,t,n,r){return B(function(e,t){for(var n,r,i,o=[],u=0;u<e.length&&!((t-=2)<0);++u)n=e.charCodeAt(u),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,u,s,a,c=e[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(a=(31&c)<<6|63&o)>127&&(l=a);break;case 3:o=e[i+1],u=e[i+2],128==(192&o)&&128==(192&u)&&(a=(15&c)<<12|(63&o)<<6|63&u)>2047&&(a<55296||a>57343)&&(l=a);break;case 4:o=e[i+1],u=e[i+2],s=e[i+3],128==(192&o)&&128==(192&u)&&128==(192&s)&&(a=(15&c)<<18|(63&o)<<12|(63&u)<<6|63&s)>65535&&a<1114112&&(l=a)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=f}return function(e){var t=e.length;if(t<=j)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=j));return n}(r)}t.Buffer=a,t.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=u(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return c(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},a.allocUnsafe=function(e){return f(null,e)},a.allocUnsafeSlow=function(e){return f(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var u=e[n];if(!a.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(r,i),i+=u.length}return r},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return S(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,u=n-t,s=Math.min(o,u),c=this.slice(r,i),l=e.slice(t,n),f=0;f<s;++f)if(c[f]!==l[f]){o=c[f],u=l[f];break}return o<u?-1:u<o?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return g(this,e,t,n);case"ascii":return m(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return O(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var j=4096;function S(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function M(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=K(e[o]);return i}function T(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function A(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function x(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function R(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function I(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,r,o){return o||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function D(e,t,n,r,o){return o||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}a.prototype.slice=function(e,t){var n,r=this.length;if(e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),a.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=a.prototype;else{var i=t-e;n=new a(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return t||A(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||A(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||A(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||A(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||A(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||A(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return t||A(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){t||A(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||A(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||A(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||A(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||A(e,4,this.length),i.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||A(e,8,this.length),i.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||x(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var o=0,u=1,s=0;for(this[t]=255&e;++o<n&&(u*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/u>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);x(this,e,t,n,i-1,-i)}var o=n-1,u=1,s=0;for(this[t+o]=255&e;--o>=0&&(u*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/u>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):R(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):R(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||x(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return D(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return D(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var u=a.isBuffer(e)?e:L(new a(e,r).toString()),s=u.length;for(o=0;o<n-t;++o)this[o+t]=u[o%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function K(e){return e<16?"0"+e.toString(16):e.toString(16)}function L(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],u=0;u<r;++u){if((n=e.charCodeAt(u))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(u+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(t,n(19))},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=c(e),r=n[0],u=n[1],s=new o(function(e,t,n){return 3*(t+n)/4-n}(0,r,u)),a=0,l=u>0?r-4:r,f=0;f<l;f+=4)t=i[e.charCodeAt(f)]<<18|i[e.charCodeAt(f+1)]<<12|i[e.charCodeAt(f+2)]<<6|i[e.charCodeAt(f+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;2===u&&(t=i[e.charCodeAt(f)]<<2|i[e.charCodeAt(f+1)]>>4,s[a++]=255&t);1===u&&(t=i[e.charCodeAt(f)]<<10|i[e.charCodeAt(f+1)]<<4|i[e.charCodeAt(f+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t);return s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],u=0,s=n-i;u<s;u+=16383)o.push(l(e,u,u+16383>s?s:u+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=u.length;s<a;++s)r[s]=u[s],i[u.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,o,u=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),u.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return u.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,u,s=8*i-r-1,a=(1<<s)-1,c=a>>1,l=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+e[t+f],f+=h,l-=8);for(u=o&(1<<-l)-1,o>>=-l,l+=r;l>0;u=256*u+e[t+f],f+=h,l-=8);if(0===o)o=1-c;else{if(o===a)return u?NaN:1/0*(p?-1:1);u+=Math.pow(2,r),o-=c}return(p?-1:1)*u*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var u,s,a,c=8*o-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,u=l):(u=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-u))<1&&(u--,a*=2),(t+=u+f>=1?h/a:h*Math.pow(2,1-f))*a>=2&&(u++,a/=2),u+f>=l?(s=0,u=l):u+f>=1?(s=(t*a-1)*Math.pow(2,i),u+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),u=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(u=u<<i|s,c+=i;c>0;e[n+p]=255&u,p+=d,u/=256,c-=8);e[n+p-d]|=128*y}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";class r{constructor(){this._queue=[]}enqueue(e,t){const n={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(n);const r=function(e,t,n){let r=0,i=e.length;for(;i>0;){const o=i/2|0;let u=r+o;n(e[u],t)<=0?(r=++u,i-=o+1):i=o}return r}(this._queue,n,(e,t)=>t.priority-e.priority);this._queue.splice(r,0,n)}dequeue(){return this._queue.shift().run}get size(){return this._queue.length}}e.exports=class{constructor(e){if(!("number"==typeof(e=Object.assign({concurrency:1/0,autoStart:!0,queueClass:r},e)).concurrency&&e.concurrency>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e.concurrency}\` (${typeof e.concurrency})`);this.queue=new e.queueClass,this._queueClass=e.queueClass,this._pendingCount=0,this._concurrency=e.concurrency,this._isPaused=!1===e.autoStart,this._resolveEmpty=(()=>{}),this._resolveIdle=(()=>{})}_next(){this._pendingCount--,this.queue.size>0?this._isPaused||this.queue.dequeue()():(this._resolveEmpty(),this._resolveEmpty=(()=>{}),0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=(()=>{})))}add(e,t){return new Promise((n,r)=>{const i=()=>{this._pendingCount++;try{Promise.resolve(e()).then(e=>{n(e),this._next()},e=>{r(e),this._next()})}catch(e){r(e),this._next()}};!this._isPaused&&this._pendingCount<this._concurrency?i():this.queue.enqueue(i,t)})}addAll(e,t){return Promise.all(e.map(e=>this.add(e,t)))}start(){if(this._isPaused)for(this._isPaused=!1;this.queue.size>0&&this._pendingCount<this._concurrency;)this.queue.dequeue()()}pause(){this._isPaused=!0}clear(){this.queue=new this._queueClass}onEmpty(){return 0===this.queue.size?Promise.resolve():new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=(()=>{t(),e()})})}onIdle(){return 0===this._pendingCount?Promise.resolve():new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=(()=>{t(),e()})})}get size(){return this.queue.size}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}}},function(e,t,n){var r=n(400),i=n(39),o=n(65),u=n(401),s=n(6);e.exports=function(e,t,n){var a=s(e)?r:u,c=arguments.length<3;return a(e,o(t,4),n,c,i)}},function(e,t){e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},function(e,t){e.exports=function(e,t,n,r,i){return i(e,function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)}),n}},function(e,t,n){var r=n(403),i=n(22);e.exports=function(e){return null==e?[]:r(e,i(e))}},function(e,t,n){var r=n(94);e.exports=function(e,t){return r(t,function(t){return e[t]})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpMiddleware=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r},s=n(1),a=n(58);t.HttpMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Http Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Middleware),i(t,[{key:"handle",value:function(){return u.default.reject(new s.KinveyError("Unable to send network request.","Please override the core HttpMiddleware."))}},{key:"cancel",value:function(){return u.default.resolve()}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=[],o=String.fromCharCode(9500),u=String.fromCharCode(9472),s=String.fromCharCode(9492),a=String.fromCharCode(9474);t.AsciiTree=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=function(e,t){if(0===e.level)return e.value;for(var n="\r\n",r=t?s:o,c=1;c<e.level;c+=1)n=""+n+(i[c]?" ":a),n+="  ";return""+n+r+u+" "+e.value}(t,arguments[1]);if(t.nodes.length>0){var r=t.nodes.length-1;t.nodes.forEach(function(t,o){i[t.level]=o===r,n+=e.generate(t,o===r)})}return n}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseMiddleware=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r},s=n(3),a=n(58);t.ParseMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Parse Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Middleware),i(t,[{key:"handle",value:function(e,t){if((0,s.isDefined)(t)&&(0,s.isDefined)(t.data)){var n=t.headers["content-type"]||t.headers["Content-Type"];if(n&&0===n.indexOf("application/json"))try{t.data=JSON.parse(t.data)}catch(e){}}return u.default.resolve({response:t})}}]),t}()},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.SerializeMiddleware=void 0;var r,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=(r=o)&&r.__esModule?r:{default:r},s=n(3),a=n(58);t.SerializeMiddleware=function(t){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Serialize Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,a.Middleware),i(n,[{key:"handle",value:function(t){if((0,s.isDefined)(t)&&(0,s.isDefined)(t.body)){var n=t.headers["content-type"]||t.headers["Content-Type"];if((0,s.isDefined)(n))if(0===n.indexOf("application/json"))t.body=JSON.stringify(t.body);else if(0===n.indexOf("application/x-www-form-urlencoded")){var r=t.body,i=[];Object.keys(r).forEach(function(t){i.push(e.encodeURIComponent(t)+"="+e.encodeURIComponent(r[t]))}),t.body=i.join("&")}}return u.default.resolve({request:t})}}]),n}()}).call(t,n(19))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(84),o=n(1);t.Popup=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.EventEmitter),r(t,[{key:"open",value:function(){throw new o.PopupError("Unable to open a popup on this platform.")}},{key:"close",value:function(){return this}}],[{key:"isSupported",value:function(){return!1}}]),t}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Identity=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7),o=n(1);t.Identity=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t.client||i.Client.sharedInstance()}return r(e,[{key:"isSupported",value:function(){return!1}},{key:"isOnline",value:function(e){var t=(new Date).getTime()/1e3;return e&&e.access_token&&e.expires>t}},{key:"identity",get:function(){throw new o.KinveyError("A subclass must override this property.")}}],[{key:"isSupported",value:function(){return!1}},{key:"identity",get:function(){throw new o.KinveyError("A subclass must override this property.")}}]),e}()},function(e,t){e.exports=require("platform")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=w(n(2)),o=w(n(12)),u=w(n(10)),s=w(n(11)),a=w(n(27)),c=w(n(21)),l=n(7),f=n(9),h=n(1),p=n(26),d=n(96),y=n(18),v=n(3),b=n(164),_=n(165),g=n(64),m=n(412);function w(e){return e&&e.__esModule?e:{default:e}}t.User=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.client=n.client||l.Client.sharedInstance()}return r(e,[{key:"isActive",value:function(){var t=e.getActiveUser(this.client);return!(!(0,v.isDefined)(t)||t._id!==this._id)}},{key:"isEmailVerified",value:function(){return"confirmed"===this.metadata.emailVerification}},{key:"login",value:function(t,n){var r=this,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t,l=this.isActive(),p=e.getActiveUser(this.client);return!0===l?i.default.reject(new h.ActiveUserError("This user is already the active user.")):(0,v.isDefined)(p)?i.default.reject(new h.ActiveUserError("An active user already exists. Please logout the active user before you login.")):((0,s.default)(a)?u=n||{}:a={username:t,password:n},(0,v.isDefined)(a.username)&&(a.username=String(a.username).trim()),(0,v.isDefined)(a.password)&&(a.password=String(a.password).trim()),(0,v.isDefined)(a.username)&&""!==a.username&&(0,v.isDefined)(a.password)&&""!==a.password||(0,v.isDefined)(a._socialIdentity)?new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/login"}),body:a,properties:u.properties,timeout:u.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){(0,v.isDefined)(a._socialIdentity)&&(0,v.isDefined)(e._socialIdentity)&&(Object.keys(e._socialIdentity).forEach(function(t){e._socialIdentity[t]=(0,o.default)({},a._socialIdentity[t],e._socialIdentity[t])}),e._socialIdentity=(0,o.default)({},a._socialIdentity,e._socialIdentity));return delete e.password,r.client.setActiveUser(e)}).then(function(e){return r.data=e,r}):i.default.reject(new h.KinveyError("Username and/or password missing. Please provide both a username and password to login.")))}},{key:"loginWithMIC",value:function(t,n){var r=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=this.isActive(),s=e.getActiveUser(this.client);return u?i.default.reject(new h.ActiveUserError("This user is already the active user.")):(0,v.isDefined)(s)?i.default.reject(new h.ActiveUserError("An active user already exists. Please logout the active user before you login.")):new d.MobileIdentityConnect({client:this.client}).login(t,n,o).then(function(e){return r.connectIdentity(d.MobileIdentityConnect.identity,e,o)})}},{key:"connectIdentity",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.isActive(),o={},u=o._socialIdentity||{};return u[e]=t,o._socialIdentity=u,i?this.update(o,r):this.login(o,r).catch(function(i){if(i instanceof h.NotFoundError)return n.signup(o,r).then(function(){return n.connectIdentity(e,t,r)});throw i})}},{key:"disconnectIdentity",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.default.resolve();return e===d.MobileIdentityConnect.identity&&(r=d.MobileIdentityConnect.logout(this,n)),r.catch(function(e){y.Log.error(e)}).then(function(){var r=t.data,i=r._socialIdentity||{};return delete i[e],r._socialIdentity=i,t.data=r,t._id?t.update(r,n):t}).then(function(){return t})}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.Session,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_logout"}),properties:t.properties,timeout:t.timeout,client:this.client});return this.unregisterFromLiveService().then(function(){return n.execute()}).catch(function(e){return y.Log.error(e),null}).then(function(){return e.client.setActiveUser(null)}).catch(function(e){return y.Log.error(e),null}).then(function(){return p.DataStore.clearCache({client:e.client})}).catch(function(e){return y.Log.error(e),null}).then(function(){return e})}},{key:"signup",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.getActiveUser(this.client);if(!0===(r=(0,o.default)({state:!0},r)).state&&(0,v.isDefined)(i))throw new h.ActiveUserError("An active user already exists. Please logout the active user before you login.");return t instanceof e&&(t=t.data),t=(0,o.default)(this.data,t),new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname}),body:(0,a.default)(t)?null:t,properties:r.properties,timeout:r.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){return!0===r.state?n.client.setActiveUser(e):e}).then(function(e){return n.data=e,n})}},{key:"signupWithIdentity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={_socialIdentity:{}};return r._socialIdentity[e]=t,this.signup(r,n)}},{key:"update",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=(0,o.default)(this.data,e),(new m.UserStore).update(e,n).then(function(e){return t.isActive()?t.client.setActiveUser(e):e}).then(function(e){return t.data=e,t})}},{key:"me",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new f.KinveyRequest({method:f.RequestMethod.GET,authType:f.AuthType.Session,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_me"}),properties:t.properties,timeout:t.timeout}).execute().then(function(e){return e.data}).then(function(t){return delete t.password,e.isActive()?e.client.setActiveUser(t):t}).then(function(t){return e.data=t,e})}},{key:"registerForLiveService",value:function(){var e=(0,g.getLiveService)(this.client),t=i.default.resolve();return e.isInitialized()||(t=e.fullInitialization(this)),t}},{key:"unregisterFromLiveService",value:function(){var e=(0,g.getLiveService)(this.client),t=i.default.resolve();return e.isInitialized()&&(t=e.fullUninitialization()),t}},{key:"_id",get:function(){return this.data._id}},{key:"_acl",get:function(){return new b.Acl(this.data)}},{key:"metadata",get:function(){return new _.Metadata(this.data)}},{key:"_kmd",get:function(){return this.metadata}},{key:"_socialIdentity",get:function(){return this.data._socialIdentity}},{key:"authtoken",get:function(){return this.metadata.authtoken}},{key:"username",get:function(){return this.data.username}},{key:"email",get:function(){return this.data.email}},{key:"pathname",get:function(){return"/user/"+this.client.appKey}}],[{key:"login",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new e({},r).login(t,n,r)}},{key:"loginWithMIC",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},n).loginWithMIC(e,t,n)}},{key:"connectIdentity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},n).connectIdentity(e,t,n)}},{key:"logout",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.getActiveUser(t.client);return(0,v.isDefined)(n)?n.logout(t):i.default.resolve(null)}},{key:"signup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new this({},t).signup(e,t)}},{key:"signupWithIdentity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},n).signupWithIdentity(e,t,n)}},{key:"update",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.getActiveUser(n.client);return(0,v.isDefined)(r)?r.update(t,n):i.default.resolve(null)}},{key:"registerForLiveService",value:function(){var t=e.getActiveUser();return t?t.registerForLiveService():i.default.reject(new h.ActiveUserError("There is no active user"))}},{key:"unregisterFromLiveService",value:function(){var t=e.getActiveUser();return t?t.unregisterFromLiveService():i.default.reject(new h.ActiveUserError("There is no active user"))}},{key:"me",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.getActiveUser(t.client);return n?n.me(t):i.default.resolve(null)}},{key:"getActiveUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.Client.sharedInstance(),t=e.getActiveUser();return(0,v.isDefined)(t)?new this(t,{client:e}):null}},{key:"verifyEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,u.default)(e))return i.default.reject(new h.KinveyError("The provided username is not a string."));var n=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:"/rpc/"+n.appKey+"/"+e+"/user-email-verification-initiate"}),properties:t.properties,timeout:t.timeout,client:n}).execute().then(function(e){return e.data})}},{key:"forgotUsername",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("An email was not provided.","Please provide an email for the user that you would like to retrieve their username."));if(!(0,u.default)(e))return i.default.reject(new h.KinveyError("The provided email is not a string."));var n=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:"/rpc/"+n.appKey+"/user-forgot-username"}),properties:t.properties,data:{email:e},timeout:t.timeout,client:n}).execute().then(function(e){return e.data})}},{key:"resetPassword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,u.default)(e))return i.default.reject(new h.KinveyError("The provided username is not a string."));var n=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:"/rpc/"+n.appKey+"/"+e+"/user-password-reset-initiate"}),properties:t.properties,timeout:t.timeout,client:n}).execute().then(function(e){return e.data})}},{key:"lookup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new m.UserStore).lookup(e,t)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new m.UserStore).exists(e,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new m.UserStore).removeById(e,t)}},{key:"restore",value:function(){return i.default.reject(new h.KinveyError("This function requires a master secret to be provided for your application. We strongly advise not to do this."))}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserStore=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=d(n(2)),o=d(n(6)),u=d(n(10)),s=d(n(21)),a=n(7),c=n(9),l=n(1),f=n(62),h=n(3),p=n(15);function d(e){return e&&e.__esModule?e:{default:e}}t.UserStore=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=a.Client.sharedInstance()}return r(e,[{key:"lookup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,h.isDefined)(e)&&!(e instanceof p.Query)){return(0,f.wrapInObservable)(i.default.reject(new l.KinveyError("Invalid query. It must be an instance of the Query class.")))}var n=new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.Default,url:s.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:this.pathname+"/_lookup"}),properties:t.properties,body:(0,h.isDefined)(e)?e.toPlainObject().filter:null,timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data});return(0,f.wrapInObservable)(n)}},{key:"create",value:function(){return i.default.reject(new l.KinveyError("Please use `User.signup()` to create a user."))}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(0,o.default)(e)?i.default.reject(new l.KinveyError("Only one user can be updated at one time.",e)):e._id?!1===(0,h.isDefined)(e)?i.default.resolve(null):new c.KinveyRequest({method:c.RequestMethod.PUT,authType:c.AuthType.Default,url:s.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:this.pathname+"/"+e._id}),properties:t.properties,data:e,timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data}):i.default.reject(new l.KinveyError("User must have an _id.")):i.default.reject(new l.KinveyError("No user was provided to be updated."))}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.App,url:s.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:"/rpc/"+this._client.appKey+"/check-username-exists"}),properties:t.properties,data:{username:e},timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data}).then(function(){return!0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).usernameExists})}},{key:"removeById",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.KinveyObservable.create(function(r){return!1===(0,h.isDefined)(e)?r.error(new l.KinveyError("An id was not provided.","Please provide a valid id for a user that you would like to remove.")):!1===(0,u.default)(e)?r.error(new l.KinveyError("The id provided is not a string.","Please provide a valid id for a user that you would like to remove.")):new c.KinveyRequest({method:c.RequestMethod.DELETE,authType:c.AuthType.Default,url:s.default.format({protocol:t._client.apiProtocol,host:t._client.apiHost,pathname:t.pathname+"/"+e,query:!0===n.hard?{hard:!0}:void 0}),properties:n.properties,timeout:n.timeout}).execute().then(function(e){return e.data}).then(function(e){return r.next(e)}).then(function(){return r.complete()}).catch(function(e){return r.error(e)})}).toPromise()}},{key:"pathname",get:function(){return"/user/"+this._client.appKey}}]),e}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(493);t.Push=r.Push},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),o=n(3),u=n(1),s=n(494);try{r=n(495)}catch(e){}var a=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._registerWithPushPlugin=function(e){var t=this;void 0===e&&(e={});var n=e.ios||{};return new i.Promise(function(e,i){if(!1===o.isDefined(r))return i(new u.KinveyError("NativeScript Push Plugin is not installed.","Please refer to http://devcenter.kinvey.com/nativescript/guides/push#ProjectSetUp for help with setting up your project."));var s=n.notificationCallbackIOS;n.notificationCallbackIOS=function(e){"function"==typeof s&&s(e),t.emit("notification",e)},r.register(n,function(t){o.isDefined(n.interactiveSettings)?r.registerUserNotificationSettings(function(){e(t)},function(n){e(t)}):e(t)},i)})},t.prototype._unregisterWithPushPlugin=function(e){void 0===e&&(e={});var t=e.ios||{};return new i.Promise(function(e,n){if(!1===o.isDefined(r))return n(new u.KinveyError("NativeScript Push Plugin is not installed.","Please refer to http://devcenter.kinvey.com/nativescript/guides/push#ProjectSetUp for help with setting up your project."));r.unregister(e,n,t)})},t}(s.PushCommon));t.Push=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(84),o=n(410),u=n(7),s=n(1),a=n(3),c=n(163),l=n(9),f=n(26),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"client",{get:function(){return!1===a.isDefined(this._client)?u.Client.sharedInstance():this._client},set:function(e){if(a.isDefined(e)&&e instanceof u.Client==!1)throw new Error("client must be an instance of Client.");this._client=e},enumerable:!0,configurable:!0}),t.prototype.onNotification=function(e){return this.on("notification",e)},t.prototype.onceNotification=function(e){return this.once("notification",e)},t.prototype.register=function(e){var t=this;return void 0===e&&(e={}),this._registerWithPushPlugin(e).then(function(n){if(!1===a.isDefined(n))throw new s.KinveyError("Unable to retrieve the device token to register this device for push notifications.");return t._registerWithKinvey(n,e)}).then(function(e){return t._saveTokenToCache(e)})},t.prototype.unregister=function(e){var t=this;return void 0===e&&(e={}),this._unregisterWithPushPlugin(e).then(function(){return t._getTokenFromCache()}).then(function(n){if(!1===a.isDefined(n))throw new s.KinveyError("Unable to retrieve the device token to unregister this device for push notifications.");return t._unregisterWithKinvey(n,e)}).then(function(){return t._deleteTokenFromCache()})},t.prototype._registerWithPushPlugin=function(e){return void 0===e&&(e={}),r.Promise.reject(new s.KinveyError("Unable to register for push notifications."))},t.prototype._unregisterWithPushPlugin=function(e){return void 0===e&&(e={}),r.Promise.reject(new s.KinveyError("Unable to unregister for push notifications."))},t.prototype._registerWithKinvey=function(e,t){void 0===t&&(t={});var n=c.User.getActiveUser(this.client);return!1===a.isDefined(n)?r.Promise.reject(new s.KinveyError("Unable to register this device for push notifications.","You must login a user.")):new l.KinveyRequest({method:l.RequestMethod.POST,url:this.client.apiHostname+"/push/"+this.client.appKey+"/register-device",authType:n?l.AuthType.Session:l.AuthType.Master,data:{platform:o.device.os.toLowerCase(),framework:"nativescript",deviceId:e},timeout:t.timeout,client:this.client}).execute().then(function(){return e})},t.prototype._unregisterWithKinvey=function(e,t){void 0===t&&(t={});var n=c.User.getActiveUser(this.client);return!1===a.isDefined(n)?r.Promise.reject(new s.KinveyError("Unable to unregister this device for push notifications.","You must login a user.")):new l.KinveyRequest({method:l.RequestMethod.POST,url:this.client.apiHostname+"/push/"+this.client.appKey+"/unregister-device",authType:a.isDefined(n)?l.AuthType.Session:l.AuthType.Master,data:{platform:o.device.os.toLowerCase(),framework:"nativescript",deviceId:e},timeout:t.timeout,client:this.client}).execute().then(function(e){return e.data})},t.prototype._getTokenFromCache=function(){var e=c.User.getActiveUser(this.client);if(!1===a.isDefined(e))throw new s.KinveyError("Unable to retrieve device token.","You must login a user.");return this._getOfflineRepo().then(function(t){return t.readById("__device",e._id)}).catch(function(e){if(e instanceof s.NotFoundError)return{};throw e}).then(function(e){return a.isDefined(e)?e.token:null})},t.prototype._saveTokenToCache=function(e){var t=c.User.getActiveUser(this.client);if(!1===a.isDefined(t))throw new s.KinveyError("Unable to save device token.","You must login a user.");var n={_id:t._id,userId:t._id,token:e};return this._getOfflineRepo().then(function(e){return e.update("__device",n)}).then(function(){return e})},t.prototype._deleteTokenFromCache=function(){var e=c.User.getActiveUser(this.client);if(!1===a.isDefined(e))throw new s.KinveyError("Unable to delete device token.","You must login a user.");return this._getOfflineRepo().then(function(t){return t.deleteById("__device",e._id)}).then(function(){return null})},t.prototype._getOfflineRepo=function(){return this._offlineRepoPromise||(this._offlineRepoPromise=f.repositoryProvider.getOfflineRepository()),this._offlineRepoPromise},t}(i.EventEmitter);t.PushCommon=h},function(e,t){e.exports=require("nativescript-push-notifications")}]);
//# sourceMappingURL=push.ios.js.map